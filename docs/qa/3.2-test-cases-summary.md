# Story 3.2: RAGå‘é‡æ£€ç´¢ - æµ‹è¯•ç”¨ä¾‹æ±‡æ€»

**Story**: 3.2 - RAGå‘é‡æ£€ç´¢å®ç°  
**æ—¥æœŸ**: 2025-01-08  
**çŠ¶æ€**: å¼€å‘å®Œæˆï¼Œæµ‹è¯•è¿›è¡Œä¸­

---

## ğŸ“Š æµ‹è¯•è¦†ç›–æ¦‚è§ˆ

| æµ‹è¯•ç±»å‹ | è®¡åˆ’æ•°é‡ | å·²å®Œæˆ | é€šè¿‡ç‡ | ä¼˜å…ˆçº§åˆ†å¸ƒ |
|---------|---------|--------|--------|-----------|
| å•å…ƒæµ‹è¯• | 21 | 21 | 100% | P0: 8, P1: 13 |
| é›†æˆæµ‹è¯• | 15 | 0 | - | P0: 9, P1: 6 |
| æ€§èƒ½æµ‹è¯• | 5 | 0 | - | P0: 3, P1: 2 |
| äººå·¥è¯„ä¼° | 1 | 0 | - | P0: 1 (CRITICAL) |
| **æ€»è®¡** | **42** | **21** | **50%** | - |

---

## âœ… å·²å®Œæˆï¼šå•å…ƒæµ‹è¯• (21/21 é€šè¿‡)

### 1. QueryVectorizer æµ‹è¯• (10ä¸ª)

**æµ‹è¯•æ–‡ä»¶**: `tests/unit/services/rag/queryVectorizer.test.ts`

| ID | ç”¨ä¾‹åç§° | ä¼˜å…ˆçº§ | çŠ¶æ€ | éªŒè¯å†…å®¹ |
|----|---------|--------|------|---------|
| UT-QV-001 | åº”è¯¥æˆåŠŸå‘é‡åŒ–æœ‰æ•ˆçš„æŸ¥è¯¢é—®é¢˜ | P0 | âœ… | æ­£å¸¸æµç¨‹ï¼Œè¿”å›1024ç»´å‘é‡ |
| UT-QV-002 | åº”è¯¥æ‹’ç»ç©ºæŸ¥è¯¢ | P1 | âœ… | ç©ºå­—ç¬¦ä¸²ã€çº¯ç©ºæ ¼è¢«æ‹’ç» |
| UT-QV-003 | åº”è¯¥æ‹’ç»è¿‡é•¿çš„æŸ¥è¯¢ï¼ˆ>1000å­—ç¬¦ï¼‰ | P1 | âœ… | è¾¹ç•Œæ¡ä»¶éªŒè¯ |
| UT-QV-004 | åº”è¯¥æ¥å—1000å­—ç¬¦çš„æŸ¥è¯¢ | P1 | âœ… | æœ€å¤§é•¿åº¦è¾¹ç•Œ |
| UT-QV-005 | åº”è¯¥å¤„ç†embedding APIå¤±è´¥ | P1 | âœ… | APIé”™è¯¯å¤„ç† |
| UT-QV-006 | åº”è¯¥å¤„ç†embedding APIè¶…æ—¶ | P0 | âœ… | è¶…æ—¶é”™è¯¯åˆ†ç±» |
| UT-QV-007 | åº”è¯¥å¤„ç†APIé…é¢è¶…é™ | P0 | âœ… | é…é¢é”™è¯¯å¤„ç† |
| UT-QV-008 | åº”è¯¥éªŒè¯å‘é‡ç»´åº¦ | P0 | âœ… | ç»´åº¦ä¸åŒ¹é…æ£€æµ‹ (1024ç»´) |
| UT-QV-009 | åº”è¯¥å¤„ç†ç©ºçš„embeddingå“åº” | P1 | âœ… | ç©ºå“åº”é”™è¯¯å¤„ç† |
| UT-QV-010 | åº”è¯¥è‡ªåŠ¨trimæŸ¥è¯¢å­—ç¬¦ä¸² | P1 | âœ… | è¾“å…¥è§„èŒƒåŒ– |

**å…³é”®å‘ç°**:
- âœ… æ‰€æœ‰æµ‹è¯•ä½¿ç”¨ `EMBEDDING_DIMENSION` å¸¸é‡ï¼ˆ1024ç»´ï¼‰
- âœ… é”™è¯¯å¤„ç†å®Œå–„ï¼ŒåŒ…å«è¶…æ—¶ã€é…é¢ã€APIå¤±è´¥ç­‰åœºæ™¯
- âœ… è¾“å…¥éªŒè¯è¦†ç›–è¾¹ç•Œæ¡ä»¶

---

### 2. QueryCacheService æµ‹è¯• (11ä¸ª)

**æµ‹è¯•æ–‡ä»¶**: `tests/unit/services/rag/queryCacheService.test.ts`

| ID | ç”¨ä¾‹åç§° | ä¼˜å…ˆçº§ | çŠ¶æ€ | éªŒè¯å†…å®¹ |
|----|---------|--------|------|---------|
| UT-QC-001 | åº”è¯¥æˆåŠŸè¿æ¥Redis | P1 | âœ… | Redisè¿æ¥åˆå§‹åŒ– |
| UT-QC-002 | åº”è¯¥ç”Ÿæˆä¸€è‡´çš„ç¼“å­˜é”® | P1 | âœ… | MD5å“ˆå¸Œä¸€è‡´æ€§ |
| UT-QC-003 | åº”è¯¥è¿”å›ç¼“å­˜å‘½ä¸­ç»“æœ | P0 | âœ… | ç¼“å­˜è¯»å– |
| UT-QC-004 | åº”è¯¥è¿”å›nullå½“ç¼“å­˜æœªå‘½ä¸­ | P0 | âœ… | ç¼“å­˜misså¤„ç† |
| UT-QC-005 | åº”è¯¥è®¾ç½®30åˆ†é’ŸTTL | P1 | âœ… | ç¼“å­˜è¿‡æœŸç­–ç•¥ |
| UT-QC-006 | åº”è¯¥æ¸…é™¤æ–‡æ¡£ç›¸å…³ç¼“å­˜ | P1 | âœ… | æ‰¹é‡å¤±æ•ˆé€»è¾‘ |
| UT-QC-007 | Redisä¸å¯ç”¨æ—¶ä¼˜é›…é™çº§ | P0 | âœ… | é™çº§åˆ°æ— ç¼“å­˜æ¨¡å¼ |
| UT-QC-008 | åº”è¯¥è§„èŒƒåŒ–æŸ¥è¯¢å­—ç¬¦ä¸² | P1 | âœ… | toLowerCase + trim |
| UT-QC-009 | ç¼“å­˜å†™å…¥å¤±è´¥ä¸æŠ›é”™ | P0 | âœ… | å†™å…¥å¤±è´¥é™çº§ |
| UT-QC-010 | åº”è¯¥åºåˆ—åŒ–å¤æ‚å¯¹è±¡ | P1 | âœ… | JSONåºåˆ—åŒ– |
| UT-QC-011 | ç¼“å­˜é”®åŒ…å«documentId | P1 | âœ… | éš”ç¦»ä¸åŒæ–‡æ¡£ |

**å…³é”®å‘ç°**:
- âœ… Redisæ•…éšœé™çº§é€»è¾‘å®Œå–„
- âœ… ç¼“å­˜å¤±è´¥ä¸å½±å“ä¸»æµç¨‹
- âœ… ç¼“å­˜é”®è®¾è®¡åˆç†ï¼ˆdocumentId + queryHashï¼‰

---

## â³ å¾…å®ç°ï¼šé›†æˆæµ‹è¯• (0/15)

### 3. RAGæ£€ç´¢APIé›†æˆæµ‹è¯•

**æµ‹è¯•æ–‡ä»¶**: `tests/integration/api/rag-retrieval.test.ts` (æ¡†æ¶å·²åˆ›å»º)

#### 3.1 æ ¸å¿ƒåŠŸèƒ½æµ‹è¯• (P0)

| ID | ç”¨ä¾‹åç§° | ä¼˜å…ˆçº§ | çŠ¶æ€ | éªŒè¯å†…å®¹ |
|----|---------|--------|------|---------|
| IT-RAG-001 | åº”è¯¥æˆåŠŸæ‰§è¡Œå®Œæ•´RAGæ£€ç´¢æµç¨‹ | P0 | â³ | ç«¯åˆ°ç«¯æ£€ç´¢ |
| IT-RAG-002 | åº”è¯¥æ­£ç¡®è¿‡æ»¤ä½ç›¸ä¼¼åº¦ç»“æœ | P0 | â³ | minScore=0.3ç”Ÿæ•ˆ |
| IT-RAG-003 | åº”è¯¥è¿”å›Top-Kæ•°é‡çš„ç»“æœ | P0 | â³ | topK=5é™åˆ¶ |
| IT-RAG-004 | åº”è¯¥éªŒè¯æ–‡æ¡£æƒé™ | P0 | â³ | è·¨ç”¨æˆ·è®¿é—®æ‹’ç» |
| IT-RAG-005 | åº”è¯¥æ‹’ç»è®¿é—®æœªå°±ç»ªçš„æ–‡æ¡£ | P0 | â³ | status != READY |

**å‰ç½®æ¡ä»¶**:
```bash
# 1. æµ‹è¯•æ•°æ®åº“
docker run -d --name test-postgres \
  -e POSTGRES_PASSWORD=test \
  -p 5433:5432 \
  ankane/pgvector

# 2. æµ‹è¯•Redis
docker run -d --name test-redis \
  -p 6380:6379 redis:alpine

# 3. æµ‹è¯•æ•°æ®
npm run seed:test-documents
```

**æµ‹è¯•æ­¥éª¤ç¤ºä¾‹** (IT-RAG-001):
```typescript
it('åº”è¯¥æˆåŠŸæ‰§è¡Œå®Œæ•´RAGæ£€ç´¢æµç¨‹', async () => {
  // 1. å‡†å¤‡ï¼šåˆ›å»ºæµ‹è¯•ç”¨æˆ·å’Œæ–‡æ¡£
  const user = await createTestUser()
  const doc = await createTestDocument(user.id, {
    filename: 'test-react.pdf',
    chunks: 50,
    status: 'READY'
  })

  // 2. æ‰§è¡Œï¼šè°ƒç”¨API
  const response = await request(app)
    .post('/api/chat/query')
    .set('Authorization', `Bearer ${user.token}`)
    .send({
      documentId: doc.id,
      question: 'ä»€ä¹ˆæ˜¯React Hooks?',
      conversationId: null
    })

  // 3. éªŒè¯ï¼šå“åº”æ ¼å¼å’Œå†…å®¹
  expect(response.status).toBe(200)
  expect(response.body.success).toBe(true)
  expect(response.body.retrieval).toMatchObject({
    chunks: expect.arrayContaining([
      expect.objectContaining({
        id: expect.any(String),
        content: expect.any(String),
        score: expect.any(Number),
        documentId: doc.id
      })
    ]),
    totalFound: expect.any(Number),
    cached: false,
    retrievalTime: expect.any(Number)
  })
  expect(response.body.retrieval.chunks.length).toBeGreaterThan(0)
  expect(response.body.retrieval.chunks.length).toBeLessThanOrEqual(5)
})
```

#### 3.2 ç¼“å­˜åŠŸèƒ½æµ‹è¯• (P1)

| ID | ç”¨ä¾‹åç§° | ä¼˜å…ˆçº§ | çŠ¶æ€ | éªŒè¯å†…å®¹ |
|----|---------|--------|------|---------|
| IT-RAG-006 | åº”è¯¥æ­£ç¡®å¤„ç†ç¼“å­˜å‘½ä¸­ | P1 | â³ | cached=true, å“åº”æ›´å¿« |
| IT-RAG-007 | ä¸åŒæŸ¥è¯¢åº”è¯¥ç¼“å­˜éš”ç¦» | P1 | â³ | ç¼“å­˜é”®å”¯ä¸€æ€§ |
| IT-RAG-008 | Redisæ•…éšœæ—¶ä¼˜é›…é™çº§ | P1 | â³ | æ— ç¼“å­˜ä¹Ÿèƒ½å·¥ä½œ |

#### 3.3 é”™è¯¯å¤„ç†æµ‹è¯• (P0/P1)

| ID | ç”¨ä¾‹åç§° | ä¼˜å…ˆçº§ | çŠ¶æ€ | éªŒè¯å†…å®¹ |
|----|---------|--------|------|---------|
| IT-RAG-009 | åº”è¯¥å¤„ç†å‘é‡åŒ–å¤±è´¥ | P0 | â³ | è¿”å›503é”™è¯¯ |
| IT-RAG-010 | åº”è¯¥å¤„ç†å‘é‡åŒ–è¶…æ—¶ | P1 | â³ | è¿”å›504é”™è¯¯ |
| IT-RAG-011 | æœªæ‰¾åˆ°ç›¸å…³å†…å®¹æ—¶å‹å¥½æç¤º | P0 | â³ | NO_RELEVANT_CONTENT |
| IT-RAG-012 | åº”è¯¥å¤„ç†APIé…é¢è¶…é™ | P1 | â³ | è¿”å›429é”™è¯¯ |
| IT-RAG-013 | åº”è¯¥å¤„ç†æ•°æ®åº“é”™è¯¯ | P1 | â³ | è¿”å›500é”™è¯¯ |

#### 3.4 å®‰å…¨æµ‹è¯• (P0)

| ID | ç”¨ä¾‹åç§° | ä¼˜å…ˆçº§ | çŠ¶æ€ | éªŒè¯å†…å®¹ |
|----|---------|--------|------|---------|
| IT-RAG-014 | APIå¯†é’¥ä¸åº”å‡ºç°åœ¨å“åº”ä¸­ | P0 | â³ | å“åº”ä¸å«sk-* |
| IT-RAG-015 | æŸ¥è¯¢å†…å®¹åº”è¯¥è„±æ• | P0 | â³ | æ—¥å¿—ä»…å‰50å­—ç¬¦ |

---

## â³ å¾…å®ç°ï¼šæ€§èƒ½æµ‹è¯• (0/5)

### 4. æ€§èƒ½åŸºå‡†æµ‹è¯•

**æµ‹è¯•æ–‡ä»¶**: `tests/performance/rag-retrieval.benchmark.ts` (éœ€åˆ›å»º)

| ID | ç”¨ä¾‹åç§° | ä¼˜å…ˆçº§ | ç›®æ ‡ | çŠ¶æ€ | éªŒè¯å†…å®¹ |
|----|---------|--------|------|------|---------|
| PT-RAG-001 | å‘é‡åŒ–å»¶è¿Ÿåˆ†å¸ƒ | P0 | P95 < 300ms | â³ | 100æ¬¡é‡‡æ · |
| PT-RAG-002 | å‘é‡æ£€ç´¢å»¶è¿Ÿåˆ†å¸ƒ | P0 | P95 < 200ms | â³ | 100æ¬¡é‡‡æ · |
| PT-RAG-003 | ç«¯åˆ°ç«¯å»¶è¿Ÿåˆ†å¸ƒ | P0 | P95 < 500ms | â³ | 100æ¬¡é‡‡æ · |
| PT-RAG-004 | å¹¶å‘æ€§èƒ½æµ‹è¯• | P1 | 10å¹¶å‘æ— é—®é¢˜ | â³ | å»¶è¿Ÿä¸çº¿æ€§å¢é•¿ |
| PT-RAG-005 | ç¼“å­˜å‘½ä¸­ç‡æµ‹è¯• | P1 | > 30% | â³ | é‡å¤æŸ¥è¯¢åœºæ™¯ |

**æµ‹è¯•ä»£ç ç¤ºä¾‹**:
```typescript
it('ç«¯åˆ°ç«¯å»¶è¿Ÿåº”è¯¥ < 500ms (P95)', async () => {
  const latencies: number[] = []
  const iterations = 100

  // æ‰§è¡Œ100æ¬¡è¯·æ±‚
  for (let i = 0; i < iterations; i++) {
    const start = performance.now()
    await request(app)
      .post('/api/chat/query')
      .set('Authorization', `Bearer ${testUser.token}`)
      .send({
        documentId: testDocument.id,
        question: `æµ‹è¯•é—®é¢˜ ${i}`
      })
    latencies.push(performance.now() - start)
  }

  // è®¡ç®—P95
  latencies.sort((a, b) => a - b)
  const p50 = latencies[Math.floor(iterations * 0.5)]
  const p95 = latencies[Math.floor(iterations * 0.95)]
  const p99 = latencies[Math.floor(iterations * 0.99)]

  console.log('å»¶è¿Ÿåˆ†å¸ƒ:', { p50, p95, p99 })

  // éªŒè¯ç›®æ ‡
  expect(p95).toBeLessThan(500)
})
```

---

## ğŸ¯ å¾…å®ç°ï¼šäººå·¥è´¨é‡è¯„ä¼° (CRITICAL)

### 5. Top-5æ£€ç´¢å‡†ç¡®ç‡è¯„ä¼°

**ç›®æ ‡**: >= 85%  
**ä¼˜å…ˆçº§**: P0 (é˜»æ­¢ä¸Šçº¿)  
**é¢„è®¡æ—¶é—´**: 4å°æ—¶

#### 5.1 æµ‹è¯•æ–‡æ¡£å‡†å¤‡ (3ä¸ª)

| æ–‡æ¡£ID | ç±»å‹ | æ–‡ä»¶å | é¡µæ•° | ä¸»é¢˜ |
|-------|------|--------|------|------|
| DOC-1 | æŠ€æœ¯æ–‡æ¡£ | react-official-guide.pdf | 50 | React Hooks, ç»„ä»¶, çŠ¶æ€ç®¡ç† |
| DOC-2 | ä¸šåŠ¡æ–‡æ¡£ | product-requirements.docx | 30 | äº§å“åŠŸèƒ½, ç”¨æˆ·éœ€æ±‚, å®šä»· |
| DOC-3 | å­¦æœ¯æ–‡æ¡£ | ml-research-paper.pdf | 20 | æœºå™¨å­¦ä¹ , å®éªŒæ–¹æ³•, ç»“æœ |

#### 5.2 æµ‹è¯•é—®é¢˜è®¾è®¡ (20ä¸ª)

##### DOC-1: æŠ€æœ¯æ–‡æ¡£ (7ä¸ªé—®é¢˜)

| ID | é—®é¢˜ç±»å‹ | æµ‹è¯•é—®é¢˜ |
|----|---------|---------|
| Q1 | äº‹å®æ€§ | ä»€ä¹ˆæ˜¯React Hooksï¼Ÿ |
| Q2 | æ“ä½œæ€§ | å¦‚ä½•ä½¿ç”¨useStateç®¡ç†çŠ¶æ€ï¼Ÿ |
| Q3 | æ¯”è¾ƒæ€§ | useEffectå’ŒuseLayoutEffectçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ |
| Q4 | è§£é‡Šæ€§ | ä¸ºä»€ä¹ˆéœ€è¦useCallbackä¼˜åŒ–æ€§èƒ½ï¼Ÿ |
| Q5 | äº‹å®æ€§ | React 18æœ‰å“ªäº›æ–°ç‰¹æ€§ï¼Ÿ |
| Q6 | æ“ä½œæ€§ | å¦‚ä½•é¿å…useEffectçš„æ— é™å¾ªç¯ï¼Ÿ |
| Q7 | æ“ä½œæ€§ | è‡ªå®šä¹‰Hookçš„æœ€ä½³å®è·µæœ‰å“ªäº›ï¼Ÿ |

##### DOC-2: ä¸šåŠ¡æ–‡æ¡£ (7ä¸ªé—®é¢˜)

| ID | é—®é¢˜ç±»å‹ | æµ‹è¯•é—®é¢˜ |
|----|---------|---------|
| Q8 | äº‹å®æ€§ | äº§å“çš„æ ¸å¿ƒåŠŸèƒ½æ˜¯ä»€ä¹ˆï¼Ÿ |
| Q9 | æ“ä½œæ€§ | å¦‚ä½•åˆ›å»ºæ–°ç”¨æˆ·è´¦æˆ·ï¼Ÿ |
| Q10 | æ¯”è¾ƒæ€§ | å…è´¹ç‰ˆå’Œä»˜è´¹ç‰ˆæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ |
| Q11 | è§£é‡Šæ€§ | ä¸ºä»€ä¹ˆè¦å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Ÿ |
| Q12 | äº‹å®æ€§ | äº§å“çš„ç›®æ ‡ç”¨æˆ·æ˜¯è°ï¼Ÿ |
| Q13 | æ“ä½œæ€§ | å¦‚ä½•å‡çº§åˆ°ä»˜è´¹ç‰ˆï¼Ÿ |
| Q14 | äº‹å®æ€§ | äº§å“çš„ä»·æ ¼æ˜¯å¤šå°‘ï¼Ÿ |

##### DOC-3: å­¦æœ¯æ–‡æ¡£ (6ä¸ªé—®é¢˜)

| ID | é—®é¢˜ç±»å‹ | æµ‹è¯•é—®é¢˜ |
|----|---------|---------|
| Q15 | äº‹å®æ€§ | ç ”ç©¶çš„ä¸»è¦å‡è®¾æ˜¯ä»€ä¹ˆï¼Ÿ |
| Q16 | æ“ä½œæ€§ | å®éªŒæ–¹æ³•æ˜¯å¦‚ä½•è®¾è®¡çš„ï¼Ÿ |
| Q17 | æ¯”è¾ƒæ€§ | è¿™é¡¹ç ”ç©¶ä¸ä»¥å¾€ç ”ç©¶çš„ä¸åŒåœ¨å“ªï¼Ÿ |
| Q18 | è§£é‡Šæ€§ | ä¸ºä»€ä¹ˆé€‰æ‹©è¿™ç§ç ”ç©¶æ–¹æ³•ï¼Ÿ |
| Q19 | äº‹å®æ€§ | å®éªŒçš„ä¸»è¦ç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ |
| Q20 | è§£é‡Šæ€§ | ç ”ç©¶ç»“æœçš„æ„ä¹‰æ˜¯ä»€ä¹ˆï¼Ÿ |

#### 5.3 è¯„ä¼°æ ‡å‡†

**æ¯ä¸ªchunkçš„è¯„åˆ†**:
- âœ… **ç›¸å…³** (2åˆ†): chunkå†…å®¹ç›´æ¥å›ç­”é—®é¢˜æˆ–æä¾›å…³é”®ä¿¡æ¯
- âš ï¸ **éƒ¨åˆ†ç›¸å…³** (1åˆ†): chunkåŒ…å«ç›¸å…³å…³é”®è¯ä½†ä¿¡æ¯ä¸å®Œæ•´
- âŒ **ä¸ç›¸å…³** (0åˆ†): chunkä¸é—®é¢˜æ— å…³

**å‡†ç¡®ç‡è®¡ç®—**:
```
å‡†ç¡®ç‡ = (ç›¸å…³ç»“æœæ•° + 0.5 Ã— éƒ¨åˆ†ç›¸å…³ç»“æœæ•°) / æ€»ç»“æœæ•°
```

**è¯„ä¼°è¡¨æ ¼æ¨¡æ¿**:
```markdown
| é—®é¢˜ | Chunk1 | Chunk2 | Chunk3 | Chunk4 | Chunk5 | å¾—åˆ† | å‡†ç¡®ç‡ |
|------|--------|--------|--------|--------|--------|------|--------|
| Q1   | âœ…(2)  | âœ…(2)  | âš ï¸(1)  | âŒ(0)  | âœ…(2)  | 7    | 70%    |
| Q2   | âœ…(2)  | âœ…(2)  | âœ…(2)  | âš ï¸(1)  | âš ï¸(1)  | 8    | 80%    |
| ...  | ...    | ...    | ...    | ...    | ...    | ...  | ...    |

æœ€ç»ˆå‡†ç¡®ç‡ = (æ€»å¾—åˆ† / (20 Ã— 10)) Ã— 100%
```

#### 5.4 æ‰§è¡Œæ­¥éª¤

1. **å‡†å¤‡é˜¶æ®µ** (1å°æ—¶)
   - ä¸Šä¼ 3ä¸ªæµ‹è¯•æ–‡æ¡£åˆ°ç³»ç»Ÿ
   - ç­‰å¾…å‘é‡åŒ–å®Œæˆ
   - éªŒè¯æ–‡æ¡£çŠ¶æ€ä¸ºREADY

2. **æ‰§è¡Œé˜¶æ®µ** (2å°æ—¶)
   - å¯¹æ¯ä¸ªé—®é¢˜æ‰§è¡Œæ£€ç´¢
   - è®°å½•è¿”å›çš„Top-5 chunks
   - äººå·¥è¯„ä¼°æ¯ä¸ªchunkçš„ç›¸å…³æ€§

3. **åˆ†æé˜¶æ®µ** (1å°æ—¶)
   - è®¡ç®—æ€»ä½“å‡†ç¡®ç‡
   - åˆ†æå¤±è´¥æ¡ˆä¾‹
   - è¯†åˆ«æ”¹è¿›æ–¹å‘
   - æ’°å†™è¯„ä¼°æŠ¥å‘Š

#### 5.5 è¾“å‡ºæ–‡æ¡£

**ä¿å­˜ä½ç½®**: `docs/qa/assessments/3.2-quality-manual-{YYYYMMDD}.md`

**æŠ¥å‘Šå†…å®¹**:
```markdown
# Story 3.2 äººå·¥è´¨é‡è¯„ä¼°æŠ¥å‘Š

## è¯„ä¼°æ¦‚è¦
- æµ‹è¯•æ—¥æœŸ: {date}
- è¯„ä¼°äºº: {name}
- æµ‹è¯•æ–‡æ¡£: 3ä¸ª
- æµ‹è¯•é—®é¢˜: 20ä¸ª
- æ€»æ£€ç´¢ç»“æœ: 100ä¸ªchunks (20 Ã— 5)

## è¯„ä¼°ç»“æœ
- æ€»å¾—åˆ†: XX / 200
- å‡†ç¡®ç‡: XX%
- ç›®æ ‡: >= 85%
- **ç»“è®º**: âœ… é€šè¿‡ / âŒ æœªé€šè¿‡

## è¯¦ç»†è¯„åˆ†è¡¨
[å®Œæ•´çš„20Ã—5è¯„åˆ†è¡¨æ ¼]

## å¤±è´¥æ¡ˆä¾‹åˆ†æ
[åˆ—å‡ºå‡†ç¡®ç‡ < 50%çš„é—®é¢˜åŠåŸå› ]

## æ”¹è¿›å»ºè®®
1. ...
2. ...

## ç»“è®ºå’Œå»ºè®®
[æ˜¯å¦è¾¾æ ‡ï¼Œæ˜¯å¦éœ€è¦è°ƒä¼˜]
```

---

## ğŸ“ æµ‹è¯•æ‰§è¡Œè®¡åˆ’

### é˜¶æ®µ1: å¿«é€Ÿä¿®å¤ (å·²å®Œæˆ âœ…)

- âœ… ä¿®å¤å•å…ƒæµ‹è¯•å¤±è´¥ï¼ˆç»´åº¦é—®é¢˜ï¼‰
- âœ… å®ç°æŸ¥è¯¢å†…å®¹è„±æ•
- âœ… æ‰€æœ‰å•å…ƒæµ‹è¯•é€šè¿‡ï¼ˆ21/21ï¼‰

### é˜¶æ®µ2: å…³é”®éªŒè¯ (è¿›è¡Œä¸­ â³)

**ä¼˜å…ˆçº§æ’åº**:
1. ğŸ”´ **äººå·¥è´¨é‡è¯„ä¼°** (P0, 4å°æ—¶) - CRITICALï¼Œé˜»æ­¢ä¸Šçº¿
2. ğŸ”´ **é›†æˆæµ‹è¯•P0åœºæ™¯** (P0, 1å¤©) - éªŒè¯å®Œæ•´æµç¨‹
3. ğŸŸ¡ **æ€§èƒ½åŸºå‡†æµ‹è¯•** (P0, 2å°æ—¶) - å»ºç«‹åŸºçº¿

**é¢„è®¡å®Œæˆæ—¶é—´**: 1.5-2å¤©

### é˜¶æ®µ3: å®Œå–„è¦†ç›– (å¯é€‰)

- é›†æˆæµ‹è¯•P1åœºæ™¯
- æ›´å¤šæ€§èƒ½æµ‹è¯•åœºæ™¯
- æ•…éšœæ³¨å…¥æµ‹è¯•

---

## ğŸ¯ è´¨é‡é—¨æ§æ ‡å‡†

æ ¹æ® `docs/qa/gates/3.2-rag-vector-retrieval.yml`ï¼š

### PASS æ¡ä»¶
- âœ… æ‰€æœ‰P0å•å…ƒæµ‹è¯•é€šè¿‡
- âœ… äººå·¥è´¨é‡è¯„ä¼° >= 85%
- âœ… P95å»¶è¿Ÿ < 500ms
- âœ… æ— å®‰å…¨æ¼æ´
- âœ… é›†æˆæµ‹è¯•P0åœºæ™¯é€šè¿‡

### CONCERNS è§¦å‘æ¡ä»¶
- âš ï¸ P1æµ‹è¯•å¤±è´¥1-3ä¸ª
- âš ï¸ äººå·¥è´¨é‡è¯„ä¼° 80-85%
- âš ï¸ P95å»¶è¿Ÿ 500-800ms
- âš ï¸ ç¼“å­˜å‘½ä¸­ç‡ 20-30%

### FAIL è§¦å‘æ¡ä»¶
- âŒ ä»»ä½•P0æµ‹è¯•å¤±è´¥
- âŒ äººå·¥è´¨é‡è¯„ä¼° < 80%
- âŒ P95å»¶è¿Ÿ > 1ç§’
- âŒ å®‰å…¨æ¼æ´å‘ç°
- âŒ APIå¯†é’¥æ³„éœ²

---

## ğŸ“Š å½“å‰çŠ¶æ€æ€»ç»“

**å·²å®Œæˆ**: âœ… 50% (21/42)
- å•å…ƒæµ‹è¯•è¦†ç›–è‰¯å¥½
- åŸºç¡€åŠŸèƒ½éªŒè¯å®Œæˆ
- æŸ¥è¯¢å†…å®¹è„±æ•å·²å®ç°

**é˜»æ­¢ä¸Šçº¿**: ğŸ”´ 3é¡¹
1. äººå·¥è´¨é‡è¯„ä¼°æœªå®Œæˆ
2. é›†æˆæµ‹è¯•æœªå®ç°
3. æ€§èƒ½åŸºå‡†æµ‹è¯•æœªæ‰§è¡Œ

**å»ºè®®**: 
- ç«‹å³å®‰æ’äººå·¥è´¨é‡è¯„ä¼°ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰
- ä¸QAåä½œé…ç½®æµ‹è¯•ç¯å¢ƒ
- æ‰§è¡Œæ€§èƒ½åŸºå‡†æµ‹è¯•å»ºç«‹åŸºçº¿

**é¢„è®¡å®Œæˆæ—¶é—´**: 1.5-2å¤©
**å»ºè®®é‡æ–°å®¡æŸ¥æ—¶é—´**: 2025-01-10

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**æœ€åæ›´æ–°**: 2025-01-08  
**ç»´æŠ¤äºº**: Dev Agent (James)
