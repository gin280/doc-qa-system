# Risk Profile: Story 1.10 - Chat为中心的统一导航架构

**Date**: 2025-01-08  
**Reviewer**: Quinn (Test Architect)  
**Story ID**: 1.10  
**Epic**: 1 - 基础设施与用户认证

---

## 执行摘要

### 总体风险评估

- **识别风险总数**: 10
- **关键风险**: 0
- **高风险**: 1
- **中风险**: 4
- **低风险**: 5
- **整体风险分数**: 60/100 ⚠️

### 核心关注点

这是一个**重大架构重构**，涉及：
- 完全移除 Dashboard
- Next.js 路由结构重组
- 核心组件（ChatWithHistory）重构
- 认证保护逻辑迁移
- 用户流程根本性改变

**主要风险**: Next.js 路由组重构可能破坏现有功能，需要分阶段实施和充分测试。

---

## 关键风险需要立即关注

### 1. TECH-001: Next.js 路由组重构失败风险

**风险分数**: 6 (高风险 - 🟧 Orange)  
**概率**: Medium (2) - 路由组是成熟功能但需仔细迁移  
**影响**: High (3) - 失败会导致整个应用无法访问  

#### 详细描述

Story 要求创建新的路由组结构：
```
src/app/
├── (public)/    # 公开页面组
│   ├── layout.tsx
│   ├── page.tsx
│   ├── login/
│   └── register/
└── (app)/       # 认证保护页面组
    ├── layout.tsx
    ├── chat/
    ├── documents/
    └── settings/
```

这是一个全面的路由重组，涉及：
- 移动所有现有认证页面到新路由组
- 重构认证保护逻辑到 `(app)/layout.tsx`
- 可能影响中间件和 API 路由
- 所有内部链接需要更新

#### 潜在后果

**如果失败可能导致**:
- ❌ 所有受保护页面无法访问（500/404 错误）
- ❌ 认证重定向循环
- ❌ 中间件匹配失败
- ❌ 部分页面丢失认证保护
- ❌ 用户会话管理异常

#### 影响的组件

- `src/app/(app)/layout.tsx` - 新的认证保护布局
- `src/app/chat/page.tsx` → `src/app/(app)/chat/page.tsx`
- `src/app/settings/page.tsx` → `src/app/(app)/settings/page.tsx`
- `src/middleware.ts` - 可能需要更新路由匹配规则
- 所有内部导航链接和重定向

#### 缓解策略（优先级：P0）

**1. 分阶段实施计划**:

```
Phase 1: 创建新结构但保持旧路由（1天）
├── 创建 (app) 和 (public) 路由组
├── 在新位置创建页面副本
└── 两套路由并存，新路由通过 feature flag 控制

Phase 2: 逐步切换流量（2天）
├── Dev 环境完整测试
├── Staging 环境验证
└── Production 10% → 50% → 100%

Phase 3: 清理旧路由（1天）
├── 确认新路由稳定
├── 删除旧路由文件
└── 清理 feature flag
```

**2. Feature Flag 实现**:

```typescript
// lib/feature-flags.ts
export const useNewNavigation = () => {
  return process.env.NEXT_PUBLIC_NEW_NAV === 'true' || 
         process.env.NODE_ENV === 'development';
};

// app/(app)/layout.tsx
export default async function AppLayout({ children }) {
  const session = await auth();
  
  if (!session?.user) {
    redirect('/login');
  }

  // 可以快速切换回旧导航
  if (!useNewNavigation()) {
    redirect('/dashboard'); // fallback
  }

  return (
    <>
      <AppHeader />
      <main className="flex-1">{children}</main>
    </>
  );
}
```

**3. 完整测试清单**:

```
路由测试（P0 - 必须通过）:
□ 所有新路由可访问且返回正确内容
□ 未登录访问 /chat → 重定向到 /login
□ 已登录访问 / → 重定向到 /chat
□ 已登录访问旧 /dashboard → 重定向到 /chat
□ 直接 URL 访问所有页面正常工作
□ 浏览器后退/前进按钮正常工作

认证测试（P0 - 必须通过）:
□ 所有 (app) 路由都有认证保护
□ 未授权访问被正确拦截
□ 登录后正确跳转到原始目标
□ 会话过期后正确处理
□ 多标签页认证状态同步

中间件测试（P1）:
□ middleware 正确匹配新路由结构
□ API 路由不受影响
□ 静态资源访问正常
```

**4. 回滚计划**:

```bash
# 准备快速回滚脚本
# scripts/rollback-navigation.sh

#!/bin/bash
echo "Rolling back to old navigation..."

# 方案A: Feature flag 回滚（推荐）
export NEXT_PUBLIC_NEW_NAV=false
npm run build
npm run start

# 方案B: Git 回滚
# git revert <commit-hash>
# git push origin main

echo "Rollback complete. Verify at /dashboard"
```

**5. 监控和告警**:

```typescript
// 部署后监控指标
const metricsToMonitor = {
  errorRate: {
    threshold: '> 5%',
    action: 'Immediate rollback',
  },
  pageLoadTime: {
    threshold: '> 3s',
    action: 'Investigate and fix',
  },
  authFailures: {
    threshold: '> 10/min',
    action: 'Check auth logic',
  },
  404Rate: {
    threshold: '> 2%',
    action: 'Check routing config',
  },
};
```

#### 剩余风险

**即使完全实施缓解策略，仍存在**:
- Medium - 边界情况可能在生产环境才暴露
- 用户在迁移期间可能遇到短暂的路由不一致
- 缓存和 CDN 可能导致旧路由暂时仍可访问

**建议**: 在低流量时段（如周末）部署，准备好技术团队快速响应。

---

## 中等风险需要关注

### 2. TECH-002: 组件依赖关系破坏

**风险分数**: 4 (中风险 - 🟨 Yellow)  
**概率**: Medium (2)  
**影响**: Medium (2)

#### 详细描述

Story 要求移除 `ChatWithHistory` 组件的内部 Header：
- 当前: Chat 组件自带 Header（Logo、Export、New 按钮）
- 目标: 移除内部 Header，依赖全局 AppHeader

**风险点**:
- 其他组件可能依赖 ChatWithHistory 的特定结构
- 布局和样式可能需要大幅调整
- 功能按钮（Export、New）需要重新定位
- 可能破坏现有的 CSS 或响应式设计

#### 缓解策略

**1. 创建组件依赖图**:
```bash
# 使用工具找出所有引用
grep -r "ChatWithHistory" src/
grep -r "from.*chat/ChatWithHistory" src/
```

**2. 渐进式重构**:
```typescript
// 步骤1: 保持接口不变，内部重构
export function ChatWithHistory({ initialDocumentId }: Props) {
  // 保留所有 props 接口
  // 内部逐步移除 Header
}

// 步骤2: 添加单元测试锁定行为
describe('ChatWithHistory', () => {
  it('should render without internal header', () => {
    const { container } = render(<ChatWithHistory />);
    expect(container.querySelector('[data-testid="chat-header"]')).toBeNull();
  });
  
  it('should still render chat input and messages', () => {
    // 验证核心功能未受影响
  });
});
```

**3. 功能迁移清单**:
```
需要从 ChatWithHistory 迁移的功能:
□ Logo → 移到 AppHeader
□ Export 按钮 → 移到... (待定位置)
□ New Conversation 按钮 → 移到侧边栏顶部
□ 用户菜单 → 移到 AppHeader 的 UserMenu
```

**测试需求**:
- 单元测试: ChatWithHistory 在新布局下正常渲染
- 集成测试: 端到端对话流程（创建、发送、切换文档）
- 视觉回归测试: 截图对比确保 UI 无破坏

---

### 3. BUS-001: 用户流程中断导致流失

**风险分数**: 4 (中风险 - 🟨 Yellow)  
**概率**: Medium (2)  
**影响**: Medium (2)

#### 详细描述

**当前流程**: 登录 → Dashboard → 点击"开始对话" → Chat  
**新流程**: 登录 → Chat（直接）

虽然新流程更简洁，但老用户可能：
- 不知道 Dashboard 去哪了
- 习惯性想查看统计数据
- 收藏的 `/dashboard` 链接失效
- 感到突然和困惑

#### 用户影响分析

**受影响用户群**:
1. **老用户** (高影响) - 需要重新学习导航
2. **新用户** (无影响) - 直接学习新导航
3. **重度用户** (中影响) - 可能依赖 Dashboard 的某些功能

**潜在业务影响**:
- 短期: 用户困惑，支持请求增加
- 中期: 如果引导得当，用户体验应该提升
- 长期: 符合产品定位，用户路径更高效

#### 缓解策略

**1. 首次登录引导**:

```typescript
// components/onboarding/FirstLoginGuide.tsx
export function FirstLoginGuide() {
  const [showGuide, setShowGuide] = useState(false);
  
  useEffect(() => {
    // 检查用户是否看过新导航引导
    const hasSeenGuide = localStorage.getItem('seen_new_nav_guide');
    if (!hasSeenGuide) {
      setShowGuide(true);
    }
  }, []);

  return (
    <Dialog open={showGuide} onOpenChange={setShowGuide}>
      <DialogContent>
        <DialogHeader>
          <DialogTitle>导航升级 🎉</DialogTitle>
          <DialogDescription>
            我们优化了产品结构，让您更快开始工作！
          </DialogDescription>
        </DialogHeader>
        
        <div className="space-y-4">
          <div className="flex items-start gap-3">
            <MessageSquare className="h-5 w-5 text-primary" />
            <div>
              <h4 className="font-medium">直达对话</h4>
              <p className="text-sm text-muted-foreground">
                登录后直接进入 Chat，无需点击"开始对话"
              </p>
            </div>
          </div>
          
          <div className="flex items-start gap-3">
            <FileText className="h-5 w-5 text-primary" />
            <div>
              <h4 className="font-medium">文档管理</h4>
              <p className="text-sm text-muted-foreground">
                点击顶部"文档"按钮管理您的文档
              </p>
            </div>
          </div>
          
          <div className="flex items-start gap-3">
            <Settings className="h-5 w-5 text-primary" />
            <div>
              <h4 className="font-medium">账户设置</h4>
              <p className="text-sm text-muted-foreground">
                点击右上角头像访问设置
              </p>
            </div>
          </div>
        </div>
        
        <DialogFooter>
          <Button onClick={() => {
            localStorage.setItem('seen_new_nav_guide', 'true');
            setShowGuide(false);
          }}>
            开始使用
          </Button>
        </DialogFooter>
      </DialogContent>
    </Dialog>
  );
}
```

**2. 旧 URL 重定向 + 提示**:

```typescript
// middleware.ts 或 app/dashboard/page.tsx
export default async function DashboardRedirect() {
  // 重定向但保留消息
  redirect('/chat?from=dashboard');
}

// app/(app)/chat/page.tsx
export default async function ChatPage({ searchParams }) {
  const fromDashboard = searchParams.from === 'dashboard';
  
  return (
    <>
      {fromDashboard && (
        <Alert className="mb-4">
          <Info className="h-4 w-4" />
          <AlertDescription>
            我们优化了导航！现在登录后直接进入对话界面。
            您的文档可以在顶部"文档"菜单中管理。
          </AlertDescription>
        </Alert>
      )}
      <ChatWithHistory />
    </>
  );
}
```

**3. 逐步推出策略**:

```
选项 A: 全量推出（推荐）
- 优点: 简单，所有用户体验一致
- 缺点: 可能有短期混乱
- 适用: 产品用户量不大时

选项 B: A/B 测试
- 50% 用户看到新导航
- 50% 用户保持旧导航
- 监控指标对比后决定
- 适用: 需要数据验证时

选项 C: 新用户先行
- 新注册用户使用新导航
- 老用户保持旧导航并逐步引导迁移
- 适用: 用户基数大，需平稳过渡时
```

**4. 沟通计划**:

```
T-3天: 邮件/公告预告导航变化
T-0天: 部署新导航
      - 首次登录引导 Dialog
      - Dashboard 重定向提示
      - 帮助文档更新
T+1周: 收集用户反馈
T+2周: 根据反馈微调
T+4周: 评估成功指标
```

#### 监控指标

```typescript
// 跟踪的关键指标
const metricsToTrack = {
  // 负面指标（希望不增加）
  bounceRate: '首次访问跳出率',
  supportTickets: '关于导航的支持请求',
  dashboardAttempts: '尝试访问 /dashboard 的次数',
  
  // 正面指标（希望提升）
  timeToFirstMessage: '登录到首次发送消息的时间',
  dailyActiveUsers: '日活用户数',
  sessionDuration: '平均会话时长',
};
```

---

### 4. OPS-001: 大规模重构导致回滚困难

**风险分数**: 4 (中风险 - 🟨 Yellow)  
**概率**: Medium (2)  
**影响**: Medium (2)

#### 详细描述

这个 Story 涉及：
- 删除整个 `/dashboard` 目录
- 重组 `/app` 目录结构
- 修改多个核心组件
- 更新认证逻辑
- 改变默认路由

**如果出问题**:
- 不能简单地"撤销一个文件"
- 需要回滚整个特性分支
- 可能需要紧急热修复
- 用户可能已经适应新流程

#### 缓解策略

**1. Git 策略**:

```bash
# 使用 feature branch 开发
git checkout -b feature/chat-centric-navigation

# 每个 AC 一个 commit
git commit -m "AC1: Remove dashboard and set chat as default"
git commit -m "AC2: Create unified AppHeader component"
git commit -m "AC3: Implement simplified UserMenu"
# ... 以此类推

# 合并前 squash commits（保持主分支清晰）
git rebase -i main

# 保留回滚点标签
git tag -a v1.9-before-nav-refactor -m "Before navigation refactor"
```

**2. Feature Flag 实现（关键）**:

```typescript
// lib/feature-flags.ts
export interface FeatureFlags {
  newNavigation: boolean;
}

export function getFeatureFlags(): FeatureFlags {
  return {
    newNavigation: process.env.NEXT_PUBLIC_NEW_NAV === 'true',
  };
}

// 在关键位置使用
// app/page.tsx
export default async function Home() {
  const session = await auth();
  const flags = getFeatureFlags();
  
  if (session?.user) {
    if (flags.newNavigation) {
      redirect('/chat');
    } else {
      redirect('/dashboard'); // 旧行为
    }
  }
  
  return <HeroSection />;
}
```

**3. 分批部署计划**:

```
阶段 1: Dev 环境（完整测试）
- 时间: 2天
- 目标: 发现所有明显问题
- 测试: 手动 + 自动化

阶段 2: Staging 环境（模拟生产）
- 时间: 1天
- 目标: 验证部署流程和性能
- 测试: 完整回归测试

阶段 3: Production 灰度发布
- 10% 流量: 2小时监控
- 50% 流量: 4小时监控
- 100% 流量: 持续监控24小时

阶段 4: 稳定期
- 72小时密切监控
- 准备好随时回滚
```

**4. 回滚检查清单**:

```markdown
## 回滚预案

### 触发条件（任一满足即回滚）
- [ ] 错误率 > 5%
- [ ] 页面加载时间 > 5秒
- [ ] 认证失败率 > 2%
- [ ] 404 错误 > 10/分钟
- [ ] 用户投诉 > 20条/小时

### 回滚步骤（15分钟内完成）
1. [ ] 确认需要回滚（由 on-call engineer 决定）
2. [ ] 通知团队（Slack #incidents）
3. [ ] 执行回滚:
   
   方案 A (推荐): Feature Flag
   ```bash
   # Vercel 环境变量
   vercel env add NEXT_PUBLIC_NEW_NAV false production
   vercel redeploy --force
   ```
   
   方案 B: Git Revert
   ```bash
   git revert <merge-commit-hash>
   git push origin main
   # 触发自动部署
   ```

4. [ ] 验证回滚成功
   - 访问 /dashboard 正常
   - 登录后跳转到 dashboard
   - 错误率恢复正常

5. [ ] 事后分析（24小时内）
   - 记录失败原因
   - 更新测试用例
   - 修复问题后重新部署
```

**5. 增强监控**:

```typescript
// 部署后监控 Dashboard
import { Monitoring } from '@/lib/monitoring';

// 关键指标
const criticalMetrics = {
  errorRate: Monitoring.track('error_rate'),
  pageLoadTime: Monitoring.track('page_load_time'),
  authSuccess: Monitoring.track('auth_success_rate'),
  routingErrors: Monitoring.track('routing_404_rate'),
};

// 告警规则
const alerts = [
  {
    metric: 'error_rate',
    threshold: 0.05, // 5%
    action: 'page_oncall',
    message: 'Error rate exceeded 5% after navigation refactor',
  },
  {
    metric: 'routing_404_rate',
    threshold: 10,
    window: '1min',
    action: 'slack_alert',
    message: 'High 404 rate detected - possible routing issue',
  },
];
```

---

## 低风险（需要注意但不阻塞）

### 5. TECH-003: 认证保护逻辑迁移风险

**风险分数**: 3 (低风险 - 🟩 Green)  
**概率**: Low (1) | **影响**: High (3)

**描述**: 认证逻辑从各页面移到 `(app)/layout.tsx` 可能产生边界情况

**缓解策略**:
- 使用现有的 `auth()` 函数，不重新实现
- 添加认证边界测试
- 验证所有受保护路由

---

### 6. DATA-001: 现有对话历史链接失效

**风险分数**: 3 (低风险 - 🟩 Green)  
**概率**: High (3) | **影响**: Low (1)

**描述**: 用户书签或分享的 `/dashboard` 链接会失效

**缓解策略**:
```typescript
// middleware.ts 或 next.config.mjs
{
  source: '/dashboard',
  destination: '/chat',
  permanent: true, // 301 重定向
}
```

---

### 7. PERF-001: 首次访问检查文档造成延迟

**风险分数**: 3 (低风险 - 🟩 Green)  
**概率**: High (3) | **影响**: Low (1)

**描述**: EmptyState 需要异步检查用户是否有文档

**缓解策略**:
```typescript
// 使用 React Query 缓存结果
const { data: hasDocuments } = useQuery({
  queryKey: ['user-documents-exists'],
  queryFn: () => fetch('/api/documents/exists'),
  staleTime: 5 * 60 * 1000, // 5分钟缓存
});
```

---

### 8. OPS-002: 缺少用户通知机制

**风险分数**: 3 (低风险 - 🟩 Green)  
**概率**: High (3) | **影响**: Low (1)

**缓解策略**: 实现首次登录引导（已在 BUS-001 中详述）

---

### 9. SEC-001: 认证边界测试不足

**风险分数**: 3 (低风险 - 🟩 Green)  
**概率**: Low (1) | **影响**: High (3)

**缓解策略**: 添加完整的认证测试套件

---

### 10. BUS-002: Dashboard 功能丢失

**风险分数**: 1 (最小风险 - 🟦 Blue)  
**概率**: Low (1) | **影响**: Low (1)

**描述**: Dashboard 使用率低，丢失影响小

---

## 风险基础的测试策略

### P0 测试场景（部署前必须通过）

#### 1. 路由和认证核心测试

```typescript
// tests/integration/routing-auth.test.ts
describe('Navigation Refactor - Core Routing', () => {
  describe('Authenticated Users', () => {
    it('should redirect to /chat when accessing root', async () => {
      const session = await signIn('user@example.com');
      const response = await fetch('/');
      expect(response.url).toContain('/chat');
    });

    it('should access /chat directly', async () => {
      const session = await signIn('user@example.com');
      const response = await fetch('/chat');
      expect(response.status).toBe(200);
    });

    it('should access /documents with AppHeader', async () => {
      const session = await signIn('user@example.com');
      const response = await fetch('/documents');
      expect(response.status).toBe(200);
      // 验证 AppHeader 存在
    });

    it('should access /settings with AppHeader', async () => {
      const session = await signIn('user@example.com');
      const response = await fetch('/settings');
      expect(response.status).toBe(200);
    });
  });

  describe('Unauthenticated Users', () => {
    it('should redirect to /login when accessing /chat', async () => {
      const response = await fetch('/chat');
      expect(response.url).toContain('/login');
    });

    it('should redirect to /login when accessing /documents', async () => {
      const response = await fetch('/documents');
      expect(response.url).toContain('/login');
    });

    it('should show landing page when accessing root', async () => {
      const response = await fetch('/');
      expect(response.status).toBe(200);
      // 验证 HeroSection 存在
    });
  });

  describe('Dashboard Deprecation', () => {
    it('should redirect /dashboard to /chat', async () => {
      const session = await signIn('user@example.com');
      const response = await fetch('/dashboard');
      expect(response.url).toContain('/chat');
      expect(response.url).toContain('from=dashboard');
    });

    it('should show migration notice when coming from dashboard', async () => {
      const session = await signIn('user@example.com');
      const { container } = render(<ChatPage searchParams={{ from: 'dashboard' }} />);
      expect(container.textContent).toContain('我们优化了导航');
    });
  });
});
```

#### 2. 核心功能完整性测试

```typescript
// tests/integration/chat-functionality.test.ts
describe('Chat Functionality After Refactor', () => {
  it('should create new conversation', async () => {
    // 验证对话创建功能未受影响
  });

  it('should send message and receive response', async () => {
    // 验证消息发送功能未受影响
  });

  it('should switch documents from sidebar', async () => {
    // 验证文档切换功能未受影响
  });

  it('should load conversation history', async () => {
    // 验证历史记录加载未受影响
  });
});
```

#### 3. Empty State 测试

```typescript
// tests/unit/EmptyState.test.tsx
describe('EmptyState Component', () => {
  it('should show upload guide for users with no documents', async () => {
    mockFetch('/api/documents', { documents: [] });
    const { getByText } = render(<EmptyState />);
    expect(getByText('上传文档')).toBeInTheDocument();
  });

  it('should show example questions for users with documents', async () => {
    mockFetch('/api/documents', { documents: [{ id: 1 }] });
    const { getByText } = render(<EmptyState />);
    expect(getByText(/示例问题/)).toBeInTheDocument();
  });
});
```

### P1 测试场景（重要但非阻塞）

#### 4. AppHeader 功能测试

```typescript
describe('AppHeader Component', () => {
  it('should render logo, navigation, and user menu');
  it('should highlight active navigation item');
  it('should navigate to /documents when clicking 文档');
  it('should navigate to /chat when clicking logo');
});
```

#### 5. UserMenu 功能测试

```typescript
describe('UserMenu Component', () => {
  it('should show user info in dropdown');
  it('should navigate to /settings when clicking 账户设置');
  it('should toggle theme');
  it('should sign out and redirect to /login');
});
```

#### 6. 浏览器导航测试

```typescript
describe('Browser Navigation', () => {
  it('should handle back button correctly');
  it('should handle forward button correctly');
  it('should handle page refresh correctly');
  it('should preserve state across navigation');
});
```

---

## 风险缓解时间线

```
T-5天: 准备阶段
├── 实现 feature flag 系统
├── 创建组件依赖图
└── 准备测试套件

T-3天: 开发阶段
├── 实施分阶段路由迁移
├── 重构 Chat 组件
└── 创建 AppHeader 和 UserMenu

T-1天: 测试阶段
├── 完整回归测试
├── 性能基准测试
└── 认证边界测试

T-0天: 部署阶段
├── Dev 环境部署（完整验证）
├── Staging 环境部署（模拟生产）
└── Production 灰度发布（10% → 50% → 100%）

T+1天: 监控阶段
├── 密切监控错误率和性能
├── 收集用户反馈
└── 准备随时回滚

T+7天: 稳定期
├── 评估成功指标
├── 清理 feature flag
└── 文档更新
```

---

## 推荐的质量门控

### 🚫 阻塞部署的条件

- [ ] 任何 P0 测试失败
- [ ] 路由测试覆盖率 < 100%
- [ ] 认证测试覆盖率 < 100%
- [ ] Feature flag 未实现
- [ ] 回滚计划未文档化

### ⚠️ 需要评审的条件

- [ ] P1 测试失败 > 10%
- [ ] 代码覆盖率 < 80%
- [ ] 性能基准测试有回归
- [ ] 无首次登录引导

### ✅ 可以部署的条件

- [ ] 所有 P0 测试通过
- [ ] Feature flag 可用
- [ ] 监控和告警配置完成
- [ ] 回滚预案已准备
- [ ] 团队已充分了解变更

---

## 成功标准

### 部署后 24 小时内

- ✅ 错误率 < 1%
- ✅ 页面加载时间 < 2秒
- ✅ 认证成功率 > 99%
- ✅ 404 错误 < 1%
- ✅ 无需回滚

### 部署后 1 周内

- ✅ 新用户首次消息转化率 > 80%
- ✅ 老用户适应新导航（跳出率无显著增加）
- ✅ 支持请求无显著增加
- ✅ 用户满意度无下降

### 部署后 1 个月内

- ✅ 用户首次上传文档转化率提升 20%
- ✅ 平均会话时长增加
- ✅ 对导航的困惑反馈减少
- ✅ 整体产品使用率提升

---

## 总结与建议

### 🎯 核心建议

1. **分阶段实施是关键** - 不要一次性切换，使用 feature flag 逐步推出
2. **充分测试** - 路由和认证是核心，必须达到 100% 测试覆盖
3. **做好回滚准备** - 15分钟内能回滚是部署的前提
4. **用户沟通** - 首次登录引导和重定向提示能大幅降低用户困惑
5. **监控告警** - 部署后 24 小时密切监控，随时准备响应

### ⚠️ 注意事项

- 这是一个**高风险**的架构重构，不建议在高峰期部署
- 确保所有团队成员理解变更范围和回滚流程
- 预留足够的时间处理边界情况和用户反馈
- 考虑在低流量时段（如周末）部署

### ✅ 如果做好准备，这个重构是值得的

- 符合产品定位（AI 问答为核心）
- 简化用户路径，提升效率
- 学习行业最佳实践（ChatGPT、Claude）
- 长期可维护性提升

---

**风险评估完成日期**: 2025-01-08  
**下一步**: 实施缓解策略并创建详细的测试计划

**引用此评估**:  
Risk profile: docs/qa/assessments/1.10-risk-20250108.md

