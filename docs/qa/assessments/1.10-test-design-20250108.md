# Test Design: Story 1.10 - Chatä¸ºä¸­å¿ƒçš„ç»Ÿä¸€å¯¼èˆªæ¶æ„

**Date**: 2025-01-08  
**Test Architect**: Quinn  
**Story ID**: 1.10  
**Epic**: 1 - åŸºç¡€è®¾æ–½ä¸ç”¨æˆ·è®¤è¯

---

## æµ‹è¯•ç­–ç•¥æ¦‚è§ˆ

### æµ‹è¯•å¤æ‚åº¦è¯„ä¼°

**Story ç‰¹æ€§**:
- âœ… é‡å¤§æ¶æ„é‡æ„ï¼ˆè·¯ç”±é‡ç»„ï¼‰
- âœ… å¤šä¸ªæ ¸å¿ƒç»„ä»¶ä¿®æ”¹
- âœ… è®¤è¯é€»è¾‘è¿ç§»
- âœ… ç”¨æˆ·æµç¨‹æ ¹æœ¬æ€§æ”¹å˜
- âœ… é«˜é£é™©ï¼ˆé£é™©åˆ†æ•°: 6ï¼‰

**æµ‹è¯•ç­–ç•¥**: **å…¨é¢æµ‹è¯• + é£é™©é©±åŠ¨ä¼˜å…ˆçº§**

### æµ‹è¯•åœºæ™¯ç»Ÿè®¡

- **æ€»æµ‹è¯•åœºæ™¯**: 38
- **Unit æµ‹è¯•**: 12 (32%)
- **Integration æµ‹è¯•**: 16 (42%)
- **E2E æµ‹è¯•**: 10 (26%)

**ä¼˜å…ˆçº§åˆ†å¸ƒ**:
- **P0**: 18 åœºæ™¯ (47%) - å¿…é¡»é€šè¿‡æ‰èƒ½éƒ¨ç½²
- **P1**: 12 åœºæ™¯ (32%) - é‡è¦ä½†éé˜»å¡
- **P2**: 8 åœºæ™¯ (21%) - å»ºè®®å®Œæˆ

---

## æŒ‰éªŒæ”¶æ ‡å‡†çš„æµ‹è¯•åœºæ™¯

### AC1: ç§»é™¤Dashboardï¼ŒChatæˆä¸ºé»˜è®¤é¦–é¡µ

#### åœºæ™¯ 1.10-INT-001: å·²ç™»å½•ç”¨æˆ·è®¿é—®æ ¹è·¯å¾„é‡å®šå‘åˆ° /chat

**Level**: Integration  
**Priority**: P0  
**Requirement**: AC1 - ç™»å½•æˆåŠŸåç›´æ¥è·³è½¬åˆ° /chat

**æµ‹è¯•åœºæ™¯**:
```
Given: ç”¨æˆ·å·²æˆåŠŸç™»å½•
When: ç”¨æˆ·è®¿é—®æ ¹è·¯å¾„ "/"
Then: åº”è¯¥é‡å®šå‘åˆ° "/chat"
And: Chat é¡µé¢æ­£å¸¸åŠ è½½
```

**å®ç°æç¤º**:
```typescript
// tests/integration/navigation-refactor.test.ts
describe('AC1: Chat as Default Home', () => {
  it('should redirect authenticated user from root to /chat', async () => {
    const session = await signIn('user@example.com');
    const response = await fetch('/');
    
    expect(response.url).toContain('/chat');
    expect(response.status).toBe(200);
  });
});
```

**é£é™©è¦†ç›–**: TECH-001ï¼ˆè·¯ç”±é‡æ„ï¼‰

---

#### åœºæ™¯ 1.10-INT-002: ç™»å½•æˆåŠŸåç›´æ¥è·³è½¬åˆ° /chat

**Level**: Integration  
**Priority**: P0  
**Requirement**: AC1 - ç™»å½•æˆåŠŸåç›´æ¥è·³è½¬

**æµ‹è¯•åœºæ™¯**:
```
Given: ç”¨æˆ·åœ¨ç™»å½•é¡µé¢
When: ç”¨æˆ·è¾“å…¥æ­£ç¡®çš„å‡­æ®å¹¶ç™»å½•
Then: åº”è¯¥é‡å®šå‘åˆ° "/chat"
And: ä¸ç»è¿‡ "/dashboard"
```

**å®ç°æç¤º**:
```typescript
it('should redirect to /chat after successful login', async () => {
  await page.goto('/login');
  await page.fill('[name="email"]', 'user@example.com');
  await page.fill('[name="password"]', 'password123');
  await page.click('button[type="submit"]');
  
  await page.waitForURL('**/chat');
  expect(page.url()).toContain('/chat');
});
```

**é£é™©è¦†ç›–**: BUS-001ï¼ˆç”¨æˆ·æµç¨‹ä¸­æ–­ï¼‰

---

#### åœºæ™¯ 1.10-INT-003: æ³¨å†ŒæˆåŠŸåç›´æ¥è·³è½¬åˆ° /chat

**Level**: Integration  
**Priority**: P0  
**Requirement**: AC1 - æ³¨å†ŒæˆåŠŸåç›´æ¥è·³è½¬

**æµ‹è¯•åœºæ™¯**:
```
Given: æ–°ç”¨æˆ·åœ¨æ³¨å†Œé¡µé¢
When: ç”¨æˆ·å®Œæˆæ³¨å†Œæµç¨‹
Then: åº”è¯¥é‡å®šå‘åˆ° "/chat"
And: æ˜¾ç¤ºé¦–æ¬¡è®¿é—®å¼•å¯¼ï¼ˆå¦‚æœæ²¡æœ‰æ–‡æ¡£ï¼‰
```

**å®ç°æç¤º**:
```typescript
it('should redirect to /chat after successful registration', async () => {
  await page.goto('/register');
  await fillRegistrationForm();
  await page.click('button[type="submit"]');
  
  await page.waitForURL('**/chat');
  expect(page.url()).toContain('/chat');
  
  // éªŒè¯é¦–æ¬¡è®¿é—®å¼•å¯¼
  const welcomeText = await page.textContent('h2');
  expect(welcomeText).toContain('æ¬¢è¿ä½¿ç”¨ DocQA');
});
```

---

#### åœºæ™¯ 1.10-INT-004: /dashboard è·¯ç”±è¿”å› 404 æˆ–é‡å®šå‘

**Level**: Integration  
**Priority**: P0  
**Requirement**: AC1 - åˆ é™¤ /dashboard è·¯ç”±

**æµ‹è¯•åœºæ™¯**:
```
Given: ç”¨æˆ·å·²ç™»å½•
When: ç”¨æˆ·è®¿é—® "/dashboard"
Then: åº”è¯¥é‡å®šå‘åˆ° "/chat?from=dashboard"
Or: è¿”å› 404 é”™è¯¯
```

**å®ç°æç¤º**:
```typescript
it('should redirect /dashboard to /chat with migration notice', async () => {
  const session = await signIn('user@example.com');
  const response = await fetch('/dashboard');
  
  expect(response.url).toContain('/chat');
  expect(response.url).toContain('from=dashboard');
  
  // éªŒè¯è¿ç§»æç¤º
  const html = await response.text();
  expect(html).toContain('æˆ‘ä»¬ä¼˜åŒ–äº†å¯¼èˆª');
});
```

**é£é™©è¦†ç›–**: DATA-001ï¼ˆç°æœ‰é“¾æ¥å¤±æ•ˆï¼‰

---

#### åœºæ™¯ 1.10-E2E-001: Chat é¡µé¢é¦–æ¬¡è®¿é—®å‹å¥½ï¼ˆæ— æ–‡æ¡£ï¼‰

**Level**: E2E  
**Priority**: P0  
**Requirement**: AC1, AC4 - Chat é¡µé¢ä¼˜åŒ–ä¸ºé¦–æ¬¡è®¿é—®å‹å¥½

**æµ‹è¯•åœºæ™¯**:
```
Given: æ–°ç”¨æˆ·é¦–æ¬¡ç™»å½•ä¸”æ²¡æœ‰ä¸Šä¼ æ–‡æ¡£
When: ç”¨æˆ·åˆ°è¾¾ Chat é¡µé¢
Then: åº”è¯¥æ˜¾ç¤º"æ¬¢è¿ä½¿ç”¨ DocQA"å¼•å¯¼ç•Œé¢
And: æ˜¾ç¤º"ä¸Šä¼ æ–‡æ¡£"å¤§æŒ‰é’®
And: æ˜¾ç¤ºæ”¯æŒçš„æ–‡ä»¶æ ¼å¼è¯´æ˜
```

**å®ç°æç¤º**:
```typescript
it('should show upload guide for first-time users with no documents', async () => {
  // æ¸…ç©ºç”¨æˆ·æ–‡æ¡£
  await clearUserDocuments('newuser@example.com');
  
  await loginAs('newuser@example.com');
  await page.goto('/chat');
  
  await expect(page.locator('h2')).toContainText('æ¬¢è¿ä½¿ç”¨ DocQA');
  await expect(page.locator('button')).toContainText('ä¸Šä¼ æ–‡æ¡£');
  await expect(page.locator('text=æ”¯æŒ PDFã€Word')).toBeVisible();
});
```

**é£é™©è¦†ç›–**: BUS-001ï¼ˆç”¨æˆ·æµç¨‹ä¸­æ–­ï¼‰

---

### AC2: åˆ›å»ºç»Ÿä¸€çš„AppHeaderç»„ä»¶

#### åœºæ™¯ 1.10-UNIT-001: AppHeader ç»„ä»¶æ¸²æŸ“æµ‹è¯•

**Level**: Unit  
**Priority**: P0  
**Requirement**: AC2 - AppHeader åŒ…å«æ­£ç¡®å…ƒç´ 

**æµ‹è¯•åœºæ™¯**:
```
Given: AppHeader ç»„ä»¶è¢«æ¸²æŸ“
When: ç»„ä»¶åŠ è½½å®Œæˆ
Then: åº”è¯¥æ˜¾ç¤º Logo
And: åº”è¯¥æ˜¾ç¤º"æ–‡æ¡£"å¯¼èˆªé“¾æ¥
And: åº”è¯¥æ˜¾ç¤ºç”¨æˆ·èœå•
```

**å®ç°æç¤º**:
```typescript
// tests/unit/layout/AppHeader.test.tsx
describe('AppHeader Component', () => {
  it('should render logo, navigation, and user menu', () => {
    const { getByRole, getByText } = render(
      <SessionProvider session={mockSession}>
        <AppHeader />
      </SessionProvider>
    );
    
    expect(getByRole('link', { name: /logo/i })).toBeInTheDocument();
    expect(getByText('æ–‡æ¡£')).toBeInTheDocument();
    expect(getByRole('button', { name: /user menu/i })).toBeInTheDocument();
  });
});
```

---

#### åœºæ™¯ 1.10-UNIT-002: AppHeader Logo ç‚¹å‡»è·³è½¬åˆ° /chat

**Level**: Unit  
**Priority**: P1  
**Requirement**: AC2 - Logo ç‚¹å‡»å›åˆ° Chat

**æµ‹è¯•åœºæ™¯**:
```
Given: ç”¨æˆ·åœ¨ä»»æ„è®¤è¯é¡µé¢
When: ç”¨æˆ·ç‚¹å‡» AppHeader ä¸­çš„ Logo
Then: åº”è¯¥å¯¼èˆªåˆ° "/chat"
```

**å®ç°æç¤º**:
```typescript
it('should navigate to /chat when logo is clicked', async () => {
  const { getByRole } = render(<AppHeader />);
  const logoLink = getByRole('link', { name: /logo/i });
  
  expect(logoLink).toHaveAttribute('href', '/chat');
});
```

---

#### åœºæ™¯ 1.10-UNIT-003: AppHeader "æ–‡æ¡£"å¯¼èˆªé«˜äº®

**Level**: Unit  
**Priority**: P1  
**Requirement**: AC2 - å½“å‰é¡µé¢å¯¼èˆªé«˜äº®

**æµ‹è¯•åœºæ™¯**:
```
Given: ç”¨æˆ·åœ¨ /documents é¡µé¢
When: AppHeader æ¸²æŸ“
Then: "æ–‡æ¡£"æŒ‰é’®åº”è¯¥æœ‰ active æ ·å¼
```

**å®ç°æç¤º**:
```typescript
it('should highlight active navigation item', () => {
  mockUsePathname.mockReturnValue('/documents');
  
  const { getByText } = render(<AppHeader />);
  const docButton = getByText('æ–‡æ¡£').closest('button');
  
  expect(docButton).toHaveClass('bg-primary'); // active variant
});
```

---

#### åœºæ™¯ 1.10-INT-005: AppHeader åœ¨æ‰€æœ‰è®¤è¯é¡µé¢æ˜¾ç¤º

**Level**: Integration  
**Priority**: P0  
**Requirement**: AC2 - æ‰€æœ‰è®¤è¯é¡µé¢å…±äº« AppHeader

**æµ‹è¯•åœºæ™¯**:
```
Given: ç”¨æˆ·å·²ç™»å½•
When: ç”¨æˆ·è®¿é—® /chat, /documents, /settings ä»»ä¸€é¡µé¢
Then: æ¯ä¸ªé¡µé¢éƒ½åº”è¯¥æ˜¾ç¤ºç›¸åŒçš„ AppHeader
And: AppHeader å›ºå®šåœ¨é¡¶éƒ¨
```

**å®ç°æç¤º**:
```typescript
it('should display AppHeader on all authenticated pages', async () => {
  const session = await signIn('user@example.com');
  
  const pages = ['/chat', '/documents', '/settings'];
  
  for (const path of pages) {
    await page.goto(path);
    const header = await page.locator('header');
    
    expect(await header.isVisible()).toBe(true);
    expect(await header.locator('text=æ–‡æ¡£').count()).toBe(1);
  }
});
```

---

### AC3: ç®€åŒ–çš„ç”¨æˆ·èœå•

#### åœºæ™¯ 1.10-UNIT-004: UserMenu ç»„ä»¶æ¸²æŸ“æµ‹è¯•

**Level**: Unit  
**Priority**: P0  
**Requirement**: AC3 - UserMenu åŒ…å«æ‰€æœ‰èœå•é¡¹

**æµ‹è¯•åœºæ™¯**:
```
Given: UserMenu ç»„ä»¶è¢«æ¸²æŸ“
When: ç”¨æˆ·ç‚¹å‡»å¤´åƒæ‰“å¼€èœå•
Then: åº”è¯¥æ˜¾ç¤ºç”¨æˆ·åå’Œé‚®ç®±
And: åº”è¯¥æ˜¾ç¤º"è´¦æˆ·è®¾ç½®"é€‰é¡¹
And: åº”è¯¥æ˜¾ç¤º"ä¸»é¢˜åˆ‡æ¢"é€‰é¡¹
And: åº”è¯¥æ˜¾ç¤º"é€€å‡ºç™»å½•"é€‰é¡¹
```

**å®ç°æç¤º**:
```typescript
// tests/unit/layout/UserMenu.test.tsx
describe('UserMenu Component', () => {
  it('should render all menu items', async () => {
    const { getByRole, getByText } = render(
      <SessionProvider session={mockSession}>
        <UserMenu />
      </SessionProvider>
    );
    
    const trigger = getByRole('button');
    await userEvent.click(trigger);
    
    expect(getByText(mockSession.user.name)).toBeInTheDocument();
    expect(getByText('è´¦æˆ·è®¾ç½®')).toBeInTheDocument();
    expect(getByText('ä¸»é¢˜')).toBeInTheDocument();
    expect(getByText('é€€å‡ºç™»å½•')).toBeInTheDocument();
  });
});
```

---

#### åœºæ™¯ 1.10-UNIT-005: UserMenu "è´¦æˆ·è®¾ç½®"å¯¼èˆª

**Level**: Unit  
**Priority**: P1  
**Requirement**: AC3 - ç‚¹å‡»è´¦æˆ·è®¾ç½®è·³è½¬

**æµ‹è¯•åœºæ™¯**:
```
Given: UserMenu å·²æ‰“å¼€
When: ç”¨æˆ·ç‚¹å‡»"è´¦æˆ·è®¾ç½®"
Then: åº”è¯¥å¯¼èˆªåˆ° "/settings"
```

**å®ç°æç¤º**:
```typescript
it('should navigate to /settings when clicking account settings', async () => {
  const { getByText } = render(<UserMenu />);
  
  const settingsLink = getByText('è´¦æˆ·è®¾ç½®').closest('a');
  expect(settingsLink).toHaveAttribute('href', '/settings');
});
```

---

#### åœºæ™¯ 1.10-UNIT-006: UserMenu é€€å‡ºç™»å½•åŠŸèƒ½

**Level**: Unit  
**Priority**: P0  
**Requirement**: AC3 - é€€å‡ºåè·³è½¬åˆ°ç™»å½•é¡µ

**æµ‹è¯•åœºæ™¯**:
```
Given: UserMenu å·²æ‰“å¼€
When: ç”¨æˆ·ç‚¹å‡»"é€€å‡ºç™»å½•"
Then: åº”è¯¥è°ƒç”¨ signOut å‡½æ•°
And: åº”è¯¥é‡å®šå‘åˆ° "/login"
```

**å®ç°æç¤º**:
```typescript
it('should sign out and redirect to /login', async () => {
  const mockSignOut = jest.fn();
  const mockPush = jest.fn();
  
  mockUseSession.mockReturnValue({ data: mockSession });
  mockUseRouter.mockReturnValue({ push: mockPush });
  
  const { getByText } = render(<UserMenu />);
  await userEvent.click(getByText('é€€å‡ºç™»å½•'));
  
  expect(mockSignOut).toHaveBeenCalledWith({ redirect: false });
  expect(mockPush).toHaveBeenCalledWith('/login');
});
```

---

#### åœºæ™¯ 1.10-INT-006: UserMenu ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½

**Level**: Integration  
**Priority**: P2  
**Requirement**: AC3 - ä¸»é¢˜åˆ‡æ¢æ­£å¸¸å·¥ä½œ

**æµ‹è¯•åœºæ™¯**:
```
Given: UserMenu å·²æ‰“å¼€
When: ç”¨æˆ·ç‚¹å‡»ä¸»é¢˜åˆ‡æ¢æŒ‰é’®
Then: åº”è¯¥åˆ‡æ¢åº”ç”¨ä¸»é¢˜ï¼ˆlight/darkï¼‰
And: ä¸»é¢˜è®¾ç½®åº”è¯¥è¢«æŒä¹…åŒ–
```

---

### AC4: Chaté¡µé¢ä¼˜åŒ–ä¸ºé¦–æ¬¡è®¿é—®å‹å¥½

#### åœºæ™¯ 1.10-UNIT-007: EmptyState æ£€æµ‹æ— æ–‡æ¡£çŠ¶æ€

**Level**: Unit  
**Priority**: P0  
**Requirement**: AC4 - æ˜¾ç¤ºä¸Šä¼ å¼•å¯¼

**æµ‹è¯•åœºæ™¯**:
```
Given: ç”¨æˆ·æ²¡æœ‰ä¸Šä¼ ä»»ä½•æ–‡æ¡£
When: EmptyState ç»„ä»¶æ¸²æŸ“
Then: åº”è¯¥æ˜¾ç¤º"æ¬¢è¿ä½¿ç”¨ DocQA"æ ‡é¢˜
And: åº”è¯¥æ˜¾ç¤º"ä¸Šä¼ æ–‡æ¡£"æŒ‰é’®
And: åº”è¯¥æ˜¾ç¤ºæ”¯æŒçš„æ ¼å¼è¯´æ˜
```

**å®ç°æç¤º**:
```typescript
// tests/unit/chat/EmptyState.test.tsx
describe('EmptyState Component', () => {
  it('should show upload guide for users with no documents', async () => {
    mockFetch('/api/documents', { documents: [] });
    
    const { getByText, getByRole } = render(<EmptyState />);
    
    await waitFor(() => {
      expect(getByText('æ¬¢è¿ä½¿ç”¨ DocQA! ğŸ‘‹')).toBeInTheDocument();
    });
    
    expect(getByRole('button', { name: /ä¸Šä¼ æ–‡æ¡£/i })).toBeInTheDocument();
    expect(getByText(/æ”¯æŒ PDFã€Word/)).toBeInTheDocument();
  });
});
```

**é£é™©è¦†ç›–**: BUS-001ï¼ˆç”¨æˆ·æµç¨‹ä¸­æ–­ï¼‰

---

#### åœºæ™¯ 1.10-UNIT-008: EmptyState æ£€æµ‹æœ‰æ–‡æ¡£æœªé€‰æ‹©çŠ¶æ€

**Level**: Unit  
**Priority**: P1  
**Requirement**: AC4 - æ˜¾ç¤ºé€‰æ‹©æ–‡æ¡£æç¤º

**æµ‹è¯•åœºæ™¯**:
```
Given: ç”¨æˆ·æœ‰æ–‡æ¡£ä½†æœªé€‰æ‹©
When: EmptyState ç»„ä»¶æ¸²æŸ“
Then: åº”è¯¥æ˜¾ç¤º"è¯·ä»å·¦ä¾§é€‰æ‹©ä¸€ä¸ªæ–‡æ¡£"æç¤º
```

**å®ç°æç¤º**:
```typescript
it('should show document selection prompt for users with documents', async () => {
  mockFetch('/api/documents', { documents: [{ id: 1, name: 'test.pdf' }] });
  
  const { getByText } = render(<EmptyState hasDocuments={true} />);
  
  expect(getByText(/è¯·ä»å·¦ä¾§é€‰æ‹©/)).toBeInTheDocument();
});
```

---

#### åœºæ™¯ 1.10-UNIT-009: EmptyState ä¸Šä¼ æŒ‰é’®å¯¼èˆª

**Level**: Unit  
**Priority**: P1  
**Requirement**: AC4 - ä¸Šä¼ æŒ‰é’®è·³è½¬åˆ°æ–‡æ¡£é¡µé¢

**æµ‹è¯•åœºæ™¯**:
```
Given: EmptyState æ˜¾ç¤ºä¸Šä¼ å¼•å¯¼
When: ç”¨æˆ·ç‚¹å‡»"ä¸Šä¼ æ–‡æ¡£"æŒ‰é’®
Then: åº”è¯¥å¯¼èˆªåˆ° "/documents"
```

**å®ç°æç¤º**:
```typescript
it('should navigate to /documents when upload button clicked', async () => {
  const mockPush = jest.fn();
  mockUseRouter.mockReturnValue({ push: mockPush });
  mockFetch('/api/documents', { documents: [] });
  
  const { getByRole } = render(<EmptyState />);
  
  await waitFor(() => {
    expect(getByRole('button', { name: /ä¸Šä¼ æ–‡æ¡£/i })).toBeInTheDocument();
  });
  
  await userEvent.click(getByRole('button', { name: /ä¸Šä¼ æ–‡æ¡£/i }));
  
  expect(mockPush).toHaveBeenCalledWith('/documents');
});
```

---

#### åœºæ™¯ 1.10-INT-007: Chat é¡µé¢é›†æˆ EmptyState

**Level**: Integration  
**Priority**: P0  
**Requirement**: AC4 - Chat é¡µé¢æ ¹æ®çŠ¶æ€æ˜¾ç¤ºå†…å®¹

**æµ‹è¯•åœºæ™¯**:
```
Given: ç”¨æˆ·è®¿é—® Chat é¡µé¢
When: æ£€æŸ¥ç”¨æˆ·æ–‡æ¡£çŠ¶æ€
Then: æ ¹æ®ä¸åŒçŠ¶æ€æ˜¾ç¤ºæ­£ç¡®å†…å®¹
  - æ— æ–‡æ¡£ â†’ ä¸Šä¼ å¼•å¯¼
  - æœ‰æ–‡æ¡£æœªé€‰æ‹© â†’ é€‰æ‹©æç¤º
  - å·²é€‰æ‹©æ–‡æ¡£ â†’ æ­£å¸¸ Chat ç•Œé¢
```

**å®ç°æç¤º**:
```typescript
describe('Chat Page Integration', () => {
  it('should show empty state for users with no documents', async () => {
    await clearUserDocuments('user@example.com');
    await loginAs('user@example.com');
    
    await page.goto('/chat');
    
    await expect(page.locator('h2')).toContainText('æ¬¢è¿ä½¿ç”¨ DocQA');
  });
  
  it('should show chat interface when document is selected', async () => {
    await loginAs('user@example.com');
    await page.goto('/chat?doc=1');
    
    await expect(page.locator('[data-testid="chat-input"]')).toBeVisible();
  });
});
```

---

### AC5: é‡æ„åº”ç”¨è·¯ç”±ç»“æ„

#### åœºæ™¯ 1.10-INT-008: (app) è·¯ç”±ç»„è®¤è¯ä¿æŠ¤

**Level**: Integration  
**Priority**: P0  
**Requirement**: AC5 - æ‰€æœ‰ (app) è·¯ç”±å—è®¤è¯ä¿æŠ¤

**æµ‹è¯•åœºæ™¯**:
```
Given: ç”¨æˆ·æœªç™»å½•
When: ç”¨æˆ·è®¿é—® (app) è·¯ç”±ç»„å†…çš„ä»»ä½•é¡µé¢
Then: åº”è¯¥é‡å®šå‘åˆ° "/login"
And: ç™»å½•ååº”è¯¥å›åˆ°åŸå§‹ç›®æ ‡é¡µé¢
```

**å®ç°æç¤º**:
```typescript
describe('(app) Route Group Auth Protection', () => {
  it('should protect all (app) routes from unauthenticated access', async () => {
    const protectedRoutes = ['/chat', '/documents', '/settings'];
    
    for (const route of protectedRoutes) {
      const response = await fetch(route, { redirect: 'manual' });
      
      expect(response.status).toBe(307); // Redirect
      expect(response.headers.get('location')).toContain('/login');
    }
  });
  
  it('should redirect to original target after login', async () => {
    await page.goto('/documents');
    
    // åº”è¯¥è¢«é‡å®šå‘åˆ°ç™»å½•é¡µ
    await page.waitForURL('**/login**');
    
    // ç™»å½•
    await fillLoginForm();
    await page.click('button[type="submit"]');
    
    // åº”è¯¥å›åˆ° /documents
    await page.waitForURL('**/documents');
    expect(page.url()).toContain('/documents');
  });
});
```

**é£é™©è¦†ç›–**: TECH-001ï¼ˆè·¯ç”±é‡æ„ï¼‰, SEC-001ï¼ˆè®¤è¯è¾¹ç•Œï¼‰

---

#### åœºæ™¯ 1.10-INT-009: (public) è·¯ç”±ç»„å…¬å¼€è®¿é—®

**Level**: Integration  
**Priority**: P0  
**Requirement**: AC5 - (public) è·¯ç”±æ— éœ€è®¤è¯

**æµ‹è¯•åœºæ™¯**:
```
Given: ç”¨æˆ·æœªç™»å½•
When: ç”¨æˆ·è®¿é—® (public) è·¯ç”±ç»„å†…çš„é¡µé¢
Then: åº”è¯¥å¯ä»¥æ­£å¸¸è®¿é—®
And: ä¸åº”è¯¥é‡å®šå‘åˆ°ç™»å½•é¡µ
```

**å®ç°æç¤º**:
```typescript
it('should allow public access to (public) routes', async () => {
  const publicRoutes = ['/', '/login', '/register'];
  
  for (const route of publicRoutes) {
    const response = await fetch(route);
    
    expect(response.status).toBe(200);
    expect(response.url).not.toContain('/login');
  }
});
```

---

#### åœºæ™¯ 1.10-INT-010: (app)/layout.tsx è®¤è¯é€»è¾‘

**Level**: Integration  
**Priority**: P0  
**Requirement**: AC5 - Layout æ‰§è¡Œè®¤è¯æ£€æŸ¥

**æµ‹è¯•åœºæ™¯**:
```
Given: (app)/layout.tsx è¢«æ¸²æŸ“
When: æ£€æŸ¥ç”¨æˆ·ä¼šè¯
Then: å¦‚æœæ— ä¼šè¯ï¼Œåº”è¯¥é‡å®šå‘åˆ° "/login"
And: å¦‚æœæœ‰ä¼šè¯ï¼Œåº”è¯¥æ¸²æŸ“ AppHeader å’Œå­é¡µé¢
```

**å®ç°æç¤º**:
```typescript
describe('(app)/layout.tsx', () => {
  it('should redirect to login if no session', async () => {
    mockAuth.mockResolvedValue(null);
    
    const { redirect } = await import('next/navigation');
    render(await AppLayout({ children: <div>Test</div> }));
    
    expect(redirect).toHaveBeenCalledWith('/login');
  });
  
  it('should render AppHeader and children if session exists', async () => {
    mockAuth.mockResolvedValue(mockSession);
    
    const { getByText } = render(
      await AppLayout({ children: <div>Test Content</div> })
    );
    
    expect(getByText('æ–‡æ¡£')).toBeInTheDocument(); // AppHeader
    expect(getByText('Test Content')).toBeInTheDocument(); // Children
  });
});
```

**é£é™©è¦†ç›–**: TECH-003ï¼ˆè®¤è¯é€»è¾‘è¿ç§»ï¼‰

---

#### åœºæ™¯ 1.10-E2E-002: å®Œæ•´è·¯ç”±å¯¼èˆªæµç¨‹

**Level**: E2E  
**Priority**: P0  
**Requirement**: AC5 - è·¯ç”±å¯¼èˆªæ­£å¸¸å·¥ä½œ

**æµ‹è¯•åœºæ™¯**:
```
Given: ç”¨æˆ·å·²ç™»å½•
When: ç”¨æˆ·åœ¨ä¸åŒé¡µé¢é—´å¯¼èˆª
Then: æ‰€æœ‰é¡µé¢åº”è¯¥æ­£å¸¸åŠ è½½
And: AppHeader å§‹ç»ˆæ˜¾ç¤º
And: é¡µé¢å†…å®¹æ­£ç¡®æ¸²æŸ“
```

**å®ç°æç¤º**:
```typescript
it('should navigate between all authenticated pages', async () => {
  await loginAs('user@example.com');
  
  // Chat â†’ Documents
  await page.goto('/chat');
  await page.click('text=æ–‡æ¡£');
  await page.waitForURL('**/documents');
  expect(await page.locator('h1').textContent()).toContain('æ–‡æ¡£');
  
  // Documents â†’ Settings
  await page.click('[aria-label="user menu"]');
  await page.click('text=è´¦æˆ·è®¾ç½®');
  await page.waitForURL('**/settings');
  expect(await page.locator('h1').textContent()).toContain('è®¾ç½®');
  
  // Settings â†’ Chat (via logo)
  await page.click('[aria-label="logo"]');
  await page.waitForURL('**/chat');
  expect(page.url()).toContain('/chat');
});
```

---

### AC6: æ ¹è·¯å¾„æ™ºèƒ½é‡å®šå‘

#### åœºæ™¯ 1.10-INT-011: å·²ç™»å½•ç”¨æˆ·æ ¹è·¯å¾„é‡å®šå‘

**Level**: Integration  
**Priority**: P0  
**Requirement**: AC6 - å·²ç™»å½• â†’ /chat

**æµ‹è¯•åœºæ™¯**:
```
Given: ç”¨æˆ·å·²ç™»å½•
When: ç”¨æˆ·è®¿é—®æ ¹è·¯å¾„ "/"
Then: åº”è¯¥é‡å®šå‘åˆ° "/chat"
```

**å®ç°æç¤º**:
```typescript
it('should redirect authenticated users to /chat from root', async () => {
  const session = await signIn('user@example.com');
  const response = await fetch('/');
  
  expect(response.url).toContain('/chat');
});
```

---

#### åœºæ™¯ 1.10-INT-012: æœªç™»å½•ç”¨æˆ·æ ¹è·¯å¾„æ˜¾ç¤º Landing Page

**Level**: Integration  
**Priority**: P0  
**Requirement**: AC6 - æœªç™»å½• â†’ Landing Page

**æµ‹è¯•åœºæ™¯**:
```
Given: ç”¨æˆ·æœªç™»å½•
When: ç”¨æˆ·è®¿é—®æ ¹è·¯å¾„ "/"
Then: åº”è¯¥æ˜¾ç¤º Landing Pageï¼ˆHeroSectionï¼‰
And: ä¸åº”è¯¥é‡å®šå‘
```

**å®ç°æç¤º**:
```typescript
it('should show landing page for unauthenticated users', async () => {
  const response = await fetch('/');
  const html = await response.text();
  
  expect(response.status).toBe(200);
  expect(html).toContain('HeroSection'); // æˆ–å…¶ä»– Landing Page æ ‡è¯†
});
```

---

### AC7: æ–‡æ¡£ç®¡ç†é¡µé¢ç‹¬ç«‹åŒ–

#### åœºæ™¯ 1.10-E2E-003: æ–‡æ¡£é¡µé¢åŠŸèƒ½å®Œæ•´æ€§

**Level**: E2E  
**Priority**: P1  
**Requirement**: AC7 - æ–‡æ¡£ç®¡ç†åŠŸèƒ½æ­£å¸¸

**æµ‹è¯•åœºæ™¯**:
```
Given: ç”¨æˆ·åœ¨ /documents é¡µé¢
When: ç”¨æˆ·æ‰§è¡Œå„ç§æ–‡æ¡£æ“ä½œ
Then: æ‰€æœ‰åŠŸèƒ½åº”è¯¥æ­£å¸¸å·¥ä½œ
  - æ–‡æ¡£åˆ—è¡¨æ˜¾ç¤º
  - ä¸Šä¼ æ–‡æ¡£
  - é‡å‘½åæ–‡æ¡£
  - åˆ é™¤æ–‡æ¡£
```

**å®ç°æç¤º**:
```typescript
describe('Documents Page', () => {
  it('should display document list', async () => {
    await loginAs('user@example.com');
    await page.goto('/documents');
    
    await expect(page.locator('[data-testid="document-list"]')).toBeVisible();
  });
  
  it('should upload document', async () => {
    await page.click('button:has-text("ä¸Šä¼ ")');
    await page.setInputFiles('input[type="file"]', 'tests/fixtures/test.pdf');
    await page.click('button:has-text("ç¡®è®¤ä¸Šä¼ ")');
    
    await expect(page.locator('text=test.pdf')).toBeVisible();
  });
});
```

---

#### åœºæ™¯ 1.10-INT-013: Documents é¡µé¢ä¸ Chat é¡µé¢äº’ç›¸å¯¼èˆª

**Level**: Integration  
**Priority**: P1  
**Requirement**: AC7 - é¡µé¢é—´å¯¼èˆªæµç•…

**æµ‹è¯•åœºæ™¯**:
```
Given: ç”¨æˆ·åœ¨ Chat é¡µé¢
When: ç”¨æˆ·ç‚¹å‡»"æ–‡æ¡£"å¯¼èˆª
Then: åº”è¯¥è·³è½¬åˆ° /documents
And: å¯ä»¥ä» /documents å›åˆ° Chat
```

**å®ç°æç¤º**:
```typescript
it('should navigate between chat and documents', async () => {
  await page.goto('/chat');
  await page.click('text=æ–‡æ¡£');
  await page.waitForURL('**/documents');
  
  await page.click('[aria-label="logo"]');
  await page.waitForURL('**/chat');
});
```

---

### AC8: Settingsé¡µé¢ç®€åŒ–

#### åœºæ™¯ 1.10-INT-014: Settings é¡µé¢ä½¿ç”¨ AppHeader

**Level**: Integration  
**Priority**: P1  
**Requirement**: AC8 - Settings ä½¿ç”¨ç»Ÿä¸€å¯¼èˆª

**æµ‹è¯•åœºæ™¯**:
```
Given: ç”¨æˆ·åœ¨ /settings é¡µé¢
When: é¡µé¢åŠ è½½å®Œæˆ
Then: åº”è¯¥æ˜¾ç¤º AppHeader
And: ä¸åº”è¯¥æœ‰ç‹¬ç«‹çš„ Header
And: æ‰€æœ‰è®¾ç½®åŠŸèƒ½æ­£å¸¸å·¥ä½œ
```

**å®ç°æç¤º**:
```typescript
it('should render Settings with AppHeader', async () => {
  await page.goto('/settings');
  
  // éªŒè¯ AppHeader å­˜åœ¨
  await expect(page.locator('header >> text=æ–‡æ¡£')).toBeVisible();
  
  // éªŒè¯è®¾ç½®åŠŸèƒ½
  await expect(page.locator('h1')).toContainText('è´¦æˆ·è®¾ç½®');
});
```

---

#### åœºæ™¯ 1.10-E2E-004: Settings é¡µé¢åŠŸèƒ½å®Œæ•´æ€§

**Level**: E2E  
**Priority**: P2  
**Requirement**: AC8 - Settings åŠŸèƒ½ä¸å—å½±å“

**æµ‹è¯•åœºæ™¯**:
```
Given: ç”¨æˆ·åœ¨ /settings é¡µé¢
When: ç”¨æˆ·ä¿®æ”¹ä¸ªäººä¿¡æ¯
Then: ä¿®æ”¹åº”è¯¥æˆåŠŸä¿å­˜
And: å…¶ä»–åŠŸèƒ½ï¼ˆå¯†ç ä¿®æ”¹ã€è´¦æˆ·åˆ é™¤ï¼‰æ­£å¸¸
```

---

## ç»„ä»¶é‡æ„ç›¸å…³æµ‹è¯•

### ChatWithHistory ç»„ä»¶é‡æ„

#### åœºæ™¯ 1.10-UNIT-010: ChatWithHistory æ— å†…éƒ¨ Header

**Level**: Unit  
**Priority**: P0  
**Requirement**: ç»„ä»¶é‡æ„ - ç§»é™¤å†…éƒ¨ Header

**æµ‹è¯•åœºæ™¯**:
```
Given: ChatWithHistory ç»„ä»¶è¢«æ¸²æŸ“
When: ç»„ä»¶åŠ è½½å®Œæˆ
Then: ä¸åº”è¯¥åŒ…å«å†…éƒ¨ Header å…ƒç´ 
And: æ ¸å¿ƒåŠŸèƒ½ï¼ˆå¯¹è¯ã€å†å²ã€ä¾§è¾¹æ ï¼‰æ­£å¸¸å·¥ä½œ
```

**å®ç°æç¤º**:
```typescript
// tests/unit/chat/ChatWithHistory.test.tsx
describe('ChatWithHistory Refactor', () => {
  it('should not render internal header', () => {
    const { container } = render(<ChatWithHistory />);
    
    const header = container.querySelector('[data-testid="chat-internal-header"]');
    expect(header).toBeNull();
  });
  
  it('should still render sidebar and chat interface', () => {
    const { getByTestId } = render(<ChatWithHistory />);
    
    expect(getByTestId('chat-sidebar')).toBeInTheDocument();
    expect(getByTestId('chat-input')).toBeInTheDocument();
  });
});
```

**é£é™©è¦†ç›–**: TECH-002ï¼ˆç»„ä»¶ä¾èµ–å…³ç³»ï¼‰

---

#### åœºæ™¯ 1.10-INT-015: ChatWithHistory åœ¨æ–°å¸ƒå±€ä¸‹æ­£å¸¸å·¥ä½œ

**Level**: Integration  
**Priority**: P0  
**Requirement**: ç»„ä»¶é‡æ„ - é›†æˆæµ‹è¯•

**æµ‹è¯•åœºæ™¯**:
```
Given: ChatWithHistory åœ¨æ–°çš„ AppLayout ä¸­
When: ç”¨æˆ·è¿›è¡Œå¯¹è¯æ“ä½œ
Then: æ‰€æœ‰åŠŸèƒ½æ­£å¸¸
  - åˆ›å»ºæ–°å¯¹è¯
  - å‘é€æ¶ˆæ¯
  - åˆ‡æ¢æ–‡æ¡£
  - æŸ¥çœ‹å†å²
```

**å®ç°æç¤º**:
```typescript
describe('ChatWithHistory Integration', () => {
  it('should work correctly in new layout', async () => {
    await page.goto('/chat');
    
    // åˆ›å»ºå¯¹è¯
    await page.click('[data-testid="new-conversation"]');
    
    // å‘é€æ¶ˆæ¯
    await page.fill('[data-testid="chat-input"]', 'Hello');
    await page.click('[data-testid="send-button"]');
    
    // éªŒè¯å“åº”
    await expect(page.locator('.message')).toContainText('Hello');
  });
});
```

---

## æ€§èƒ½å’Œå¯é æ€§æµ‹è¯•

#### åœºæ™¯ 1.10-PERF-001: EmptyState æ–‡æ¡£æ£€æŸ¥æ€§èƒ½

**Level**: Integration  
**Priority**: P2  
**Requirement**: æ€§èƒ½ - é¦–æ¬¡åŠ è½½ä¸å»¶è¿Ÿ

**æµ‹è¯•åœºæ™¯**:
```
Given: ç”¨æˆ·è®¿é—® Chat é¡µé¢
When: EmptyState æ£€æŸ¥ç”¨æˆ·æ–‡æ¡£
Then: API è°ƒç”¨åº”è¯¥åœ¨ 500ms å†…å®Œæˆ
And: é¡µé¢åº”è¯¥å¿«é€Ÿæ˜¾ç¤ºå†…å®¹
```

**å®ç°æç¤º**:
```typescript
it('should check documents quickly', async () => {
  const startTime = Date.now();
  
  await page.goto('/chat');
  await page.waitForSelector('[data-testid="empty-state"]');
  
  const loadTime = Date.now() - startTime;
  expect(loadTime).toBeLessThan(500);
});
```

**é£é™©è¦†ç›–**: PERF-001ï¼ˆé¦–æ¬¡è®¿é—®å»¶è¿Ÿï¼‰

---

#### åœºæ™¯ 1.10-INT-016: è·¯ç”±åˆ‡æ¢æ€§èƒ½

**Level**: Integration  
**Priority**: P2  
**Requirement**: æ€§èƒ½ - å¯¼èˆªæµç•…

**æµ‹è¯•åœºæ™¯**:
```
Given: ç”¨æˆ·åœ¨åº”ç”¨å†…å¯¼èˆª
When: ç”¨æˆ·å¿«é€Ÿåˆ‡æ¢é¡µé¢
Then: æ¯æ¬¡å¯¼èˆªåº”è¯¥åœ¨ 1 ç§’å†…å®Œæˆ
And: æ— æ˜æ˜¾å»¶è¿Ÿæˆ–å¡é¡¿
```

---

## å®‰å…¨å’Œè®¤è¯æµ‹è¯•

#### åœºæ™¯ 1.10-INT-017: ä¼šè¯è¿‡æœŸå¤„ç†

**Level**: Integration  
**Priority**: P1  
**Requirement**: å®‰å…¨ - ä¼šè¯è¿‡æœŸæ­£ç¡®å¤„ç†

**æµ‹è¯•åœºæ™¯**:
```
Given: ç”¨æˆ·åœ¨ Chat é¡µé¢
When: ç”¨æˆ·ä¼šè¯è¿‡æœŸ
Then: åº”è¯¥è¢«é‡å®šå‘åˆ°ç™»å½•é¡µ
And: ç™»å½•ååº”è¯¥å›åˆ° Chat
```

**å®ç°æç¤º**:
```typescript
it('should handle session expiry correctly', async () => {
  await loginAs('user@example.com');
  await page.goto('/chat');
  
  // æ¨¡æ‹Ÿä¼šè¯è¿‡æœŸ
  await expireSession();
  
  // å°è¯•æ“ä½œï¼ˆè§¦å‘è®¤è¯æ£€æŸ¥ï¼‰
  await page.reload();
  
  // åº”è¯¥é‡å®šå‘åˆ°ç™»å½•
  await page.waitForURL('**/login**');
});
```

**é£é™©è¦†ç›–**: SEC-001ï¼ˆè®¤è¯è¾¹ç•Œï¼‰

---

#### åœºæ™¯ 1.10-INT-018: å¤šæ ‡ç­¾é¡µè®¤è¯çŠ¶æ€åŒæ­¥

**Level**: Integration  
**Priority**: P2  
**Requirement**: å®‰å…¨ - è®¤è¯çŠ¶æ€ä¸€è‡´æ€§

**æµ‹è¯•åœºæ™¯**:
```
Given: ç”¨æˆ·åœ¨å¤šä¸ªæ ‡ç­¾é¡µæ‰“å¼€åº”ç”¨
When: ç”¨æˆ·åœ¨ä¸€ä¸ªæ ‡ç­¾é¡µé€€å‡ºç™»å½•
Then: æ‰€æœ‰æ ‡ç­¾é¡µåº”è¯¥åŒæ­¥é€€å‡º
And: æ‰€æœ‰æ ‡ç­¾é¡µé‡å®šå‘åˆ°ç™»å½•é¡µ
```

---

## å›å½’æµ‹è¯•

#### åœºæ™¯ 1.10-E2E-005: æ ¸å¿ƒåŠŸèƒ½å®Œæ•´å›å½’

**Level**: E2E  
**Priority**: P0  
**Requirement**: å›å½’ - ç°æœ‰åŠŸèƒ½ä¸å—å½±å“

**æµ‹è¯•åœºæ™¯**:
```
Given: åº”ç”¨å®Œæˆå¯¼èˆªé‡æ„
When: æ‰§è¡Œæ ¸å¿ƒç”¨æˆ·æµç¨‹
Then: æ‰€æœ‰åŠŸèƒ½æ­£å¸¸
```

**å…³é”®æµç¨‹**:
1. ç™»å½• â†’ Chatï¼ˆå¯¹è¯åŠŸèƒ½ï¼‰
2. ä¸Šä¼ æ–‡æ¡£ â†’ é€‰æ‹©æ–‡æ¡£ â†’ æé—®
3. æŸ¥çœ‹å†å²å¯¹è¯
4. ä¿®æ”¹è´¦æˆ·è®¾ç½®
5. é€€å‡ºç™»å½•

**å®ç°æç¤º**:
```typescript
describe('Core Functionality Regression', () => {
  it('should complete full user journey', async () => {
    // 1. ç™»å½•
    await page.goto('/login');
    await fillLoginForm();
    await page.click('button[type="submit"]');
    await page.waitForURL('**/chat');
    
    // 2. ä¸Šä¼ æ–‡æ¡£
    await page.click('text=æ–‡æ¡£');
    await uploadDocument('test.pdf');
    
    // 3. å›åˆ° Chat å¹¶é€‰æ‹©æ–‡æ¡£
    await page.click('[aria-label="logo"]');
    await selectDocument('test.pdf');
    
    // 4. å‘é€æ¶ˆæ¯
    await sendMessage('What is this document about?');
    await expectResponse();
    
    // 5. è®¿é—®è®¾ç½®
    await page.click('[aria-label="user menu"]');
    await page.click('text=è´¦æˆ·è®¾ç½®');
    await page.waitForURL('**/settings');
    
    // 6. é€€å‡ºç™»å½•
    await page.click('[aria-label="user menu"]');
    await page.click('text=é€€å‡ºç™»å½•');
    await page.waitForURL('**/login');
  });
});
```

**é£é™©è¦†ç›–**: OPS-001ï¼ˆå›æ»šå›°éš¾ï¼‰

---

## æµè§ˆå™¨å¯¼èˆªå’Œè¾¹ç•Œæµ‹è¯•

#### åœºæ™¯ 1.10-E2E-006: æµè§ˆå™¨åé€€/å‰è¿›æŒ‰é’®

**Level**: E2E  
**Priority**: P1  
**Requirement**: å¯¼èˆª - æµè§ˆå™¨æŒ‰é’®æ­£å¸¸å·¥ä½œ

**æµ‹è¯•åœºæ™¯**:
```
Given: ç”¨æˆ·åœ¨åº”ç”¨å†…è¿›è¡Œäº†å¤šæ¬¡å¯¼èˆª
When: ç”¨æˆ·ä½¿ç”¨æµè§ˆå™¨åé€€/å‰è¿›æŒ‰é’®
Then: åº”è¯¥æ­£ç¡®å¯¼èˆªåˆ°å†å²é¡µé¢
And: é¡µé¢çŠ¶æ€æ­£ç¡®æ¢å¤
```

**å®ç°æç¤º**:
```typescript
it('should handle browser back/forward navigation', async () => {
  await page.goto('/chat');
  await page.goto('/documents');
  await page.goto('/settings');
  
  // åé€€
  await page.goBack();
  expect(page.url()).toContain('/documents');
  
  // å†åé€€
  await page.goBack();
  expect(page.url()).toContain('/chat');
  
  // å‰è¿›
  await page.goForward();
  expect(page.url()).toContain('/documents');
});
```

---

#### åœºæ™¯ 1.10-E2E-007: é¡µé¢åˆ·æ–°çŠ¶æ€ä¿æŒ

**Level**: E2E  
**Priority**: P1  
**Requirement**: å¯é æ€§ - åˆ·æ–°ä¸ä¸¢å¤±çŠ¶æ€

**æµ‹è¯•åœºæ™¯**:
```
Given: ç”¨æˆ·åœ¨ Chat é¡µé¢é€‰æ‹©äº†æ–‡æ¡£
When: ç”¨æˆ·åˆ·æ–°é¡µé¢
Then: é€‰æ‹©çš„æ–‡æ¡£åº”è¯¥ä¿æŒ
And: å¯¹è¯å†å²åº”è¯¥æ¢å¤
```

---

#### åœºæ™¯ 1.10-E2E-008: ç›´æ¥ URL è®¿é—®

**Level**: E2E  
**Priority**: P1  
**Requirement**: è·¯ç”± - ç›´æ¥è®¿é—®æ­£å¸¸

**æµ‹è¯•åœºæ™¯**:
```
Given: ç”¨æˆ·å·²ç™»å½•
When: ç”¨æˆ·åœ¨åœ°å€æ ç›´æ¥è¾“å…¥ URL
Then: åº”è¯¥æ­£ç¡®åŠ è½½ç›®æ ‡é¡µé¢
```

**æµ‹è¯• URLs**:
- `/chat`
- `/chat?doc=123`
- `/documents`
- `/settings`

---

## å“åº”å¼å’Œå¯è®¿é—®æ€§æµ‹è¯•

#### åœºæ™¯ 1.10-E2E-009: ç§»åŠ¨ç«¯å¯¼èˆª

**Level**: E2E  
**Priority**: P2  
**Requirement**: å“åº”å¼ - ç§»åŠ¨ç«¯æ­£å¸¸å·¥ä½œ

**æµ‹è¯•åœºæ™¯**:
```
Given: ç”¨æˆ·ä½¿ç”¨ç§»åŠ¨è®¾å¤‡
When: ç”¨æˆ·è®¿é—®åº”ç”¨
Then: AppHeader åº”è¯¥é€‚é…ç§»åŠ¨ç«¯
And: æ‰€æœ‰å¯¼èˆªåŠŸèƒ½æ­£å¸¸
```

---

#### åœºæ™¯ 1.10-UNIT-011: AppHeader å¯è®¿é—®æ€§

**Level**: Unit  
**Priority**: P2  
**Requirement**: å¯è®¿é—®æ€§ - ç¬¦åˆ WCAG æ ‡å‡†

**æµ‹è¯•åœºæ™¯**:
```
Given: AppHeader ç»„ä»¶æ¸²æŸ“
When: è¿è¡Œå¯è®¿é—®æ€§æ£€æŸ¥
Then: åº”è¯¥æ—  a11y é”™è¯¯
And: é”®ç›˜å¯¼èˆªæ­£å¸¸å·¥ä½œ
```

**å®ç°æç¤º**:
```typescript
it('should have no accessibility violations', async () => {
  const { container } = render(<AppHeader />);
  const results = await axe(container);
  
  expect(results).toHaveNoViolations();
});
```

---

## é”™è¯¯å¤„ç†å’Œè¾¹ç•Œæµ‹è¯•

#### åœºæ™¯ 1.10-INT-019: API å¤±è´¥å¤„ç†

**Level**: Integration  
**Priority**: P1  
**Requirement**: å¯é æ€§ - ä¼˜é›…é™çº§

**æµ‹è¯•åœºæ™¯**:
```
Given: EmptyState æ£€æŸ¥æ–‡æ¡£
When: API è°ƒç”¨å¤±è´¥
Then: åº”è¯¥æ˜¾ç¤ºé»˜è®¤å†…å®¹
And: ä¸åº”è¯¥é˜»å¡é¡µé¢åŠ è½½
```

**å®ç°æç¤º**:
```typescript
it('should handle document check API failure gracefully', async () => {
  mockFetch('/api/documents', { error: 'Server error' }, { status: 500 });
  
  const { getByText } = render(<EmptyState />);
  
  // åº”è¯¥å›é€€åˆ°æ˜¾ç¤ºç¤ºä¾‹é—®é¢˜
  await waitFor(() => {
    expect(getByText(/ç¤ºä¾‹é—®é¢˜/)).toBeInTheDocument();
  });
});
```

---

#### åœºæ™¯ 1.10-E2E-010: ç½‘ç»œé”™è¯¯æ¢å¤

**Level**: E2E  
**Priority**: P2  
**Requirement**: å¯é æ€§ - ç½‘ç»œé—®é¢˜æ¢å¤

**æµ‹è¯•åœºæ™¯**:
```
Given: ç”¨æˆ·åœ¨ä½¿ç”¨åº”ç”¨æ—¶é‡åˆ°ç½‘ç»œé”™è¯¯
When: ç½‘ç»œæ¢å¤
Then: åº”ç”¨åº”è¯¥è‡ªåŠ¨æ¢å¤
And: ç”¨æˆ·å¯ä»¥ç»§ç»­æ“ä½œ
```

---

## é¦–æ¬¡ç™»å½•å¼•å¯¼æµ‹è¯•

#### åœºæ™¯ 1.10-UNIT-012: FirstLoginGuide ç»„ä»¶

**Level**: Unit  
**Priority**: P1  
**Requirement**: ç”¨æˆ·ä½“éªŒ - é¦–æ¬¡ç™»å½•å¼•å¯¼

**æµ‹è¯•åœºæ™¯**:
```
Given: ç”¨æˆ·é¦–æ¬¡ç™»å½•åå¯¼èˆªå˜åŒ–
When: FirstLoginGuide ç»„ä»¶æ˜¾ç¤º
Then: åº”è¯¥è§£é‡Šæ–°çš„å¯¼èˆªç»“æ„
And: ç”¨æˆ·å¯ä»¥å…³é—­å¼•å¯¼
And: å…³é—­åä¸å†æ˜¾ç¤º
```

**å®ç°æç¤º**:
```typescript
// tests/unit/onboarding/FirstLoginGuide.test.tsx
describe('FirstLoginGuide', () => {
  it('should show guide for first-time users', () => {
    localStorage.removeItem('seen_new_nav_guide');
    
    const { getByText } = render(<FirstLoginGuide />);
    
    expect(getByText('å¯¼èˆªå‡çº§')).toBeInTheDocument();
    expect(getByText(/ç›´è¾¾å¯¹è¯/)).toBeInTheDocument();
  });
  
  it('should not show guide after dismissed', async () => {
    localStorage.setItem('seen_new_nav_guide', 'true');
    
    const { queryByText } = render(<FirstLoginGuide />);
    
    expect(queryByText('å¯¼èˆªå‡çº§')).not.toBeInTheDocument();
  });
});
```

**é£é™©è¦†ç›–**: BUS-001ï¼ˆç”¨æˆ·æµç¨‹ä¸­æ–­ï¼‰

---

## æµ‹è¯•æ‰§è¡Œé¡ºåºå»ºè®®

### Phase 1: æ ¸å¿ƒè·¯ç”±å’Œè®¤è¯ï¼ˆP0ï¼‰

**å¿…é¡»å…¨éƒ¨é€šè¿‡æ‰èƒ½ç»§ç»­**:

1. `1.10-INT-008` - (app) è·¯ç”±è®¤è¯ä¿æŠ¤
2. `1.10-INT-009` - (public) è·¯ç”±å…¬å¼€è®¿é—®
3. `1.10-INT-010` - Layout è®¤è¯é€»è¾‘
4. `1.10-INT-001` - æ ¹è·¯å¾„é‡å®šå‘åˆ° /chat
5. `1.10-INT-011` - å·²ç™»å½•ç”¨æˆ·æ ¹è·¯å¾„é‡å®šå‘
6. `1.10-INT-012` - æœªç™»å½•ç”¨æˆ·æ˜¾ç¤º Landing Page
7. `1.10-INT-002` - ç™»å½•åè·³è½¬ /chat
8. `1.10-INT-003` - æ³¨å†Œåè·³è½¬ /chat
9. `1.10-INT-004` - Dashboard é‡å®šå‘

### Phase 2: ç»„ä»¶åŠŸèƒ½ï¼ˆP0ï¼‰

10. `1.10-UNIT-001` - AppHeader æ¸²æŸ“
11. `1.10-INT-005` - AppHeader åœ¨æ‰€æœ‰é¡µé¢æ˜¾ç¤º
12. `1.10-UNIT-004` - UserMenu æ¸²æŸ“
13. `1.10-UNIT-006` - UserMenu é€€å‡ºåŠŸèƒ½
14. `1.10-UNIT-007` - EmptyState æ— æ–‡æ¡£çŠ¶æ€
15. `1.10-UNIT-010` - ChatWithHistory æ— å†…éƒ¨ Header
16. `1.10-INT-015` - ChatWithHistory é›†æˆæµ‹è¯•

### Phase 3: ç«¯åˆ°ç«¯æµç¨‹ï¼ˆP0ï¼‰

17. `1.10-E2E-001` - Chat é¦–æ¬¡è®¿é—®å‹å¥½
18. `1.10-E2E-002` - å®Œæ•´è·¯ç”±å¯¼èˆªæµç¨‹
19. `1.10-E2E-005` - æ ¸å¿ƒåŠŸèƒ½å®Œæ•´å›å½’

### Phase 4: é‡è¦åŠŸèƒ½ï¼ˆP1ï¼‰

20-28. å…¶ä»– P1 æµ‹è¯•

### Phase 5: ä¼˜åŒ–å’Œè¾¹ç•Œï¼ˆP2ï¼‰

29-38. P2 æµ‹è¯•

---

## æµ‹è¯•è¦†ç›–ç‡è¦æ±‚

### ä»£ç è¦†ç›–ç‡ç›®æ ‡

- **æ•´ä½“è¦†ç›–ç‡**: 80%+
- **è·¯ç”±é€»è¾‘**: 100%ï¼ˆå…³é”®è·¯å¾„ï¼‰
- **è®¤è¯é€»è¾‘**: 100%ï¼ˆå®‰å…¨å…³é”®ï¼‰
- **AppHeader ç»„ä»¶**: 90%+
- **UserMenu ç»„ä»¶**: 85%+
- **ChatWithHistory**: 80%+ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰
- **EmptyState**: 85%+

### AC è¦†ç›–ç‡

| AC | åœºæ™¯æ•° | P0 | P1 | P2 | è¦†ç›–ç‡ |
|----|--------|----|----|----|----|
| AC1 | 5 | 4 | 1 | 0 | âœ… å®Œæ•´ |
| AC2 | 4 | 2 | 2 | 0 | âœ… å®Œæ•´ |
| AC3 | 4 | 2 | 1 | 1 | âœ… å®Œæ•´ |
| AC4 | 4 | 2 | 2 | 0 | âœ… å®Œæ•´ |
| AC5 | 4 | 4 | 0 | 0 | âœ… å®Œæ•´ |
| AC6 | 2 | 2 | 0 | 0 | âœ… å®Œæ•´ |
| AC7 | 2 | 0 | 2 | 0 | âœ… å®Œæ•´ |
| AC8 | 2 | 0 | 1 | 1 | âœ… å®Œæ•´ |

**æ€»è®¡**: æ‰€æœ‰ AC éƒ½æœ‰å……åˆ†çš„æµ‹è¯•è¦†ç›–

---

## é£é™©è¦†ç›–çŸ©é˜µ

| é£é™© ID | ç›¸å…³æµ‹è¯•åœºæ™¯ | è¦†ç›–ç¨‹åº¦ |
|---------|-------------|---------|
| TECH-001 | INT-008, INT-009, INT-010, E2E-002 | âœ… å®Œæ•´ |
| TECH-002 | UNIT-010, INT-015 | âœ… å®Œæ•´ |
| TECH-003 | INT-010, INT-017 | âœ… å®Œæ•´ |
| BUS-001 | E2E-001, INT-002, INT-003, UNIT-012 | âœ… å®Œæ•´ |
| DATA-001 | INT-004 | âœ… å®Œæ•´ |
| PERF-001 | PERF-001 | âœ… å®Œæ•´ |
| SEC-001 | INT-017, INT-018 | âœ… å®Œæ•´ |
| OPS-001 | E2E-005 | âš ï¸ éƒ¨åˆ† |

---

## æµ‹è¯•å·¥å…·å’Œæ¡†æ¶

### æ¨èæŠ€æœ¯æ ˆ

**Unit Tests**:
- Jest
- React Testing Library
- @testing-library/user-event

**Integration Tests**:
- Jest
- Supertest (API æµ‹è¯•)
- MSW (Mock Service Worker)

**E2E Tests**:
- Playwright
- @playwright/test

**å…¶ä»–å·¥å…·**:
- axe-core (å¯è®¿é—®æ€§æµ‹è¯•)
- jest-axe
- Lighthouse (æ€§èƒ½æµ‹è¯•)

---

## æµ‹è¯•æ•°æ®éœ€æ±‚

### Test Fixtures

```typescript
// tests/fixtures/users.ts
export const testUsers = {
  newUser: {
    email: 'newuser@example.com',
    password: 'Test123!',
    hasDocuments: false,
  },
  existingUser: {
    email: 'user@example.com',
    password: 'Test123!',
    hasDocuments: true,
  },
};

// tests/fixtures/documents.ts
export const testDocuments = [
  { id: 1, name: 'test.pdf', size: 1024 },
  { id: 2, name: 'guide.docx', size: 2048 },
];
```

---

## CI/CD é›†æˆå»ºè®®

### Pipeline é˜¶æ®µ

```yaml
test:
  stages:
    - lint
    - unit
    - integration
    - e2e
    - coverage

  lint:
    - npm run lint
    - npm run type-check

  unit:
    - npm run test:unit
    - coverage threshold: 80%

  integration:
    - npm run test:integration
    - P0 tests must pass

  e2e:
    - npm run test:e2e
    - P0 tests must pass
    - artifacts: screenshots, videos

  coverage:
    - generate coverage report
    - upload to codecov
```

---

## æˆåŠŸæ ‡å‡†

### éƒ¨ç½²å‰å¿…é¡»æ»¡è¶³

- âœ… æ‰€æœ‰ P0 æµ‹è¯•é€šè¿‡ï¼ˆ18/18ï¼‰
- âœ… è·¯ç”±æµ‹è¯•è¦†ç›–ç‡ 100%
- âœ… è®¤è¯æµ‹è¯•è¦†ç›–ç‡ 100%
- âœ… æ•´ä½“ä»£ç è¦†ç›–ç‡ > 80%
- âœ… æ— é«˜ä¼˜å…ˆçº§ linter é”™è¯¯
- âœ… æ‰€æœ‰ E2E å…³é”®è·¯å¾„é€šè¿‡

### å»ºè®®æ»¡è¶³

- â­ P1 æµ‹è¯•é€šè¿‡ç‡ > 90%
- â­ ç»„ä»¶å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 85%
- â­ æ— å¯è®¿é—®æ€§é”™è¯¯
- â­ Lighthouse æ€§èƒ½åˆ†æ•° > 90

---

## æ€»ç»“

è¿™ä¸ªæµ‹è¯•è®¾è®¡ä¸º Story 1.10 çš„é‡å¤§æ¶æ„é‡æ„æä¾›äº†å…¨é¢çš„æµ‹è¯•è¦†ç›–ï¼ŒåŒ…æ‹¬ï¼š

âœ… **38 ä¸ªæµ‹è¯•åœºæ™¯** è¦†ç›–æ‰€æœ‰ 8 ä¸ª AC  
âœ… **é£é™©é©±åŠ¨** çš„ä¼˜å…ˆçº§åˆ†é…ï¼ˆ18 ä¸ª P0 æµ‹è¯•ï¼‰  
âœ… **å¤šå±‚æ¬¡æµ‹è¯•** (Unit 32% + Integration 42% + E2E 26%)  
âœ… **å®Œæ•´çš„é£é™©è¦†ç›–** ç‰¹åˆ«æ˜¯é«˜é£é™©é¡¹ TECH-001  
âœ… **æ˜ç¡®çš„æ‰§è¡Œé¡ºåº** å’ŒæˆåŠŸæ ‡å‡†

**å…³é”®å»ºè®®**:
1. å…ˆæ‰§è¡Œæ‰€æœ‰ P0 æµ‹è¯•ï¼ˆPhase 1-3ï¼‰
2. P0 æµ‹è¯• 100% é€šè¿‡æ˜¯éƒ¨ç½²çš„å‰æ
3. é‡ç‚¹å…³æ³¨è·¯ç”±å’Œè®¤è¯æµ‹è¯•ï¼ˆå®‰å…¨å…³é”®ï¼‰
4. ä½¿ç”¨ CI/CD è‡ªåŠ¨åŒ–æ‰§è¡Œ
5. ä¿æŒæµ‹è¯•è¦†ç›–ç‡ > 80%

---

**æµ‹è¯•è®¾è®¡å®Œæˆæ—¥æœŸ**: 2025-01-08  
**ä¸‹ä¸€æ­¥**: å®æ–½æµ‹è¯•å¹¶æ‰§è¡Œ

