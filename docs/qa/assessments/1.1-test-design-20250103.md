# Test Design: Story 1.1

**日期**: 2025-01-03  
**设计者**: Quinn (Test Architect)

## 测试策略概览

- **总测试场景数**: 11
- **单元测试**: 0 (0%)
- **集成测试**: 8 (73%)
- **E2E测试**: 3 (27%)
- **优先级分布**: P0: 6, P1: 5, P2: 0

## 按验收标准的测试场景

### AC1: Next.js项目创建成功

#### 测试场景

| ID | 层级 | 优先级 | 测试内容 | 合理性说明 |
|----|------|--------|----------|------------|
| 1.1-INT-001 | Integration | P0 | 验证package.json包含Next.js 14依赖 | 确保正确版本的框架被安装 |
| 1.1-INT-002 | Integration | P0 | 验证TypeScript配置文件存在且配置正确 | TypeScript是项目核心依赖 |
| 1.1-INT-003 | Integration | P0 | 执行`npm run dev`成功启动开发服务器 | 验证开发环境可用性 |
| 1.1-E2E-001 | E2E | P0 | 访问http://localhost:3000返回200状态码 | 端到端验证应用可访问 |

---

### AC2: UI组件库集成

#### 测试场景

| ID | 层级 | 优先级 | 测试内容 | 合理性说明 |
|----|------|--------|----------|------------|
| 1.1-INT-004 | Integration | P0 | 验证tailwind.config.js存在且配置正确 | Tailwind是UI基础配置 |
| 1.1-INT-005 | Integration | P1 | 验证shadcn/ui的components.json配置文件存在 | shadcn/ui正确初始化的标志 |
| 1.1-INT-006 | Integration | P1 | 验证Button、Card、Input组件文件存在于src/components/ui/ | 确保基础组件已安装 |

**测试合理性**:
- 集成测试而非单元测试：这些是配置验证，需要检查文件系统和配置完整性
- P0优先级给Tailwind：因为它是所有UI的基础
- P1给shadcn组件：功能可用但不阻塞项目启动

---

### AC3: 代码规范工具配置

#### 测试场景

| ID | 层级 | 优先级 | 测试内容 | 合理性说明 |
|----|------|--------|----------|------------|
| 1.1-INT-007 | Integration | P0 | 验证.eslintrc.json存在且包含必需规则 | ESLint配置验证 |
| 1.1-INT-008 | Integration | P1 | 执行`npm run lint`返回退出码0 | 确保代码规范检查通过 |
| 1.1-INT-009 | Integration | P1 | 验证.prettierrc存在且配置正确 | Prettier格式化配置验证 |

**测试合理性**:
- 集成测试：需要实际执行命令验证工具链
- ESLint配置文件为P0：是代码质量的基础
- lint执行和Prettier为P1：重要但可后续调整

---

### AC4: 项目结构创建

#### 测试场景

| ID | 层级 | 优先级 | 测试内容 | 合理性说明 |
|----|------|--------|----------|------------|
| 1.1-INT-010 | Integration | P0 | 验证所有必需目录存在（src/app, src/components, src/lib等） | 项目结构完整性验证 |
| 1.1-INT-011 | Integration | P1 | 验证.env.local.example存在且包含所有必需环境变量模板 | 环境变量配置指南 |
| 1.1-INT-012 | Integration | P1 | 验证全局样式文件globals.css存在且包含基础样式 | 基础样式配置验证 |

**测试合理性**:
- 集成测试：验证文件系统结构和文件内容
- 目录结构为P0：后续开发的基础
- 环境变量模板为P1：重要但可增量添加

---

### AC5: Git仓库配置

#### 测试场景

| ID | 层级 | 优先级 | 测试内容 | 合理性说明 |
|----|------|--------|----------|------------|
| 1.1-INT-013 | Integration | P0 | 验证.gitignore存在且包含node_modules、.env*等关键排除项 | 防止敏感文件提交 |
| 1.1-INT-014 | Integration | P1 | 验证.git目录存在且有初始提交 | Git仓库正确初始化 |
| 1.1-INT-015 | Integration | P1 | 验证README.md存在且包含项目说明和启动命令 | 文档完整性验证 |

**测试合理性**:
- .gitignore为P0：安全关键，必须在首次提交前验证
- Git初始化和README为P1：重要但不影响开发

---

### AC6: Vercel部署验证

#### 测试场景

| ID | 层级 | 优先级 | 测试内容 | 合理性说明 |
|----|------|--------|----------|------------|
| 1.1-INT-016 | Integration | P0 | 执行`npm run build`成功构建生产版本 | 验证项目可部署 |
| 1.1-E2E-002 | E2E | P0 | Vercel部署后的URL返回200状态码 | 端到端部署验证 |
| 1.1-E2E-003 | E2E | P1 | 验证Vercel环境变量配置正确（通过健康检查接口） | 环境配置验证 |

**测试合理性**:
- 构建测试为集成层级：验证本地构建流程
- 部署访问为E2E：验证完整部署流程
- 环境变量为P1：可在部署后调整

---

## 覆盖率分析

### AC覆盖情况

- ✅ AC1: 完全覆盖（4个测试场景）
- ✅ AC2: 完全覆盖（3个测试场景）
- ✅ AC3: 完全覆盖（3个测试场景）
- ✅ AC4: 完全覆盖（3个测试场景）
- ✅ AC5: 完全覆盖（3个测试场景）
- ✅ AC6: 完全覆盖（3个测试场景）

### 覆盖率缺口

**无覆盖缺口** - 所有验收标准都有对应的测试场景

---

## 测试执行顺序建议

### 第一轮：P0集成测试（快速失败）
1. 1.1-INT-001: 验证Next.js依赖
2. 1.1-INT-002: 验证TypeScript配置
3. 1.1-INT-003: 启动开发服务器
4. 1.1-INT-004: 验证Tailwind配置
5. 1.1-INT-007: 验证ESLint配置
6. 1.1-INT-010: 验证目录结构
7. 1.1-INT-013: 验证.gitignore（安全关键）
8. 1.1-INT-016: 验证生产构建

### 第二轮：P0端到端测试
9. 1.1-E2E-001: 本地访问验证
10. 1.1-E2E-002: Vercel部署验证

### 第三轮：P1测试（质量提升）
11. 1.1-INT-005: shadcn配置
12. 1.1-INT-006: UI组件安装
13. 1.1-INT-008: Lint执行
14. 1.1-INT-009: Prettier配置
15. 1.1-INT-011: 环境变量模板
16. 1.1-INT-012: 全局样式
17. 1.1-INT-014: Git初始化
18. 1.1-INT-015: README文档
19. 1.1-E2E-003: Vercel环境变量

---

## 测试设计推荐

### 自动化测试脚本示例

#### 配置验证脚本 (tests/integration/scaffold.test.ts)

```typescript
import { describe, it, expect } from 'vitest'
import { existsSync, readFileSync } from 'fs'
import { join } from 'path'

describe('项目脚手架验证', () => {
  
  // 1.1-INT-001
  it('应该安装Next.js 14依赖', () => {
    const packageJson = JSON.parse(
      readFileSync('package.json', 'utf-8')
    )
    expect(packageJson.dependencies.next).toMatch(/^14\./)
  })

  // 1.1-INT-002
  it('应该存在TypeScript配置', () => {
    expect(existsSync('tsconfig.json')).toBe(true)
    const tsConfig = JSON.parse(readFileSync('tsconfig.json', 'utf-8'))
    expect(tsConfig.compilerOptions.strict).toBe(true)
  })

  // 1.1-INT-004
  it('应该存在Tailwind配置', () => {
    expect(existsSync('tailwind.config.js')).toBe(true)
  })

  // 1.1-INT-007
  it('应该存在ESLint配置', () => {
    expect(existsSync('.eslintrc.json')).toBe(true)
    const eslintConfig = JSON.parse(
      readFileSync('.eslintrc.json', 'utf-8')
    )
    expect(eslintConfig.extends).toContain('next/core-web-vitals')
  })

  // 1.1-INT-010
  it('应该创建所有必需目录', () => {
    const requiredDirs = [
      'src/app',
      'src/components/ui',
      'src/lib',
      'src/hooks',
      'src/services',
      'src/types',
      'tests/unit',
      'tests/integration'
    ]
    
    requiredDirs.forEach(dir => {
      expect(existsSync(dir)).toBe(true)
    })
  })

  // 1.1-INT-013
  it('应该配置正确的.gitignore', () => {
    const gitignore = readFileSync('.gitignore', 'utf-8')
    expect(gitignore).toContain('node_modules')
    expect(gitignore).toContain('.env')
    expect(gitignore).toContain('.env.local')
  })

  // 1.1-INT-011
  it('应该存在环境变量模板', () => {
    expect(existsSync('.env.local.example')).toBe(true)
    const envExample = readFileSync('.env.local.example', 'utf-8')
    expect(envExample).toContain('DATABASE_URL')
    expect(envExample).toContain('NEXTAUTH_SECRET')
  })
})
```

#### 构建和Lint验证 (CI/CD或脚本)

```bash
#!/bin/bash
# tests/integration/verify-build.sh

echo "▶️ 验证TypeScript编译..."
npx tsc --noEmit || exit 1

echo "▶️ 验证ESLint检查..."
npm run lint || exit 1

echo "▶️ 验证生产构建..."
npm run build || exit 1

echo "✅ 所有集成测试通过"
```

#### E2E部署验证 (tests/e2e/deployment.test.ts)

```typescript
import { test, expect } from '@playwright/test'

test.describe('部署验证', () => {
  
  // 1.1-E2E-001
  test('本地开发服务器应该可访问', async ({ page }) => {
    await page.goto('http://localhost:3000')
    await expect(page).toHaveTitle(/doc-qa-system/i)
  })

  // 1.1-E2E-002
  test('Vercel部署URL应该可访问', async ({ page }) => {
    const deployUrl = process.env.VERCEL_URL || ''
    await page.goto(deployUrl)
    
    const response = await page.goto(deployUrl)
    expect(response?.status()).toBe(200)
  })

  // 1.1-E2E-003
  test('部署环境变量应该配置正确', async ({ request }) => {
    const deployUrl = process.env.VERCEL_URL || ''
    const response = await request.get(`${deployUrl}/api/health`)
    
    expect(response.ok()).toBeTruthy()
    const data = await response.json()
    expect(data.env).toBe('production')
  })
})
```

---

## 风险覆盖映射

基于风险评估 (1.1-risk-20250103.md)，测试场景覆盖关键风险：

| 风险ID | 对应测试场景 | 覆盖说明 |
|--------|-------------|----------|
| SEC-001 | 1.1-INT-013 | .gitignore验证防止环境变量泄露 |
| OPS-001 | 1.1-INT-015 | README验证确保文档完整 |
| TECH-001 | 1.1-INT-001, 1.1-INT-002 | 验证技术栈版本兼容性 |
| TECH-002 | 1.1-E2E-002, 1.1-E2E-003 | Vercel部署配置验证 |

---

## 测试数据要求

### 配置文件内容验证
- **package.json**: 包含正确的Next.js 14.x版本
- **.eslintrc.json**: 包含必需规则
- **.gitignore**: 包含.env*、node_modules等
- **.env.local.example**: 包含所有必需环境变量键

### 目录结构检查清单
```
✓ src/app/(auth)/login
✓ src/app/(auth)/register  
✓ src/app/(dashboard)/dashboard
✓ src/app/api/auth
✓ src/components/ui
✓ src/lib
✓ src/hooks
✓ src/services
✓ src/types
✓ tests/unit
✓ tests/integration
```

### shadcn/ui组件检查
```
✓ src/components/ui/button.tsx
✓ src/components/ui/card.tsx
✓ src/components/ui/input.tsx
✓ components.json (shadcn配置)
```

---

## 质量指标

### 通过标准
- ✅ 所有P0测试通过
- ✅ 至少90% P1测试通过
- ✅ 构建无错误
- ✅ Lint检查通过
- ✅ 部署URL可访问

### 阻塞条件
- ❌ 任何P0测试失败
- ❌ .gitignore配置错误（安全风险）
- ❌ 生产构建失败
- ❌ Vercel部署失败

---

**测试设计完成时间**: 2025-01-03  
**下次审查**: Story 1.1实现完成后

