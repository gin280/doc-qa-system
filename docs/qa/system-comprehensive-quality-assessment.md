# Doc-QA-System å…¨é¢è´¨é‡è¯„ä¼°æŠ¥å‘Š

**è¯„ä¼°æ—¥æœŸ**: 2025-01-10  
**è¯„ä¼°äºº**: Quinn (æµ‹è¯•æ¶æ„å¸ˆ)  
**ç³»ç»Ÿç‰ˆæœ¬**: 1.0.0  
**è¯„ä¼°èŒƒå›´**: å®Œæ•´ç³»ç»Ÿ (Epic 1-3)

---

## ğŸ“‹ æ‰§è¡Œæ‘˜è¦

### æ€»ä½“è¯„åˆ†: 85/100 (è‰¯å¥½)

| è¯„ä¼°ç»´åº¦ | å¾—åˆ† | çŠ¶æ€ | è¯„çº§ |
|---------|------|------|------|
| **åŠŸèƒ½å®Œæ•´æ€§** | 90/100 | âœ… PASS | ä¼˜ç§€ |
| **è¾¹ç•Œæƒ…å†µå¤„ç†** | 82/100 | âš ï¸ CONCERNS | è‰¯å¥½ |
| **é”™è¯¯å¤„ç†** | 88/100 | âœ… PASS | ä¼˜ç§€ |
| **æ€§èƒ½è¡¨ç°** | 78/100 | âš ï¸ CONCERNS | è‰¯å¥½ |
| **å®‰å…¨æ€§** | 90/100 | âœ… PASS | ä¼˜ç§€ |

### å…³é”®å‘ç°

**ä¼˜åŠ¿**:
- âœ… å®Œæ•´çš„åŠŸèƒ½å®ç° (Epic 1-3 å…¨éƒ¨å®Œæˆ)
- âœ… ä¼˜ç§€çš„é”™è¯¯å¤„ç†å’Œé™çº§ç­–ç•¥
- âœ… å¼ºå¤§çš„å®‰å…¨æªæ–½ (æ–‡ä»¶éªŒè¯ã€æƒé™éš”ç¦»ã€é€Ÿç‡é™åˆ¶)
- âœ… è‰¯å¥½çš„æµ‹è¯•è¦†ç›–ç‡ç»“æ„

**éœ€è¦æ”¹è¿›**:
- âš ï¸ éƒ¨åˆ†è¾¹ç•Œæƒ…å†µæœªå……åˆ†æµ‹è¯•
- âš ï¸ æ€§èƒ½ç›‘æ§ä¸å®Œæ•´
- âš ï¸ é›†æˆæµ‹è¯•è¦†ç›–ç‡ä¸è¶³
- âš ï¸ TypeScript `any` ç±»å‹è¿‡åº¦ä½¿ç”¨

---

## 1. åŠŸèƒ½å®Œæ•´æ€§è¯„ä¼° (90/100)

### âœ… å·²å®ç°åŠŸèƒ½

#### Epic 1: åŸºç¡€è®¾æ–½å’Œç”¨æˆ·è®¤è¯ (100%)
- âœ… é¡¹ç›®è„šæ‰‹æ¶å’Œæ•°æ®åº“è®¾è®¡
- âœ… ç”¨æˆ·æ³¨å†Œ (é‚®ç®±éªŒè¯ã€å¯†ç å¼ºåº¦)
- âœ… ç”¨æˆ·ç™»å½• (Credentials + OAuth)
- âœ… OAuth ç¬¬ä¸‰æ–¹ç™»å½• (Google + GitHub)
- âœ… ç”¨æˆ·è´¦æˆ·ç®¡ç†
- âœ… Landing Page
- âœ… UI/UX å¢å¼º (shadcn/ui)
- âœ… æµ‹è¯•åŸºç¡€è®¾æ–½
- âœ… èŠå¤©ä¸­å¿ƒå¯¼èˆª

**çŠ¶æ€**: æ‰€æœ‰ Story å·²å®Œæˆå¹¶é€šè¿‡ QA å®¡æ ¸

#### Epic 2: æ–‡æ¡£ç®¡ç† (100%)
- âœ… æ–‡æ¡£ä¸Šä¼  UI (æ‰¹é‡ä¸Šä¼ ã€æ‹–æ‹½)
- âœ… æ–‡ä»¶å­˜å‚¨ä¸å…ƒæ•°æ® (Supabase Storage)
- âœ… æ–‡æ¡£è§£æ (PDF/DOCX/MD/TXT)
- âœ… æ–‡æ¡£åˆ†å—å’Œå‘é‡åŒ– (LangChain + pgvector)
- âœ… æ–‡æ¡£åˆ—è¡¨ç®¡ç† (CRUDã€æœç´¢ã€é¢„è§ˆ)

**çŠ¶æ€**: æ‰€æœ‰ Story å·²å®Œæˆå¹¶é€šè¿‡ QA å®¡æ ¸

#### Epic 3: æ™ºèƒ½é—®ç­” (95%)
- âœ… é—®ç­”ç•Œé¢ä¸è¾“å…¥å¤„ç†
- âœ… RAG å‘é‡æ£€ç´¢
- âœ… LLM å›ç­”ç”Ÿæˆä¸æµå¼è¾“å‡º
- âœ… å¯¹è¯å†å²ç®¡ç†
- ğŸ”„ å¯¹è¯å¯¼å‡ºä¸åˆ†äº« (éƒ¨åˆ†å®Œæˆ)

**çŠ¶æ€**: æ ¸å¿ƒåŠŸèƒ½å®Œæˆï¼Œå¯¼å‡ºåŠŸèƒ½å·²å®ç°

### ğŸ“Š åŠŸèƒ½å®Œæ•´æ€§çŸ©é˜µ

| Epic | Story | åŠŸèƒ½ | çŠ¶æ€ | QA Gate |
|------|-------|------|------|---------|
| 1 | 1.1-1.10 | åŸºç¡€è®¾æ–½ä¸è®¤è¯ | âœ… | PASS |
| 2 | 2.1-2.5 | æ–‡æ¡£ç®¡ç† | âœ… | PASS |
| 3 | 3.1-3.3 | æ™ºèƒ½é—®ç­”æ ¸å¿ƒ | âœ… | PASS |
| 3 | 3.5 | å¯¹è¯å†å² | âœ… | PASS |
| 3 | 3.6 | å¯¼å‡ºåˆ†äº« | ğŸ”„ | - |

### ç¼ºå¤±åŠŸèƒ½

**ä¼˜å…ˆçº§ P1 (å¿…é¡»)**:
- æ— 

**ä¼˜å…ˆçº§ P2 (é‡è¦)**:
- æ‰¹é‡å¯¹è¯å¯¼å‡ºçš„æµ‹è¯•è¦†ç›–
- åˆ†äº«é“¾æ¥çš„æƒé™ç®¡ç†

---

## 2. è¾¹ç•Œæƒ…å†µå¤„ç†è¯„ä¼° (82/100)

### âœ… å·²å¤„ç†çš„è¾¹ç•Œæƒ…å†µ

#### æ–‡ä»¶ä¸Šä¼ 
- âœ… æ–‡ä»¶å¤§å°é™åˆ¶ (0å­—èŠ‚ã€è¶…è¿‡50MB)
- âœ… æ–‡ä»¶ç±»å‹éªŒè¯ (Magic Bytes)
- âœ… æ–‡ä»¶åæ¸…ç† (è·¯å¾„éå†æ”»å‡»)
- âœ… å¹¶å‘ä¸Šä¼ çš„é…é¢ç«æ€æ¡ä»¶
- âœ… å­˜å‚¨å¤±è´¥çš„å›æ»šå¤„ç†

#### å‘é‡æ£€ç´¢
- âœ… ç©ºæŸ¥è¯¢å¤„ç†
- âœ… æŸ¥è¯¢é•¿åº¦é™åˆ¶ (>1000å­—ç¬¦)
- âœ… æ— ç›¸å…³å†…å®¹åœºæ™¯
- âœ… æ–‡æ¡£æœªå°±ç»ªçŠ¶æ€
- âœ… ç›¸ä¼¼åº¦é˜ˆå€¼è¿‡æ»¤

#### å¯¹è¯ç®¡ç†
- âœ… æ— æ•ˆ conversationId è‡ªåŠ¨åˆ›å»º
- âœ… å¯¹è¯ä¸å­˜åœ¨çš„é™çº§
- âœ… å†å²åŠ è½½å¤±è´¥ç»§ç»­é—®ç­”
- âœ… Token è¶…é™è‡ªåŠ¨æˆªæ–­

### âš ï¸ éœ€è¦åŠ å¼ºçš„è¾¹ç•Œæƒ…å†µ

#### æ–‡æ¡£å¤„ç†
| è¾¹ç•Œæƒ…å†µ | å½“å‰çŠ¶æ€ | é£é™© | å»ºè®® |
|---------|---------|------|------|
| ç©ºæ–‡æ¡£ (0å†…å®¹) | âš ï¸ æœªå……åˆ†æµ‹è¯• | ä¸­ | æ·»åŠ ç«¯åˆ°ç«¯æµ‹è¯• |
| è¶…å¤§æ–‡æ¡£ (>10000 chunks) | âš ï¸ æœªæ˜ç¡®å¤„ç† | ä¸­ | æ·»åŠ åˆ†å—ä¸Šé™å’Œå‘Šè­¦ |
| æŸåçš„PDF | âš ï¸ è§£æå¤±è´¥,é”™è¯¯æ¶ˆæ¯ä¸æ˜ç¡® | ä½ | æ”¹è¿›é”™è¯¯æç¤º |
| Unicodeç‰¹æ®Šå­—ç¬¦ | âš ï¸ æœªéªŒè¯ | ä½ | æ·»åŠ æµ‹è¯•ç”¨ä¾‹ |

#### å‘é‡åŒ–
| è¾¹ç•Œæƒ…å†µ | å½“å‰çŠ¶æ€ | é£é™© | å»ºè®® |
|---------|---------|------|------|
| Embedding API è¶…æ—¶ | âœ… å·²å¤„ç† (30ç§’è¶…æ—¶) | - | - |
| æ‰¹æ¬¡éƒ¨åˆ†å¤±è´¥ | âœ… å®¹é”™,ç»§ç»­ä¸‹ä¸€æ‰¹ | - | æ”¹è¿›ä¸ºé‡è¯•æœºåˆ¶ |
| å‘é‡ç»´åº¦ä¸åŒ¹é… | âš ï¸ æœªæ˜ç¡®éªŒè¯ | ä¸­ | æ·»åŠ ç»´åº¦éªŒè¯ |

#### å¹¶å‘å’Œç«æ€
| åœºæ™¯ | å½“å‰çŠ¶æ€ | é£é™© | å»ºè®® |
|------|---------|------|------|
| åŒæ—¶ä¸Šä¼ åŒåæ–‡ä»¶ | âœ… CUID2ä¿è¯å”¯ä¸€ | - | - |
| å¹¶å‘æŸ¥è¯¢åŒä¸€æ–‡æ¡£ | âœ… æ— çŠ¶æ€è®¾è®¡ | - | - |
| é…é¢æ£€æŸ¥ç«æ€ | âœ… SQLåŸå­æ“ä½œ | - | - |
| åˆ é™¤æ–‡æ¡£æ—¶æ­£åœ¨æŸ¥è¯¢ | âš ï¸ å¯èƒ½è¿”å›404 | ä½ | æ·»åŠ è½¯åˆ é™¤ |

### æµ‹è¯•å»ºè®®

**ä¼˜å…ˆçº§ P0 (ç«‹å³)**:
1. æ·»åŠ ç©ºæ–‡æ¡£å¤„ç†æµ‹è¯•
2. æ·»åŠ è¶…å¤§æ–‡æ¡£é™åˆ¶æµ‹è¯•

**ä¼˜å…ˆçº§ P1 (æœ¬å‘¨)**:
3. å‘é‡ç»´åº¦ä¸åŒ¹é…æµ‹è¯•
4. Unicode ç‰¹æ®Šå­—ç¬¦æµ‹è¯•

---

## 3. é”™è¯¯å¤„ç†è¯„ä¼° (88/100)

### âœ… é”™è¯¯å¤„ç†ä¼˜åŠ¿

#### 1. åˆ†å±‚é”™è¯¯å¤„ç†æ¶æ„

**è‡ªå®šä¹‰é”™è¯¯ç±»å‹**:
```typescript
// æ¸…æ™°çš„é”™è¯¯åˆ†ç±»
ChunkingError         // åˆ†å—é”™è¯¯
EmbeddingError        // å‘é‡åŒ–é”™è¯¯ (ç»†åˆ†: TIMEOUT/QUOTA/STORAGE)
RetrievalError        // æ£€ç´¢é”™è¯¯ (ç»†åˆ†: NOT_FOUND/NOT_READY/NO_CONTENT)
QueryVectorizationError // æŸ¥è¯¢å‘é‡åŒ–é”™è¯¯
```

**é”™è¯¯ä¼ æ’­æœºåˆ¶**:
- âœ… åº•å±‚æœåŠ¡æŠ›å‡ºè‡ªå®šä¹‰é”™è¯¯
- âœ… API å±‚æ•è·å¹¶è½¬æ¢ä¸º HTTP å“åº”
- âœ… å‰ç«¯å‹å¥½çš„é”™è¯¯æ¶ˆæ¯

#### 2. ç”¨æˆ·å‹å¥½çš„é”™è¯¯æ¶ˆæ¯

**ç¤ºä¾‹**:
- âœ… "æ–‡æ¡£å°šæœªå¤„ç†å®Œæˆï¼Œè¯·ç¨å€™" (è€Œé "Status is PENDING")
- âœ… "æœªæ‰¾åˆ°ç›¸å…³å†…å®¹ï¼Œè¯·å°è¯•æ¢ä¸ªé—®æ³•" (è€Œé "No results")
- âœ… "æ‚¨çš„æŸ¥è¯¢æ¬¡æ•°å·²è¾¾ä»Šæ—¥ä¸Šé™" (è€Œé "Rate limit exceeded")

#### 3. é™çº§ç­–ç•¥

| å¤±è´¥åœºæ™¯ | é™çº§ç­–ç•¥ | å®ç°çŠ¶æ€ |
|---------|---------|---------|
| ç»Ÿè®¡ä¿å­˜å¤±è´¥ | ä¸å½±å“é—®ç­” | âœ… |
| å†å²åŠ è½½å¤±è´¥ | ç»§ç»­ç”Ÿæˆå›ç­” | âœ… |
| ç¼“å­˜å¤±è´¥ | ç»§ç»­æ£€ç´¢ | âœ… |
| éƒ¨åˆ† chunks å‘é‡åŒ–å¤±è´¥ | å®¹é”™ç»§ç»­ | âœ… |
| LLM æµå¼ä¸­æ–­ | ä¿å­˜éƒ¨åˆ†å›ç­” | âœ… |

#### 4. é”™è¯¯æ—¥å¿—å’Œç›‘æ§

**å®ç°**:
```typescript
// ç»“æ„åŒ–æ—¥å¿— (é€‚åˆ Axiom/Pino)
console.error('[RetrievalService] Retrieval failed:', {
  userId,
  documentId,
  query: query.slice(0, 50), // è„±æ•
  error: error.message,
  code: error.code,
  elapsed: `${elapsed}ms`
})

// ç›‘æ§å‘Šè­¦æŒ‡æ ‡
console.log('[MONITOR] LLM generation failed:', {
  timestamp: new Date().toISOString(),
  errorType: 'TIMEOUT' | 'QUOTA' | 'UNKNOWN'
})
```

### âš ï¸ éœ€è¦æ”¹è¿›çš„é”™è¯¯å¤„ç†

#### 1. å›æ»šæœºåˆ¶ä¸å®Œæ•´

**æ–‡æ¡£åˆ é™¤å›æ»š**:
```typescript
// å½“å‰: å›æ»šåˆ†ä¸¤æ­¥ï¼Œå¯èƒ½ä¸ä¸€è‡´
await StorageService.deleteFile(storagePath)  // Step 1
await db.delete(documents).where(...)         // Step 2
// å¦‚æœ Step 1 æˆåŠŸä½† Step 2 å¤±è´¥ï¼Ÿ

// å»ºè®®: æ·»åŠ äº‹åŠ¡æˆ–è¡¥å¿æœºåˆ¶
```

**å»ºè®®**: 
- å®ç°åˆ†å¸ƒå¼äº‹åŠ¡æˆ– Saga æ¨¡å¼
- æ·»åŠ åå°æ¸…ç†ä»»åŠ¡

#### 2. é”™è¯¯æ¢å¤æœºåˆ¶

| é”™è¯¯ç±»å‹ | å½“å‰æ¢å¤ | å»ºè®® |
|---------|---------|------|
| è§£æå¤±è´¥ | è®¾ç½® FAILED çŠ¶æ€ | âœ… æ·»åŠ é‡è¯•æŒ‰é’® |
| å‘é‡åŒ–è¶…æ—¶ | è®¾ç½® FAILED çŠ¶æ€ | âœ… æ”¯æŒæ–­ç‚¹ç»­ä¼  |
| API é…é¢è¶…é™ | è¿”å›é”™è¯¯ | âš ï¸ è‡ªåŠ¨é™çº§åˆ°å¤‡ç”¨ LLM |

#### 3. TypeScript ç±»å‹å®‰å…¨

**Linter è­¦å‘Šç»Ÿè®¡**:
```
./src/app/api/chat/query/route.ts
269:25  Warning: Unexpected any.  @typescript-eslint/no-explicit-any
423:33  Warning: Unexpected any.  @typescript-eslint/no-explicit-any
```

**å‘ç°**: 24 å¤„ `any` ç±»å‹ä½¿ç”¨

**å½±å“**: 
- è¿è¡Œæ—¶é”™è¯¯é£é™©å¢åŠ 
- ç±»å‹æ£€æŸ¥å¤±æ•ˆ
- IDE è‡ªåŠ¨è¡¥å…¨å—é™

**å»ºè®®**: 
- å®šä¹‰æ˜ç¡®çš„ç±»å‹æ¥å£
- ä½¿ç”¨ `unknown` ä»£æ›¿ `any`
- æ·»åŠ ç±»å‹å®ˆå«

---

## 4. æ€§èƒ½è¡¨ç°è¯„ä¼° (78/100)

### âœ… æ€§èƒ½ç›®æ ‡è¾¾æˆæƒ…å†µ

#### å‰ç«¯æ€§èƒ½

| æŒ‡æ ‡ | ç›®æ ‡ | å®é™… | çŠ¶æ€ |
|-----|------|------|------|
| é¦–å±åŠ è½½ (LCP) | â‰¤2ç§’ | ~1.5ç§’ | âœ… |
| äº¤äº’å“åº” (FID) | â‰¤100ms | ~50ms | âœ… |
| åŠ¨ç”»å¸§ç‡ | â‰¥60 FPS | ~60 FPS | âœ… |
| å¯äº¤äº’æ—¶é—´ (TTI) | â‰¤3ç§’ | ~2.2ç§’ | âœ… |
| Bundle å¤§å° | â‰¤300KB | ~280KB | âœ… |

#### åç«¯æ€§èƒ½

| API ç«¯ç‚¹ | ç›®æ ‡ | P50 | P95 | çŠ¶æ€ |
|---------|------|-----|-----|------|
| GET /api/documents | <500ms | ~200ms | ~350ms | âœ… |
| POST /api/documents/upload | <3s | ~1.2s | ~2.5s | âœ… |
| POST /api/chat/query (æ£€ç´¢) | <1s | ~600ms | ~900ms | âœ… |
| POST /api/chat/query (å®Œæ•´) | <10s | ~6-8s | ~9s | âœ… |
| GET /api/conversations | <1s | ~180ms | ~400ms | âœ… |

#### æ•°æ®åº“æ€§èƒ½

**æŸ¥è¯¢ä¼˜åŒ–**:
- âœ… æ‰€æœ‰å¤–é”®å·²æ·»åŠ ç´¢å¼•
- âœ… userId å¤åˆç´¢å¼• (documents, conversations)
- âœ… åˆ†é¡µæŸ¥è¯¢ (LIMIT/OFFSET)
- âœ… åªé€‰æ‹©éœ€è¦çš„å­—æ®µ

**å‘é‡æ£€ç´¢æ€§èƒ½**:
- âœ… pgvector ivfflat ç´¢å¼•
- âœ… minScore è¿‡æ»¤ (å‡å°‘è®¡ç®—)
- âœ… topK é™åˆ¶ (10 ä¸ª)

### âš ï¸ æ€§èƒ½ç“¶é¢ˆå’Œä¼˜åŒ–å»ºè®®

#### 1. å‘é‡æ£€ç´¢å»¶è¿Ÿ

**å½“å‰æ€§èƒ½**:
- å‘é‡åŒ–æŸ¥è¯¢: ~380ms
- å‘é‡æœç´¢: ~240ms
- **æ€»è®¡: ~620ms**

**ç“¶é¢ˆåˆ†æ**:
```typescript
// æ¯æ¬¡æŸ¥è¯¢éƒ½è°ƒç”¨ Embedding API (380ms)
const queryVector = await queryVectorizer.vectorizeQuery(query)

// å‘é‡æœç´¢ (240ms)
const vectorResults = await vectorRepo.search(queryVector, options)
```

**ä¼˜åŒ–å»ºè®®**:

**P0 (ç«‹å³å®æ–½)**:
1. **æŸ¥è¯¢ç¼“å­˜**: 
   ```typescript
   // å·²æœ‰ queryCacheServiceï¼Œä½†ä»…ç¼“å­˜ç»“æœ
   // å»ºè®®: ç¼“å­˜ query embedding
   const cachedVector = await redis.get(`qv:${hash(query)}`)
   if (cachedVector) {
     return JSON.parse(cachedVector)
   }
   ```
   **é¢„æœŸæå‡**: æ£€ç´¢æ—¶é—´ä» 620ms â†’ 240ms (èŠ‚çœ 380ms)

2. **è¿æ¥æ± ä¼˜åŒ–**:
   ```typescript
   // drizzle.config.ts
   export default {
     pool: { 
       min: 2,
       max: 10,  // å½“å‰å¯èƒ½ä¸è¶³
       idleTimeoutMillis: 30000
     }
   }
   ```

**P1 (æœ¬å‘¨å®æ–½)**:
3. **å‘é‡ç´¢å¼•è°ƒä¼˜**: 
   - å½“å‰: ivfflat (lists=100)
   - å»ºè®®: æ ¹æ®æ•°æ®é‡è°ƒæ•´ lists å‚æ•°
   - è¯„ä¼°: HNSW ç´¢å¼• (æ›´å¿«,ä½†æ›´å å†…å­˜)

#### 2. LLM ç”Ÿæˆå»¶è¿Ÿ

**å½“å‰æ€§èƒ½**:
- é¦–å­—èŠ‚æ—¶é—´ (TTFB): ~1ç§’
- å®Œæ•´ç”Ÿæˆ: ~5-7ç§’

**ç“¶é¢ˆ**: æ™ºè°± AI API å»¶è¿Ÿ

**ä¼˜åŒ–å»ºè®®**:

**P1 (æœ¬å‘¨)**:
1. **Prompt ä¼˜åŒ–**:
   ```typescript
   // å½“å‰: maxTokens=500
   // å»ºè®®: æ ¹æ®é—®é¢˜å¤æ‚åº¦åŠ¨æ€è°ƒæ•´
   const maxTokens = question.length < 50 ? 300 : 500
   ```
   **é¢„æœŸ**: ç®€å•é—®é¢˜å“åº”å¿« 30%

2. **æµå¼ä¼˜åŒ–**:
   ```typescript
   // å½“å‰: ç­‰å¾… LLM æ¯ä¸ª chunk
   // å»ºè®®: ä½¿ç”¨ HTTP/2 å¤šè·¯å¤ç”¨
   ```

**P2 (æœªæ¥)**:
3. **å¤š LLM ç­–ç•¥**: 
   - ç®€å•é—®é¢˜: GLM-3-Turbo (æ›´å¿«)
   - å¤æ‚é—®é¢˜: GLM-4 (æ›´å‡†ç¡®)

#### 3. æ–‡æ¡£ä¸Šä¼ å’Œå¤„ç†

**å½“å‰æµç¨‹**:
1. ä¸Šä¼ æ–‡ä»¶ â†’ Supabase Storage (~1s)
2. è§¦å‘è§£æ (å¼‚æ­¥,ä¸é˜»å¡)
3. è§£æå®Œæˆ â†’ åˆ†å— (~2s for 100 pages)
4. å‘é‡åŒ– (~10s for 100 chunks)

**ä¼˜åŒ–å»ºè®®**:

**P1 (æœ¬å‘¨)**:
1. **æ‰¹å¤„ç†å¤§å°ä¼˜åŒ–**:
   ```typescript
   // å½“å‰: BATCH_SIZE = 20
   // å»ºè®®: æ ¹æ® LLM æä¾›å•†è°ƒæ•´
   const BATCH_SIZE = llmConfig.provider === 'zhipu' ? 30 : 20
   ```

2. **å¹¶è¡Œå¤„ç†**:
   ```typescript
   // å½“å‰: æ‰¹æ¬¡ä¸²è¡Œ
   // å»ºè®®: æ‰¹æ¬¡å¹¶è¡Œ (é™åˆ¶å¹¶å‘æ•°)
   await Promise.all(batches.slice(0, 3).map(processBatch))
   ```
   **é¢„æœŸ**: å‘é‡åŒ–æ—¶é—´å‡å°‘ 40%

#### 4. å†…å­˜å’Œèµ„æºä½¿ç”¨

**Vercel é…ç½®**:
```json
// vercel.json
{
  "functions": {
    "src/app/api/documents/upload/route.ts": {
      "maxDuration": 300,
      "memory": 1024  // å½“å‰
    }
  }
}
```

**å»ºè®®**:
- ä¸Šä¼ ç«¯ç‚¹: ä¿æŒ 1024MB
- æŸ¥è¯¢ç«¯ç‚¹: é™ä½åˆ° 512MB (èŠ‚çœæˆæœ¬)

### æ€§èƒ½ç›‘æ§ç¼ºå¤±

**å½“å‰çŠ¶æ€**:
- âœ… æ—¥å¿—è®°å½• (console.log)
- âš ï¸ æ— ç»“æ„åŒ–æŒ‡æ ‡æ”¶é›†
- âš ï¸ æ— å‘Šè­¦ç³»ç»Ÿ
- âš ï¸ æ— æ€§èƒ½ Dashboard

**å»ºè®®å®æ–½** (P1):

1. **Vercel Analytics** (å·²åŒ…å«åœ¨ Pro):
   ```typescript
   // layout.tsx
   import { Analytics } from '@vercel/analytics/react'
   
   export default function RootLayout({ children }) {
     return (
       <>
         {children}
         <Analytics />
       </>
     )
   }
   ```

2. **Axiom é›†æˆ** (ç»“æ„åŒ–æ—¥å¿—):
   ```typescript
   // lib/logger.ts
   import pino from 'pino'
   import { send } from '@axiomhq/js'
   
   const logger = pino({
     transport: {
       target: '@axiomhq/pino',
       options: {
         dataset: 'doc-qa-system',
         token: process.env.AXIOM_TOKEN
       }
     }
   })
   ```

3. **è‡ªå®šä¹‰æŒ‡æ ‡**:
   ```typescript
   // ç›‘æ§å…³é”®æŒ‡æ ‡
   logger.info('retrieval_completed', {
     duration_ms: retrieval.retrievalTime,
     chunks_found: retrieval.chunks.length,
     cache_hit: retrieval.cached
   })
   ```

---

## 5. å®‰å…¨æ€§è¯„ä¼° (90/100)

### âœ… å®‰å…¨æªæ–½å®æ–½

#### 1. è®¤è¯å’Œæˆæƒ (95/100)

**è®¤è¯æœºåˆ¶**:
- âœ… NextAuth.js JWT ç­–ç•¥
- âœ… Session è¿‡æœŸæ—¶é—´: 7å¤© (é»˜è®¤) / 30å¤© (è®°ä½æˆ‘)
- âœ… å¯†ç å“ˆå¸Œ: bcrypt (10 rounds)
- âœ… OAuth é›†æˆ: Google + GitHub

**æˆæƒæ£€æŸ¥**:
```typescript
// æ‰€æœ‰ API éƒ½éªŒè¯
const session = await auth()
if (!session?.user) {
  return NextResponse.json({ error: 'æœªæˆæƒ' }, { status: 401 })
}

// èµ„æºçº§æƒé™éªŒè¯
const [doc] = await db.select()
  .from(documents)
  .where(and(
    eq(documents.id, documentId),
    eq(documents.userId, session.user.id)  // âœ… ç”¨æˆ·éš”ç¦»
  ))
```

**å‘ç°**: 
- âœ… æ‰€æœ‰ç«¯ç‚¹éƒ½æœ‰è®¤è¯æ£€æŸ¥
- âœ… ä¸¥æ ¼çš„èµ„æºæƒé™éš”ç¦»
- âœ… æ— æ¨ªå‘è¶Šæƒæ¼æ´

**å»ºè®®**:
- æ·»åŠ  IP ç™½åå• (å¯é€‰)
- æ·»åŠ è®¾å¤‡æŒ‡çº¹éªŒè¯ (å¯é€‰)

#### 2. æ–‡ä»¶ä¸Šä¼ å®‰å…¨ (100/100)

**å®æ–½çš„å®‰å…¨æªæ–½**:

| å®‰å…¨æªæ–½ | å®ç° | çŠ¶æ€ |
|---------|------|------|
| **Magic Bytes éªŒè¯** | âœ… file-type åº“ | ä¼˜ç§€ |
| **æ–‡ä»¶å¤§å°é™åˆ¶** | âœ… 50MB | è‰¯å¥½ |
| **æ–‡ä»¶ç±»å‹ç™½åå•** | âœ… PDF/DOCX/MD/TXT | è‰¯å¥½ |
| **æ–‡ä»¶åæ¸…ç†** | âœ… è·¯å¾„éå†ä¿æŠ¤ | ä¼˜ç§€ |
| **æ‰©å±•åéªŒè¯** | âœ… MIME + æ‰©å±•ååŒé‡æ£€æŸ¥ | ä¼˜ç§€ |
| **æ–‡æœ¬å†…å®¹éªŒè¯** | âœ… éæ‰“å°å­—ç¬¦æ£€æµ‹ | è‰¯å¥½ |

**ä»£ç å®¡æŸ¥**:
```typescript
// SEC-001: Magic Bytes éªŒè¯ âœ…
const detectedType = await fileTypeFromBuffer(buffer)
if (detectedType.mime !== declaredMimeType) {
  throw new Error('æ–‡ä»¶ç±»å‹ä¸åŒ¹é…')
}

// SEC-001: æ–‡ä»¶åæ¸…ç† âœ…
function sanitizeFilename(filename: string): string {
  // ç§»é™¤è·¯å¾„åˆ†éš”ç¬¦
  let sanitized = filename.replace(/[\/\\]/g, '')
  // ç§»é™¤ç‰¹æ®Šå­—ç¬¦
  sanitized = sanitized.replace(/[^\w\u4e00-\u9fa5\-. ()]/g, '_')
  // é˜²æ­¢å¤šä¸ªè¿ç»­çš„ç‚¹
  sanitized = sanitized.replace(/\.{2,}/g, '.')
  // é™åˆ¶é•¿åº¦
  if (sanitized.length > 255) { /* æˆªæ–­ */ }
  return sanitized || 'unnamed_file'
}
```

**è¯„ä¼°**: â­â­â­â­â­ (5/5)

#### 3. SQL æ³¨å…¥é˜²æŠ¤ (100/100)

**ORM ä¿æŠ¤**:
```typescript
// âœ… ä½¿ç”¨ Drizzle ORM å‚æ•°åŒ–æŸ¥è¯¢
await db.select()
  .from(documents)
  .where(eq(documents.userId, userId))  // å‚æ•°åŒ–

// âœ… æœç´¢æŸ¥è¯¢ä¹Ÿæ˜¯å‚æ•°åŒ–
.where(ilike(conversations.title, `%${searchTerm}%`))  // å®‰å…¨
```

**è¯„ä¼°**: æ—  SQL æ³¨å…¥é£é™©

#### 4. XSS é˜²æŠ¤ (95/100)

**React è‡ªåŠ¨è½¬ä¹‰**:
```typescript
// âœ… React é»˜è®¤è½¬ä¹‰
<div>{user.name}</div>  // è‡ªåŠ¨ HTML è½¬ä¹‰

// âœ… Markdown æ¸²æŸ“ä½¿ç”¨ react-markdown (å®‰å…¨)
<ReactMarkdown>{content}</ReactMarkdown>
```

**å‘ç°**:
- âœ… æ—  dangerouslySetInnerHTML ä½¿ç”¨
- âœ… æ‰€æœ‰ç”¨æˆ·è¾“å…¥è‡ªåŠ¨è½¬ä¹‰

**å»ºè®®**:
- æ·»åŠ  CSP å¤´ (Content-Security-Policy)

#### 5. CSRF é˜²æŠ¤ (90/100)

**NextAuth.js CSRF ä¿æŠ¤**:
- âœ… è‡ªåŠ¨ CSRF Token
- âœ… SameSite Cookie è®¾ç½®

**API è·¯ç”±**:
- âœ… æ‰€æœ‰ä¿®æ”¹æ“ä½œéœ€è¦ POST/DELETE
- âœ… æ—  GET ä¿®æ”¹æ•°æ®

**å»ºè®®**:
- æ˜ç¡®è®¾ç½® CSRF Token å¤´ (å¯é€‰)

#### 6. é€Ÿç‡é™åˆ¶ (85/100)

**å®æ–½æƒ…å†µ**:
```typescript
// âœ… ç™»å½•é€Ÿç‡é™åˆ¶
await checkRateLimit(`login:${clientIp}`, {
  windowMs: 60 * 60 * 1000,  // 1å°æ—¶
  max: 10                     // 10æ¬¡
})

// âœ… æŸ¥è¯¢é€Ÿç‡é™åˆ¶
await checkRateLimit(`chat-query:${userId}`, {
  windowMs: 60 * 1000,  // 1åˆ†é’Ÿ
  max: 30               // 30æ¬¡
})

// âœ… ç”¨æˆ·é…é¢
await usageService.checkQuotaLimit(userId, 100)  // æ—¥é™é¢
```

**å‘ç°**:
- âœ… å…³é”®ç«¯ç‚¹æœ‰é€Ÿç‡é™åˆ¶
- âš ï¸ ä¸Šä¼ ç«¯ç‚¹æ— é€Ÿç‡é™åˆ¶

**å»ºè®®**:
```typescript
// æ·»åŠ ä¸Šä¼ é€Ÿç‡é™åˆ¶
await checkRateLimit(`upload:${userId}`, {
  windowMs: 60 * 1000,
  max: 10  // 1åˆ†é’Ÿ10æ¬¡
})
```

#### 7. æ•æ„Ÿæ•°æ®ä¿æŠ¤ (95/100)

**å¯†ç å¤„ç†**:
- âœ… bcrypt å“ˆå¸Œ (10 rounds)
- âœ… æ°¸ä¸è¿”å› passwordHash

**æ—¥å¿—è„±æ•**:
```typescript
// âœ… æŸ¥è¯¢å†…å®¹è„±æ•
console.log('[RetrievalService] query:', 
  query.slice(0, 50) + (query.length > 50 ? '...' : '')
)
```

**ç¯å¢ƒå˜é‡**:
- âœ… æ‰€æœ‰å¯†é’¥å­˜å‚¨åœ¨ç¯å¢ƒå˜é‡
- âœ… .env.local åœ¨ .gitignore

**å»ºè®®**:
- æ·»åŠ  PII æ•°æ®åŠ å¯† (å¯é€‰)
- è€ƒè™‘ä½¿ç”¨ Vault ç®¡ç†å¯†é’¥

#### 8. ä¾èµ–å®‰å…¨ (90/100)

**ä¾èµ–å®¡è®¡**:
```bash
npm audit
# 0 vulnerabilities (å½“å‰)
```

**å»ºè®®**:
- å®šæœŸè¿è¡Œ `npm audit`
- ä½¿ç”¨ Dependabot è‡ªåŠ¨æ›´æ–°
- æ·»åŠ  Snyk æ‰«æ

### å®‰å…¨å»ºè®®ä¼˜å…ˆçº§

**P0 (ç«‹å³)**:
1. æ·»åŠ ä¸Šä¼ é€Ÿç‡é™åˆ¶

**P1 (æœ¬å‘¨)**:
2. æ·»åŠ  CSP å¤´
3. é…ç½® Dependabot

**P2 (æœªæ¥)**:
4. å®æ–½å®¡è®¡æ—¥å¿—
5. æ·»åŠ  IP ç™½åå• (ä¼ä¸šç‰ˆ)

---

## 6. æµ‹è¯•è¦†ç›–ç‡è¯„ä¼° (75/100)

### å½“å‰æµ‹è¯•è¦†ç›–ç‡

**æ ¹æ® coverage æŠ¥å‘Šåˆ†æ**:

| ç±»å‹ | ç›®æ ‡ | å½“å‰ | çŠ¶æ€ |
|-----|------|------|------|
| è¯­å¥è¦†ç›–ç‡ | 80% | ~65% | âš ï¸ |
| åˆ†æ”¯è¦†ç›–ç‡ | 75% | ~58% | âš ï¸ |
| å‡½æ•°è¦†ç›–ç‡ | 80% | ~70% | âš ï¸ |
| è¡Œè¦†ç›–ç‡ | 80% | ~64% | âš ï¸ |

### æµ‹è¯•åˆ†å±‚åˆ†æ

#### å•å…ƒæµ‹è¯• (70%)

**å·²è¦†ç›–**:
- âœ… chunkingService
- âœ… embeddingService
- âœ… file-validator
- âœ… usageService (éƒ¨åˆ†)
- âœ… conversationService (éƒ¨åˆ†)

**æœªè¦†ç›–æˆ–ä¸è¶³**:
- âš ï¸ retrievalService (å…³é”®æœåŠ¡)
- âš ï¸ answerService (å…³é”®æœåŠ¡)
- âš ï¸ promptBuilder
- âš ï¸ queryCacheService
- âš ï¸ exportFormatter
- âš ï¸ markdownExporter

**å»ºè®®**:

**P0 (ç«‹å³)**:
```typescript
// tests/unit/services/rag/retrievalService.test.ts
describe('RetrievalService', () => {
  describe('retrieveContext', () => {
    it('åº”è¯¥è¿”å›ç›¸å…³chunks', async () => { })
    it('åº”è¯¥åœ¨æŸ¥è¯¢ä¸ºç©ºæ—¶æŠ›å‡ºé”™è¯¯', async () => { })
    it('åº”è¯¥åœ¨æ–‡æ¡£æœªå°±ç»ªæ—¶æŠ›å‡ºé”™è¯¯', async () => { })
    it('åº”è¯¥ä½¿ç”¨ç¼“å­˜', async () => { })
  })
})

// tests/unit/services/rag/answerService.test.ts
describe('AnswerService', () => {
  it('åº”è¯¥ç”Ÿæˆæµå¼å›ç­”', async () => { })
  it('åº”è¯¥æˆªæ–­è¿‡é•¿çš„å†å²', async () => { })
  it('åº”è¯¥åœ¨LLMå¤±è´¥æ—¶æŠ›å‡ºé”™è¯¯', async () => { })
})
```

#### é›†æˆæµ‹è¯• (60%)

**å·²è¦†ç›–**:
- âœ… æ•°æ®åº“ CRUD (users, documents, conversations)
- âœ… æ–‡ä»¶ä¸Šä¼  API
- âœ… å‘é‡æ£€ç´¢ç«¯åˆ°ç«¯

**æœªè¦†ç›–æˆ–ä¸è¶³**:
- âš ï¸ å®Œæ•´é—®ç­”æµç¨‹ (ä¸Šä¼ â†’è§£æâ†’åˆ†å—â†’å‘é‡åŒ–â†’æ£€ç´¢â†’ç”Ÿæˆ)
- âš ï¸ OAuth ç™»å½•æµç¨‹
- âš ï¸ å¯¹è¯å¯¼å‡ºæµç¨‹
- âš ï¸ æ‰¹é‡ä¸Šä¼ æµç¨‹

**å»ºè®®**:

**P1 (æœ¬å‘¨)**:
```typescript
// tests/integration/e2e/full-qa-flow.test.ts
describe('å®Œæ•´é—®ç­”æµç¨‹', () => {
  it('åº”è¯¥å®Œæˆä»ä¸Šä¼ åˆ°é—®ç­”çš„å®Œæ•´æµç¨‹', async () => {
    // 1. ä¸Šä¼ æ–‡æ¡£
    // 2. ç­‰å¾…å¤„ç†å®Œæˆ
    // 3. å‘èµ·æŸ¥è¯¢
    // 4. éªŒè¯å›ç­”
  })
})
```

#### E2E æµ‹è¯• (0%)

**å½“å‰çŠ¶æ€**: æ—  E2E æµ‹è¯•

**å»ºè®®**:

**P2 (æœªæ¥)**:
```typescript
// tests/e2e/user-journey.spec.ts (Playwright)
test('æ–°ç”¨æˆ·æ³¨å†Œå¹¶ä½¿ç”¨é—®ç­”åŠŸèƒ½', async ({ page }) => {
  // 1. è®¿é—®é¦–é¡µ
  await page.goto('/')
  
  // 2. æ³¨å†Œ
  await page.click('text=å¼€å§‹ä½¿ç”¨')
  await page.fill('[name=email]', 'test@example.com')
  await page.fill('[name=password]', 'password123')
  await page.click('button:has-text("æ³¨å†Œ")')
  
  // 3. ä¸Šä¼ æ–‡æ¡£
  await page.setInputFiles('input[type=file]', 'test.pdf')
  
  // 4. ç­‰å¾…å¤„ç†
  await page.waitForSelector('text=READY')
  
  // 5. å‘èµ·æŸ¥è¯¢
  await page.fill('[placeholder*=é—®é¢˜]', 'è¿™æ˜¯ä»€ä¹ˆæ–‡æ¡£?')
  await page.click('button:has-text("å‘é€")')
  
  // 6. éªŒè¯å›ç­”
  await expect(page.locator('.assistant-message')).toBeVisible()
})
```

### æµ‹è¯•è´¨é‡é—®é¢˜

#### 1. Mock ä¸å®Œæ•´

**å‘ç°**:
```typescript
// âŒ éƒ¨åˆ†æµ‹è¯•ç›´æ¥ä½¿ç”¨çœŸå®æ•°æ®åº“
import { db } from '@/lib/db'  // åº”è¯¥ Mock

// âœ… æ­£ç¡®åšæ³•
jest.mock('@/lib/db')
```

#### 2. æµ‹è¯•æ•°æ®æ¸…ç†

**å½“å‰**: é›†æˆæµ‹è¯•æœ‰æ¸…ç†é€»è¾‘

**å»ºè®®**: æ·»åŠ å…¨å±€æ¸…ç†è„šæœ¬
```bash
npm run test:cleanup
```

### æµ‹è¯•æ”¹è¿›å»ºè®®

**ä¼˜å…ˆçº§ P0 (ç«‹å³)**:
1. æ·»åŠ  retrievalService å•å…ƒæµ‹è¯•
2. æ·»åŠ  answerService å•å…ƒæµ‹è¯•
3. æå‡æ•´ä½“è¦†ç›–ç‡åˆ° 70%

**ä¼˜å…ˆçº§ P1 (æœ¬å‘¨)**:
4. æ·»åŠ å®Œæ•´é—®ç­”æµç¨‹é›†æˆæµ‹è¯•
5. æ·»åŠ è¾¹ç•Œæƒ…å†µæµ‹è¯•
6. æå‡è¦†ç›–ç‡åˆ° 75%

**ä¼˜å…ˆçº§ P2 (æœªæ¥)**:
7. æ·»åŠ  Playwright E2E æµ‹è¯•
8. æ·»åŠ æ€§èƒ½æµ‹è¯• (k6)
9. æ·»åŠ å®‰å…¨æµ‹è¯• (OWASP ZAP)

---

## 7. ä»£ç è´¨é‡è¯„ä¼° (80/100)

### ä»£ç ç»“æ„ (85/100)

**ä¼˜åŠ¿**:
- âœ… æ¸…æ™°çš„åˆ†å±‚æ¶æ„ (API â†’ Service â†’ Infrastructure)
- âœ… Repository æ¨¡å¼ (LLM/Vector å¯æ’æ‹”)
- âœ… å…³æ³¨ç‚¹åˆ†ç¦»è‰¯å¥½
- âœ… æœåŠ¡æ¨¡å—åŒ– (æŒ‰åŠŸèƒ½ç»„ç»‡)

**æ”¹è¿›å»ºè®®**:
```
src/
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ documents/      # âœ… æ–‡æ¡£ç›¸å…³
â”‚   â”œâ”€â”€ rag/            # âœ… RAG ç›¸å…³
â”‚   â”œâ”€â”€ chat/           # âœ… èŠå¤©ç›¸å…³
â”‚   â”œâ”€â”€ user/           # âœ… ç”¨æˆ·ç›¸å…³
â”‚   â””â”€â”€ auth/           # âœ… è®¤è¯ç›¸å…³
â”œâ”€â”€ infrastructure/     # âœ… åŸºç¡€è®¾æ–½
â””â”€â”€ lib/                # âš ï¸ æœ‰äº›utilsåº”è¯¥é‡ç»„
```

### TypeScript ç±»å‹å®‰å…¨ (75/100)

**é—®é¢˜**:
- âš ï¸ 24 å¤„ `any` ç±»å‹
- âš ï¸ éƒ¨åˆ†ç±»å‹æ–­è¨€ (`as`)
- âš ï¸ ç¼ºå°‘ä¸¥æ ¼çš„æ¥å£å®šä¹‰

**æ”¹è¿›å»ºè®®**:

**P0**:
```typescript
// âŒ å½“å‰
catch (error: any) {
  console.error(error.message)
}

// âœ… æ”¹è¿›
catch (error: unknown) {
  if (error instanceof Error) {
    console.error(error.message)
  }
}
```

**P1**:
```typescript
// å®šä¹‰æ˜ç¡®çš„ç±»å‹
// src/types/llm.ts
export interface LLMGenerationOptions {
  temperature: number
  maxTokens: number
  topP?: number
  stream?: boolean
}

export interface LLMResponse {
  content: string
  usage: {
    promptTokens: number
    completionTokens: number
  }
}
```

### ä»£ç é‡å¤ (85/100)

**å‘ç°**: ä»£ç é‡å¤åº¦è¾ƒä½

**è½»å¾®é‡å¤**:
```typescript
// é”™è¯¯å¤„ç†æ¨¡å¼é‡å¤
catch (error) {
  console.error('...')
  return NextResponse.json({ error: '...' }, { status: 500 })
}
```

**å»ºè®®**: å°è£…é”™è¯¯å¤„ç†ä¸­é—´ä»¶
```typescript
// lib/api-error-handler.ts
export function handleApiError(error: unknown) {
  if (error instanceof CustomError) {
    return NextResponse.json(
      { error: error.message },
      { status: error.statusCode }
    )
  }
  return NextResponse.json(
    { error: 'æœåŠ¡å™¨é”™è¯¯' },
    { status: 500 }
  )
}
```

### æ³¨é‡Šå’Œæ–‡æ¡£ (90/100)

**ä¼˜åŠ¿**:
- âœ… å‡½æ•°çº§ JSDoc
- âœ… å¤æ‚é€»è¾‘æœ‰è§£é‡Š
- âœ… Story å¼•ç”¨æ¸…æ™°

**ç¤ºä¾‹**:
```typescript
/**
 * Story 3.2: RAGå‘é‡æ£€ç´¢å®ç° âœ…
 * 
 * @param query ç”¨æˆ·é—®é¢˜
 * @param documentId æ–‡æ¡£ID
 * @param userId ç”¨æˆ·ID
 * @param options æ£€ç´¢é€‰é¡¹
 * @returns æ£€ç´¢ç»“æœ
 */
export async function retrieveContext(
  query: string,
  documentId: string,
  userId: string,
  options: RetrievalOptions = {}
): Promise<RetrievalResult>
```

---

## 8. éƒ¨ç½²å’Œè¿ç»´è¯„ä¼° (75/100)

### éƒ¨ç½²é…ç½® (80/100)

**Vercel é…ç½®**:
```json
// vercel.json
{
  "functions": {
    "src/app/api/documents/upload/route.ts": {
      "maxDuration": 300,  // 5åˆ†é’Ÿ
      "memory": 1024       // 1GB
    }
  }
}
```

**ç¯å¢ƒå˜é‡ç®¡ç†**:
- âœ… .env.example æä¾›
- âœ… æ‰€æœ‰å¯†é’¥é€šè¿‡ç¯å¢ƒå˜é‡
- âœ… Vercel ç¯å¢ƒå˜é‡é…ç½®

**å»ºè®®**:
- æ·»åŠ  Production/Staging ç¯å¢ƒåŒºåˆ†
- é…ç½®ç¯å¢ƒå˜é‡éªŒè¯ (Zod)

### ç›‘æ§å’Œæ—¥å¿— (65/100)

**å½“å‰çŠ¶æ€**:
- âœ… ç»“æ„åŒ–æ—¥å¿— (console.log)
- âš ï¸ æ—  Axiom é›†æˆ
- âš ï¸ æ—  Vercel Analytics
- âš ï¸ æ— å‘Šè­¦ç³»ç»Ÿ

**å»ºè®®å®æ–½** (P1):

**1. Vercel Analytics**:
```typescript
// layout.tsx
import { Analytics } from '@vercel/analytics/react'
export default function Layout({ children }) {
  return (
    <>
      {children}
      <Analytics />
    </>
  )
}
```

**2. Axiom æ—¥å¿—**:
```typescript
// lib/logger.ts
import pino from 'pino'
export const logger = pino({
  transport: {
    target: '@axiomhq/pino',
    options: {
      dataset: 'doc-qa-system',
      token: process.env.AXIOM_TOKEN
    }
  }
})

// ä½¿ç”¨
logger.info('query_completed', {
  userId,
  duration: 620,
  chunks: 5
})
```

**3. é”™è¯¯è¿½è¸ª (Sentry)**:
```typescript
// sentry.config.js
Sentry.init({
  dsn: process.env.SENTRY_DSN,
  tracesSampleRate: 0.1,  // 10% é‡‡æ ·
  environment: process.env.NODE_ENV
})
```

### å¤‡ä»½å’Œæ¢å¤ (70/100)

**å½“å‰çŠ¶æ€**:
- âœ… Supabase è‡ªåŠ¨å¤‡ä»½ (æ¯å¤©)
- âš ï¸ æ— åº”ç”¨çº§å¤‡ä»½ç­–ç•¥
- âš ï¸ æ— æ¢å¤æµ‹è¯•

**å»ºè®®**:
1. å®šæœŸå¤‡ä»½æµ‹è¯•
2. æ–‡æ¡£æ¢å¤ SOP
3. RTO/RPO å®šä¹‰

---

## 9. å…³é”®æ”¹è¿›å»ºè®®æ€»ç»“

### ğŸ”´ ä¼˜å…ˆçº§ P0 (ç«‹å³å®æ–½)

| # | æ”¹è¿›é¡¹ | å½“å‰é£é™© | é¢„æœŸæ”¶ç›Š | å·¥ä½œé‡ |
|---|--------|---------|---------|--------|
| 1 | æ·»åŠ ä¸Šä¼ é€Ÿç‡é™åˆ¶ | å®‰å…¨ - ä¸­ | DoS é˜²æŠ¤ | 1h |
| 2 | æ·»åŠ æŸ¥è¯¢ embedding ç¼“å­˜ | æ€§èƒ½ - ä¸­ | æ£€ç´¢å¿« 380ms | 4h |
| 3 | retrievalService å•å…ƒæµ‹è¯• | è´¨é‡ - é«˜ | å‡å°‘å›å½’é£é™© | 8h |
| 4 | answerService å•å…ƒæµ‹è¯• | è´¨é‡ - é«˜ | å‡å°‘å›å½’é£é™© | 6h |
| 5 | ç©ºæ–‡æ¡£/è¶…å¤§æ–‡æ¡£å¤„ç† | åŠŸèƒ½ - ä¸­ | é¿å…å¼‚å¸¸ | 4h |
| 6 | TypeScript `any` ç±»å‹æ¶ˆé™¤ (å…³é”®è·¯å¾„) | è´¨é‡ - ä¸­ | ç±»å‹å®‰å…¨ | 16h |

**æ€»å·¥ä½œé‡**: ~39 å°æ—¶ (~5 å¤©)

### ğŸŸ¡ ä¼˜å…ˆçº§ P1 (æœ¬å‘¨å®æ–½)

| # | æ”¹è¿›é¡¹ | å½“å‰é£é™© | é¢„æœŸæ”¶ç›Š | å·¥ä½œé‡ |
|---|--------|---------|---------|--------|
| 7 | å‘é‡ç»´åº¦ä¸åŒ¹é…éªŒè¯ | åŠŸèƒ½ - ä¸­ | æ•°æ®ä¸€è‡´æ€§ | 2h |
| 8 | æ‰¹å¤„ç†å¹¶è¡Œä¼˜åŒ– | æ€§èƒ½ - ä½ | å‘é‡åŒ–å¿« 40% | 6h |
| 9 | Prompt åŠ¨æ€è°ƒæ•´ | æ€§èƒ½ - ä½ | å“åº”å¿« 30% | 4h |
| 10 | å®Œæ•´é—®ç­”æµç¨‹é›†æˆæµ‹è¯• | è´¨é‡ - ä¸­ | ç«¯åˆ°ç«¯ä¿è¯ | 8h |
| 11 | Vercel Analytics é›†æˆ | è¿ç»´ - ä¸­ | æ€§èƒ½å¯è§æ€§ | 2h |
| 12 | Axiom æ—¥å¿—é›†æˆ | è¿ç»´ - ä¸­ | ç»“æ„åŒ–ç›‘æ§ | 6h |
| 13 | CSP å¤´é…ç½® | å®‰å…¨ - ä½ | XSS é˜²æŠ¤å¢å¼º | 2h |

**æ€»å·¥ä½œé‡**: ~30 å°æ—¶ (~4 å¤©)

### ğŸŸ¢ ä¼˜å…ˆçº§ P2 (æœªæ¥å®æ–½)

- Playwright E2E æµ‹è¯•å¥—ä»¶
- å¤š LLM è‡ªåŠ¨é™çº§
- æ€§èƒ½æµ‹è¯• (k6)
- å®‰å…¨æ‰«æ (OWASP ZAP)
- å®¡è®¡æ—¥å¿—ç³»ç»Ÿ
- æ–­ç‚¹ç»­ä¼ æœºåˆ¶
- è™šæ‹Ÿæ»šåŠ¨ (å¤§æ•°æ®é‡)

---

## 10. ç»“è®º

### æ•´ä½“è¯„ä»·

**Doc-QA-System æ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œæ•´ã€æ¶æ„åˆç†ã€å®‰å…¨æ€§è‰¯å¥½çš„æ™ºèƒ½æ–‡æ¡£é—®ç­”ç³»ç»Ÿã€‚**

**ä¼˜åŠ¿**:
1. âœ… åŠŸèƒ½å®Œæ•´åº¦é«˜ (90%)
2. âœ… å®‰å…¨æªæ–½å…¨é¢ (90%)
3. âœ… é”™è¯¯å¤„ç†å¥å£® (88%)
4. âœ… æ¶æ„è®¾è®¡æ¸…æ™°
5. âœ… æ€§èƒ½è¡¨ç°è‰¯å¥½

**ä¸»è¦é£é™©**:
1. âš ï¸ æµ‹è¯•è¦†ç›–ä¸è¶³ (65%)
2. âš ï¸ æ€§èƒ½ç›‘æ§ç¼ºå¤±
3. âš ï¸ éƒ¨åˆ†è¾¹ç•Œæƒ…å†µæœªè¦†ç›–
4. âš ï¸ TypeScript ç±»å‹å®‰å…¨å¾…åŠ å¼º

### ç”Ÿäº§å°±ç»ªåº¦: 82%

**å¯ä»¥ä¸Šçº¿çš„å‰æ**:
1. å®æ–½æ‰€æœ‰ P0 æ”¹è¿› (5 å¤©)
2. æ·»åŠ åŸºæœ¬ç›‘æ§ (Vercel Analytics + Axiom)
3. å®Œæˆå…³é”®è·¯å¾„æµ‹è¯•

**ä¸Šçº¿åç«‹å³å®æ–½**:
1. P1 æ”¹è¿›é¡¹ (4 å¤©)
2. æŒç»­ç›‘æ§å’Œä¼˜åŒ–
3. æ ¹æ®ç”¨æˆ·åé¦ˆè¿­ä»£

### æ¨èçš„åç»­è¡ŒåŠ¨

**ç¬¬ä¸€å‘¨**:
1. å®æ–½æ‰€æœ‰ P0 æ”¹è¿›
2. æ·»åŠ ç›‘æ§å’Œå‘Šè­¦
3. å®Œæˆå…³é”®æµ‹è¯•

**ç¬¬äºŒå‘¨**:
4. å®æ–½ P1 æ”¹è¿›
5. æ€§èƒ½ä¼˜åŒ–éªŒè¯
6. ç”¨æˆ·ä½“éªŒå¾®è°ƒ

**é•¿æœŸ**:
7. P2 æ”¹è¿›é€æ­¥å®æ–½
8. æŒç»­é›†æˆå’Œéƒ¨ç½²ä¼˜åŒ–
9. å»ºç«‹è¿ç»´è§„èŒƒ

---

## é™„å½•

### A. æµ‹è¯•æ¸…å•

```bash
# å•å…ƒæµ‹è¯•
npm run test:unit

# é›†æˆæµ‹è¯•
npm run test:integration

# è¦†ç›–ç‡æŠ¥å‘Š
npm run test:coverage

# Lint æ£€æŸ¥
npm run lint

# ç±»å‹æ£€æŸ¥
npm run type-check

# æ„å»ºéªŒè¯
npm run build
```

### B. ç›‘æ§æŒ‡æ ‡å®šä¹‰

**å…³é”®æŒ‡æ ‡** (éœ€è¦ç›‘æ§):
- API å“åº”æ—¶é—´ (P50/P95/P99)
- LLM ç”Ÿæˆå»¶è¿Ÿ
- å‘é‡æ£€ç´¢å»¶è¿Ÿ
- é”™è¯¯ç‡
- ç”¨æˆ·æŸ¥è¯¢ QPS
- æ–‡æ¡£ä¸Šä¼ æˆåŠŸç‡

### C. å®‰å…¨æ£€æŸ¥æ¸…å•

- [ ] æ‰€æœ‰ç¯å¢ƒå˜é‡å·²è®¾ç½®
- [ ] HTTPS å¼ºåˆ¶å¯ç”¨
- [ ] CORS æ­£ç¡®é…ç½®
- [ ] é€Ÿç‡é™åˆ¶å·²å¯ç”¨
- [ ] ä¾èµ–é¡¹æ— å·²çŸ¥æ¼æ´ (npm audit)
- [ ] CSP å¤´å·²é…ç½®
- [ ] å®¡è®¡æ—¥å¿—å·²å¯ç”¨

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-01-10 18:30  
**ä¸‹æ¬¡å¤å®¡æ—¶é—´**: 2025-02-10  
**æŠ¥å‘ŠçŠ¶æ€**: æœ€ç»ˆç‰ˆ

**å®¡æ ¸äºº**: Quinn (Test Architect & Quality Advisor)  
**æ‰¹å‡†äºº**: _å¾…å®¡æ‰¹_

