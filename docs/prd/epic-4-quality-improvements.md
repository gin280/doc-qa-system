# Epic 4: ç³»ç»Ÿè´¨é‡æ”¹è¿›

**Epic ID**: 4  
**åˆ›å»ºæ—¥æœŸ**: 2025-01-10  
**è´Ÿè´£äºº**: Sarah (Product Owner)  
**ä¼˜å…ˆçº§**: P0 (Critical)  
**çŠ¶æ€**: Planning  
**åŸºäº**: QA å…¨é¢è´¨é‡è¯„ä¼°æŠ¥å‘Š (2025-01-10)  
**é¢„è®¡å·¥æœŸ**: 2å‘¨ (Week 11-12)

---

## ğŸ“‹ Epic æ¦‚è¿°

### ç›®æ ‡

åŸºäº Quinn (æµ‹è¯•æ¶æ„å¸ˆ) çš„å…¨é¢è´¨é‡è¯„ä¼°ï¼Œç³»ç»Ÿæ€§åœ°è§£å†³è¯†åˆ«å‡ºçš„å…³é”®é—®é¢˜ï¼Œæå‡ç³»ç»Ÿçš„ï¼š
- ğŸ”’ **å®‰å…¨æ€§**: DoS é˜²æŠ¤ã€ç±»å‹å®‰å…¨
- âš¡ **æ€§èƒ½**: æŸ¥è¯¢é€Ÿåº¦æå‡ 60%+
- ğŸ§ª **è´¨é‡**: æµ‹è¯•è¦†ç›–ç‡ä» 65% â†’ 80%
- ğŸ“Š **å¯è§‚æµ‹æ€§**: å®Œæ•´çš„ç›‘æ§å’Œæ—¥å¿—ä½“ç³»

### ä»·å€¼é™ˆè¿°

å®Œæˆæ­¤Epicå:

| ç»´åº¦ | å½“å‰çŠ¶æ€ | ç›®æ ‡çŠ¶æ€ | ä¸šåŠ¡å½±å“ |
|-----|---------|---------|---------|
| ç³»ç»Ÿè¯„åˆ† | 85/100 | 92/100 | ç”Ÿäº§å°±ç»ªåº¦ 82% â†’ 95% |
| æŸ¥è¯¢å“åº” | ~600ms | ~220ms | ç”¨æˆ·ä½“éªŒæ˜¾è‘—æå‡ |
| æµ‹è¯•è¦†ç›– | 65% | 80% | å›å½’é£é™©é™ä½ 50% |
| å¯è§‚æµ‹æ€§ | æ—  | å®Œæ•´ | æ•…éšœå®šä½æ—¶é—´å‡å°‘ 80% |

### åŒ…å«çš„ç”¨æˆ·æ•…äº‹

| Story ID | Storyæ ‡é¢˜ | ä¼˜å…ˆçº§ | é¢„ä¼°å·¥æ—¶ | çŠ¶æ€ |
|----------|-----------|--------|----------|------|
| 4.1 | ä¸Šä¼ é€Ÿç‡é™åˆ¶ | P0 | 1h | Planning |
| 4.2 | Query Embedding ç¼“å­˜ | P0 | 4h | Planning |
| 4.3 | RetrievalService å•å…ƒæµ‹è¯• | P0 | 8h | Planning |
| 4.4 | AnswerService å•å…ƒæµ‹è¯• | P0 | 6h | Planning |
| 4.5 | è¾¹ç•Œæƒ…å†µå¤„ç†å¢å¼º | P0 | 4h | Planning |
| 4.6 | TypeScript ç±»å‹å®‰å…¨é‡æ„ | P0 | 16h | Planning |
| 4.7 | å‘é‡ç»´åº¦éªŒè¯ | P1 | 2h | Planning |
| 4.8 | æ‰¹å¤„ç†å¹¶è¡Œä¼˜åŒ– | P1 | 6h | Planning |
| 4.9 | Prompt åŠ¨æ€è°ƒæ•´ | P1 | 4h | Planning |
| 4.10 | E2E é›†æˆæµ‹è¯• | P1 | 8h | Planning |
| 4.11 | Vercel Analytics é›†æˆ | P1 | 2h | Deferred (æ— Pro) |
| 4.12 | Axiom æ—¥å¿—é›†æˆ | P1 | 6h | Planning |
| 4.13 | CSP å¤´é…ç½® | P1 | 2h | Planning |

**æ€»è®¡**: 12ä¸ªStory (1ä¸ªå»¶æœŸ), Sprint 1: 39h, Sprint 2: 28h

### æˆåŠŸæ ‡å‡†

- âœ… æ‰€æœ‰ P0 æ”¹è¿›é¡¹å®Œæˆå¹¶é€šè¿‡ QA å®¡æ ¸
- âœ… æŸ¥è¯¢å¹³å‡å“åº”æ—¶é—´ < 250ms (ä» ~600ms) - é€šè¿‡ Lighthouse å’Œæ‰‹åŠ¨æµ‹è¯•éªŒè¯
- âœ… æµ‹è¯•è¦†ç›–ç‡ â‰¥ 80%
- âœ… Axiom æ—¥å¿—ç›‘æ§ä¸Šçº¿ (Story 4.12)
- âœ… æ—  Critical çº§åˆ«çš„å®‰å…¨æ¼æ´
- ğŸ”„ Vercel Analytics å»¶æœŸ (éœ€è¦ Pro è®¡åˆ’)

---

## ğŸ“Š æ”¹è¿›é¡¹ä¼˜å…ˆçº§çŸ©é˜µ

### Sprint 1: P0 å…³é”®æ”¹è¿› (Week 11)

**ç›®æ ‡**: è§£å†³ Critical çº§åˆ«çš„å®‰å…¨ã€æ€§èƒ½å’Œè´¨é‡é—®é¢˜

| Story | æ”¹è¿›é¡¹ | é£é™© | æ”¶ç›Š | å·¥ä½œé‡ | ä¼˜å…ˆçº§ |
|-------|-------|------|------|--------|--------|
| 4.1 | ä¸Šä¼ é€Ÿç‡é™åˆ¶ | å®‰å…¨-ä¸­ | DoS é˜²æŠ¤ | 1h | P0 |
| 4.2 | Query Embedding ç¼“å­˜ | æ€§èƒ½-ä¸­ | å¿« 380ms | 4h | P0 |
| 4.3 | RetrievalService æµ‹è¯• | è´¨é‡-é«˜ | å›å½’ä¿æŠ¤ | 8h | P0 |
| 4.4 | AnswerService æµ‹è¯• | è´¨é‡-é«˜ | å›å½’ä¿æŠ¤ | 6h | P0 |
| 4.5 | è¾¹ç•Œæƒ…å†µå¤„ç†å¢å¼º | åŠŸèƒ½-ä¸­ | ç¨³å®šæ€§ | 4h | P0 |
| 4.6 | TypeScript ç±»å‹å®‰å…¨ | è´¨é‡-ä¸­ | ç±»å‹å®‰å…¨ | 16h | P0 |

**æ€»å·¥ä½œé‡**: ~39 å°æ—¶ (~5 å¤©)

### Sprint 2: P1 é‡è¦æ”¹è¿› (Week 12)

**ç›®æ ‡**: æ€§èƒ½ä¼˜åŒ–å’Œå¯è§‚æµ‹æ€§å»ºè®¾

| Story | æ”¹è¿›é¡¹ | é£é™© | æ”¶ç›Š | å·¥ä½œé‡ | ä¼˜å…ˆçº§ |
|-------|-------|------|------|--------|--------|
| 4.7 | å‘é‡ç»´åº¦éªŒè¯ | åŠŸèƒ½-ä¸­ | æ•°æ®ä¸€è‡´æ€§ | 2h | P1 |
| 4.8 | æ‰¹å¤„ç†å¹¶è¡Œä¼˜åŒ– | æ€§èƒ½-ä½ | å¿« 40% | 6h | P1 |
| 4.9 | Prompt åŠ¨æ€è°ƒæ•´ | æ€§èƒ½-ä½ | å¿« 30% | 4h | P1 |
| 4.10 | E2E é›†æˆæµ‹è¯• | è´¨é‡-ä¸­ | ç«¯åˆ°ç«¯ä¿è¯ | 8h | P1 |
| 4.11 | Vercel Analytics | è¿ç»´-ä¸­ | æ€§èƒ½å¯è§ | 2h | P1 |
| 4.12 | Axiom æ—¥å¿—é›†æˆ | è¿ç»´-ä¸­ | ç»“æ„åŒ–ç›‘æ§ | 6h | P1 |
| 4.13 | CSP å¤´é…ç½® | å®‰å…¨-ä½ | XSS å¢å¼º | 2h | P1 |

**æ€»å·¥ä½œé‡**: ~30 å°æ—¶ (~4 å¤©)

### Backlog: P2 æœªæ¥æ”¹è¿›

- Playwright E2E æµ‹è¯•å¥—ä»¶
- å¤š LLM è‡ªåŠ¨é™çº§
- æ€§èƒ½æµ‹è¯• (k6)
- å®‰å…¨æ‰«æ (OWASP ZAP)
- å®¡è®¡æ—¥å¿—ç³»ç»Ÿ
- æ–­ç‚¹ç»­ä¼ æœºåˆ¶
- è™šæ‹Ÿæ»šåŠ¨ (å¤§æ•°æ®é‡)

---

## ğŸ“– Story è¯¦ç»†è§„åˆ’

### Story 4.1: æ·»åŠ ä¸Šä¼ é€Ÿç‡é™åˆ¶

**ä¼˜å…ˆçº§**: P0  
**å·¥ä½œé‡**: 1 å°æ—¶  
**è´Ÿè´£è§’è‰²**: Dev

#### èƒŒæ™¯

å½“å‰ä¸Šä¼ ç«¯ç‚¹æ²¡æœ‰é€Ÿç‡é™åˆ¶ï¼Œå­˜åœ¨ DoS æ”»å‡»é£é™©ã€‚éœ€è¦æ·»åŠ åŸºäºç”¨æˆ· ID çš„é€Ÿç‡é™åˆ¶ã€‚

#### Acceptance Criteria

1. âœ… ä¸Šä¼ ç«¯ç‚¹æ·»åŠ é€Ÿç‡é™åˆ¶: 10 æ¬¡/åˆ†é’Ÿ
2. âœ… è¶…è¿‡é™åˆ¶è¿”å› 429 çŠ¶æ€ç å’Œå‹å¥½é”™è¯¯æ¶ˆæ¯
3. âœ… é€Ÿç‡é™åˆ¶å“åº”åŒ…å« `Retry-After` å¤´
4. âœ… å•å…ƒæµ‹è¯•è¦†ç›–é€Ÿç‡é™åˆ¶é€»è¾‘
5. âœ… é›†æˆæµ‹è¯•éªŒè¯é™åˆ¶ç”Ÿæ•ˆ

#### æŠ€æœ¯å®ç°è¦ç‚¹

```typescript
// src/app/api/documents/upload/route.ts
await checkRateLimit(`upload:${userId}`, {
  windowMs: 60 * 1000,  // 1åˆ†é’Ÿ
  max: 10               // 10æ¬¡
})
```

#### Definition of Done

- [ ] ä»£ç å®ç°å¹¶é€šè¿‡ CR
- [ ] å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•é€šè¿‡
- [ ] QA å®¡æ ¸é€šè¿‡
- [ ] æ–‡æ¡£æ›´æ–° (API é™åˆ¶è¯´æ˜)

---

### Story 4.2: å®ç° Query Embedding ç¼“å­˜

**ä¼˜å…ˆçº§**: P0  
**å·¥ä½œé‡**: 4 å°æ—¶  
**è´Ÿè´£è§’è‰²**: Dev + Architect å’¨è¯¢

#### èƒŒæ™¯

å½“å‰æ¯æ¬¡æŸ¥è¯¢éƒ½éœ€è¦è°ƒç”¨ Embedding API (~380ms)ï¼Œå³ä½¿æ˜¯ç›¸åŒçš„æŸ¥è¯¢ã€‚é€šè¿‡ç¼“å­˜ query embeddingï¼Œå¯ä»¥å°†æ£€ç´¢æ—¶é—´ä» ~600ms å‡å°‘åˆ° ~220msã€‚

#### Acceptance Criteria

1. âœ… ä½¿ç”¨ Redis ç¼“å­˜ query embedding (key: hash(query))
2. âœ… ç¼“å­˜å‘½ä¸­æ—¶ç›´æ¥ä½¿ç”¨ç¼“å­˜çš„å‘é‡
3. âœ… ç¼“å­˜ TTL: 1 å°æ—¶
4. âœ… ç¼“å­˜å¤±æ•ˆç­–ç•¥: LRU
5. âœ… æŸ¥è¯¢å“åº”æ—¶é—´å¹³å‡ < 250ms (ä» ~600ms)
6. âœ… ç¼“å­˜å‘½ä¸­ç‡ç›‘æ§ (>60%)
7. âœ… å•å…ƒæµ‹è¯•è¦†ç›–ç¼“å­˜é€»è¾‘
8. âœ… æ€§èƒ½æµ‹è¯•éªŒè¯æå‡æ•ˆæœ

#### æŠ€æœ¯å®ç°è¦ç‚¹

```typescript
// src/services/rag/queryVectorizer.ts
async vectorizeQuery(query: string): Promise<number[]> {
  const cacheKey = `qv:${hash(query)}`
  
  // å°è¯•ä»ç¼“å­˜è·å–
  const cached = await redis.get(cacheKey)
  if (cached) {
    return JSON.parse(cached)
  }
  
  // ç¼“å­˜æœªå‘½ä¸­ï¼Œè°ƒç”¨ Embedding API
  const vector = await llm.generateEmbedding(query)
  await redis.set(cacheKey, JSON.stringify(vector), { ex: 3600 })
  
  return vector
}
```

#### æ€§èƒ½ç›®æ ‡

| æŒ‡æ ‡ | å½“å‰ | ç›®æ ‡ | æå‡ |
|-----|------|------|------|
| æ£€ç´¢æ—¶é—´ (ç¼“å­˜å‘½ä¸­) | 600ms | 220ms | 63% â¬‡ï¸ |
| æ£€ç´¢æ—¶é—´ (ç¼“å­˜æœªå‘½ä¸­) | 600ms | 600ms | 0% |
| ç¼“å­˜å‘½ä¸­ç‡ | N/A | >60% | - |

#### Definition of Done

- [ ] Redis ç¼“å­˜å®ç°
- [ ] å•å…ƒæµ‹è¯•å’Œæ€§èƒ½æµ‹è¯•é€šè¿‡
- [ ] ç¼“å­˜å‘½ä¸­ç‡ç›‘æ§é…ç½®
- [ ] QA æ€§èƒ½æµ‹è¯•éªŒè¯
- [ ] æ–‡æ¡£æ›´æ–°

---

### Story 4.3: RetrievalService å•å…ƒæµ‹è¯•

**ä¼˜å…ˆçº§**: P0  
**å·¥ä½œé‡**: 8 å°æ—¶  
**è´Ÿè´£è§’è‰²**: Dev + QA åä½œ

#### èƒŒæ™¯

RetrievalService æ˜¯ RAG æ ¸å¿ƒæœåŠ¡ï¼Œä½†å½“å‰ç¼ºå°‘å•å…ƒæµ‹è¯•ï¼Œå­˜åœ¨å›å½’é£é™©ã€‚éœ€è¦å®Œæ•´çš„æµ‹è¯•è¦†ç›–ã€‚

#### Acceptance Criteria

1. âœ… æµ‹è¯•è¦†ç›–ç‡ â‰¥ 90%
2. âœ… æ ¸å¿ƒæ–¹æ³• `retrieveContext` å®Œæ•´æµ‹è¯•
3. âœ… è¾¹ç•Œæƒ…å†µæµ‹è¯•:
   - ç©ºæŸ¥è¯¢
   - è¶…é•¿æŸ¥è¯¢ (>1000å­—ç¬¦)
   - æ–‡æ¡£ä¸å­˜åœ¨
   - æ–‡æ¡£æœªå°±ç»ª
   - æ— ç›¸å…³å†…å®¹
4. âœ… ç¼“å­˜é€»è¾‘æµ‹è¯• (å‘½ä¸­/æœªå‘½ä¸­)
5. âœ… é”™è¯¯å¤„ç†æµ‹è¯• (æ‰€æœ‰è‡ªå®šä¹‰é”™è¯¯ç±»å‹)
6. âœ… Mock å¤–éƒ¨ä¾èµ– (db, vectorRepo)

#### æµ‹è¯•ç”¨ä¾‹æ¸…å•

**æ­£å¸¸æµç¨‹**:
- âœ… åº”è¯¥è¿”å›ç›¸å…³çš„ chunks
- âœ… åº”è¯¥æŒ‰ç›¸ä¼¼åº¦æ’åº chunks
- âœ… åº”è¯¥é™åˆ¶è¿”å›æ•°é‡ (topK)
- âœ… åº”è¯¥è¿‡æ»¤ä½åˆ† chunks (minScore)

**è¾¹ç•Œæƒ…å†µ**:
- âœ… åº”è¯¥åœ¨æŸ¥è¯¢ä¸ºç©ºæ—¶æŠ›å‡ºé”™è¯¯
- âœ… åº”è¯¥åœ¨æŸ¥è¯¢è¶…é•¿æ—¶æŠ›å‡ºé”™è¯¯
- âœ… åº”è¯¥åœ¨æ–‡æ¡£ä¸å­˜åœ¨æ—¶æŠ›å‡ºé”™è¯¯
- âœ… åº”è¯¥åœ¨æ–‡æ¡£æœªå°±ç»ªæ—¶æŠ›å‡ºé”™è¯¯
- âœ… åº”è¯¥åœ¨æ— ç›¸å…³å†…å®¹æ—¶æŠ›å‡ºé”™è¯¯

**ç¼“å­˜é€»è¾‘**:
- âœ… åº”è¯¥åœ¨ç¼“å­˜å‘½ä¸­æ—¶è¿”å›ç¼“å­˜ç»“æœ
- âœ… åº”è¯¥åœ¨ç¼“å­˜æœªå‘½ä¸­æ—¶è°ƒç”¨æ£€ç´¢
- âœ… åº”è¯¥åœ¨ç¦ç”¨ç¼“å­˜æ—¶è·³è¿‡ç¼“å­˜

#### Definition of Done

- [ ] æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹å®ç°å¹¶é€šè¿‡
- [ ] ä»£ç è¦†ç›–ç‡ â‰¥ 90%
- [ ] QA å®¡æ ¸æµ‹è¯•è´¨é‡
- [ ] CI/CD é›†æˆ

---

### Story 4.4: AnswerService å•å…ƒæµ‹è¯•

**ä¼˜å…ˆçº§**: P0  
**å·¥ä½œé‡**: 6 å°æ—¶  
**è´Ÿè´£è§’è‰²**: Dev + QA åä½œ

#### èƒŒæ™¯

AnswerService è´Ÿè´£ LLM ç”Ÿæˆï¼Œç¼ºå°‘å•å…ƒæµ‹è¯•ã€‚éœ€è¦æµ‹è¯•è¦†ç›–æå‡ç³»ç»Ÿç¨³å®šæ€§ã€‚

#### Acceptance Criteria

1. âœ… æµ‹è¯•è¦†ç›–ç‡ â‰¥ 90%
2. âœ… æ ¸å¿ƒæ–¹æ³• `generateAnswer` å®Œæ•´æµ‹è¯•
3. âœ… æµå¼ç”Ÿæˆé€»è¾‘æµ‹è¯•
4. âœ… å†å²æˆªæ–­é€»è¾‘æµ‹è¯• (Token é™åˆ¶)
5. âœ… Prompt æ„å»ºæµ‹è¯•
6. âœ… é”™è¯¯å¤„ç†æµ‹è¯• (è¶…æ—¶ã€é…é¢ã€ç”Ÿæˆå¤±è´¥)
7. âœ… Mock LLM ä¾èµ–

#### æµ‹è¯•ç”¨ä¾‹æ¸…å•

**æ­£å¸¸æµç¨‹**:
- âœ… åº”è¯¥ç”Ÿæˆæµå¼å›ç­”
- âœ… åº”è¯¥åŒ…å«å†å²å¯¹è¯
- âœ… åº”è¯¥æˆªæ–­è¿‡é•¿çš„å†å² (ä¿ç•™æœ€è¿‘ N æ¡)
- âœ… åº”è¯¥ä½¿ç”¨æ­£ç¡®çš„ Prompt æ¨¡æ¿

**é”™è¯¯å¤„ç†**:
- âœ… åº”è¯¥åœ¨ LLM è¶…æ—¶æ—¶æŠ›å‡ºé”™è¯¯
- âœ… åº”è¯¥åœ¨é…é¢è¶…é™æ—¶æŠ›å‡ºé”™è¯¯
- âœ… åº”è¯¥åœ¨ç”Ÿæˆå¤±è´¥æ—¶æŠ›å‡ºé”™è¯¯

**è¾¹ç•Œæƒ…å†µ**:
- âœ… åº”è¯¥å¤„ç†ç©ºå†å²
- âœ… åº”è¯¥å¤„ç†éå¸¸é•¿çš„æŸ¥è¯¢
- âœ… åº”è¯¥å¤„ç†ç‰¹æ®Šå­—ç¬¦

#### Definition of Done

- [ ] æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹å®ç°å¹¶é€šè¿‡
- [ ] ä»£ç è¦†ç›–ç‡ â‰¥ 90%
- [ ] QA å®¡æ ¸æµ‹è¯•è´¨é‡
- [ ] CI/CD é›†æˆ

---

### Story 4.5: è¾¹ç•Œæƒ…å†µå¤„ç†å¢å¼º

**ä¼˜å…ˆçº§**: P0  
**å·¥ä½œé‡**: 4 å°æ—¶  
**è´Ÿè´£è§’è‰²**: Dev

#### èƒŒæ™¯

å½“å‰ç³»ç»Ÿå¯¹ç©ºæ–‡æ¡£ã€è¶…å¤§æ–‡æ¡£ã€å‘é‡ç»´åº¦ä¸åŒ¹é…ç­‰è¾¹ç•Œæƒ…å†µå¤„ç†ä¸å……åˆ†ï¼Œéœ€è¦å¢å¼ºå¥å£®æ€§ã€‚

#### Acceptance Criteria

1. âœ… **ç©ºæ–‡æ¡£å¤„ç†**:
   - æ£€æµ‹ content length = 0
   - è¿”å›å‹å¥½é”™è¯¯: "æ–‡æ¡£å†…å®¹ä¸ºç©ºï¼Œæ— æ³•å¤„ç†"
   - è®¾ç½®çŠ¶æ€ä¸º FAILED
   - å•å…ƒæµ‹è¯•è¦†ç›–

2. âœ… **è¶…å¤§æ–‡æ¡£å¤„ç†**:
   - é™åˆ¶æœ€å¤§ chunks æ•°: 10,000
   - è¶…è¿‡é™åˆ¶æ—¶æˆªæ–­å¹¶å‘Šè­¦
   - è®°å½•å‘Šè­¦æ—¥å¿—
   - å•å…ƒæµ‹è¯•è¦†ç›–

3. âœ… **å‘é‡ç»´åº¦éªŒè¯**:
   - åœ¨ embedding å‰éªŒè¯ç»´åº¦
   - ä¸åŒ¹é…æ—¶æŠ›å‡ºæ˜ç¡®é”™è¯¯
   - è®°å½•é”™è¯¯æ—¥å¿—
   - å•å…ƒæµ‹è¯•è¦†ç›–

4. âœ… **Unicode ç‰¹æ®Šå­—ç¬¦å¤„ç†**:
   - æ·»åŠ  Unicode æµ‹è¯•ç”¨ä¾‹
   - éªŒè¯ä¸­æ–‡ã€Emojiã€ç‰¹æ®Šç¬¦å·
   - é›†æˆæµ‹è¯•è¦†ç›–

#### æŠ€æœ¯å®ç°è¦ç‚¹

```typescript
// ç©ºæ–‡æ¡£æ£€æµ‹
if (!parsedContent || parsedContent.trim().length === 0) {
  throw new ChunkingError('æ–‡æ¡£å†…å®¹ä¸ºç©ºï¼Œæ— æ³•å¤„ç†')
}

// è¶…å¤§æ–‡æ¡£é™åˆ¶
const MAX_CHUNKS = 10000
if (chunks.length > MAX_CHUNKS) {
  logger.warn('Document exceeds max chunks', {
    documentId,
    chunksCount: chunks.length,
    maxChunks: MAX_CHUNKS
  })
  chunks = chunks.slice(0, MAX_CHUNKS)
}

// å‘é‡ç»´åº¦éªŒè¯
const expectedDimension = llmConfig.provider === 'zhipu' ? 1024 : 1536
if (vector.length !== expectedDimension) {
  throw new EmbeddingError(
    `Vector dimension mismatch: expected ${expectedDimension}, got ${vector.length}`,
    'DIMENSION_MISMATCH'
  )
}
```

#### Definition of Done

- [ ] æ‰€æœ‰è¾¹ç•Œæƒ…å†µå®ç°å¹¶æµ‹è¯•
- [ ] å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•é€šè¿‡
- [ ] é”™è¯¯æ¶ˆæ¯å‹å¥½ä¸”å¯æ“ä½œ
- [ ] QA å®¡æ ¸é€šè¿‡

---

### Story 4.6: TypeScript ç±»å‹å®‰å…¨é‡æ„

**ä¼˜å…ˆçº§**: P0  
**å·¥ä½œé‡**: 16 å°æ—¶  
**è´Ÿè´£è§’è‰²**: Dev

#### èƒŒæ™¯

å½“å‰ä»£ç ä¸­æœ‰ 24 å¤„ `any` ç±»å‹ä½¿ç”¨ï¼Œå¯¼è‡´ç±»å‹å®‰å…¨é£é™©ã€‚éœ€è¦ç³»ç»Ÿæ€§åœ°æ¶ˆé™¤ `any`ï¼Œä½¿ç”¨æ˜ç¡®çš„ç±»å‹å®šä¹‰ã€‚

#### Acceptance Criteria

1. âœ… æ¶ˆé™¤å…³é”®è·¯å¾„çš„æ‰€æœ‰ `any` ç±»å‹
2. âœ… å®šä¹‰æ˜ç¡®çš„æ¥å£å’Œç±»å‹
3. âœ… ä½¿ç”¨ `unknown` æ›¿ä»£ `any` (éœ€ç±»å‹å®ˆå«)
4. âœ… æ·»åŠ ç±»å‹æµ‹è¯• (tsc --noEmit)
5. âœ… Linter æ£€æŸ¥é€šè¿‡ (0 warnings)
6. âœ… æ‰€æœ‰æµ‹è¯•ä»ç„¶é€šè¿‡

#### é‡ç‚¹æ–‡ä»¶

| æ–‡ä»¶ | any æ•°é‡ | ä¼˜å…ˆçº§ |
|-----|---------|--------|
| `src/app/api/chat/query/route.ts` | 2 | P0 |
| `src/app/api/conversations/*/route.ts` | 6 | P0 |
| `src/hooks/useChat.ts` | 3 | P0 |
| `src/hooks/useConversations.ts` | 2 | P1 |
| å…¶ä»–æ–‡ä»¶ | 11 | P2 |

#### é‡æ„ç­–ç•¥

**1. é”™è¯¯å¤„ç†ç±»å‹åŒ–**:
```typescript
// âŒ å½“å‰
catch (error: any) {
  const message = error.message
}

// âœ… æ”¹è¿›
catch (error: unknown) {
  const message = error instanceof Error 
    ? error.message 
    : 'Unknown error'
}
```

**2. API å“åº”ç±»å‹åŒ–**:
```typescript
// src/types/api.ts
export interface ApiError {
  error: string
  details?: string
}

export interface ApiResponse<T> {
  success: boolean
  data?: T
  error?: ApiError
}
```

**3. Event Handler ç±»å‹åŒ–**:
```typescript
// âŒ å½“å‰
const handleUpload = (e: any) => { }

// âœ… æ”¹è¿›
const handleUpload = (e: React.ChangeEvent<HTMLInputElement>) => { }
```

#### Definition of Done

- [ ] å…³é”®è·¯å¾„ (P0) çš„ `any` å…¨éƒ¨æ¶ˆé™¤
- [ ] æ–°å¢ç±»å‹å®šä¹‰æ–‡ä»¶
- [ ] `npm run lint` 0 warnings
- [ ] `npm run type-check` é€šè¿‡
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] QA ä»£ç å®¡æŸ¥é€šè¿‡

---

### Story 4.7-4.13: P1 æ”¹è¿›é¡¹ (ç®€è¦è¯´æ˜)

**4.7 å‘é‡ç»´åº¦éªŒè¯** (2h):
- åœ¨ embedding æ—¶éªŒè¯ç»´åº¦ä¸€è‡´æ€§
- æ·»åŠ å•å…ƒæµ‹è¯•

**4.8 æ‰¹å¤„ç†å¹¶è¡Œä¼˜åŒ–** (6h):
- å‘é‡åŒ–æ‰¹æ¬¡å¹¶è¡Œå¤„ç† (é™åˆ¶å¹¶å‘æ•°)
- æ€§èƒ½æµ‹è¯•éªŒè¯ 40% æå‡

**4.9 Prompt åŠ¨æ€è°ƒæ•´** (4h):
- æ ¹æ®é—®é¢˜å¤æ‚åº¦åŠ¨æ€è°ƒæ•´ maxTokens
- ç®€å•é—®é¢˜ 300, å¤æ‚é—®é¢˜ 500

**4.10 E2E é›†æˆæµ‹è¯•** (8h):
- å®Œæ•´é—®ç­”æµç¨‹: ä¸Šä¼ â†’è§£æâ†’åˆ†å—â†’å‘é‡åŒ–â†’æ£€ç´¢â†’ç”Ÿæˆ
- ç«¯åˆ°ç«¯éªŒè¯

**4.11 Vercel Analytics** (2h):
- é›†æˆ `@vercel/analytics/react`
- é…ç½®æ€§èƒ½ç›‘æ§

**4.12 Axiom æ—¥å¿—** (6h):
- é›†æˆ `@axiomhq/pino`
- ç»“æ„åŒ–æ—¥å¿—é…ç½®

**4.13 CSP å¤´é…ç½®** (2h):
- é…ç½® Content-Security-Policy
- XSS é˜²æŠ¤å¢å¼º

---

## ğŸ“… Sprint æ‰§è¡Œè®¡åˆ’

### Sprint 1: P0 å…³é”®æ”¹è¿› (Week 11)

#### Sprint ç›®æ ‡

**æ ¸å¿ƒç›®æ ‡**: æ¶ˆé™¤ Critical çº§åˆ«çš„å®‰å…¨ã€æ€§èƒ½å’Œè´¨é‡é£é™©

**éªŒæ”¶æ ‡å‡†**:
- âœ… æ‰€æœ‰ P0 Story å®Œæˆå¹¶é€šè¿‡ QA Gate
- âœ… æµ‹è¯•è¦†ç›–ç‡ä» 65% â†’ 70%
- âœ… æŸ¥è¯¢å“åº”æ—¶é—´ä» 600ms â†’ <300ms
- âœ… æ—  Critical å®‰å…¨æ¼æ´

#### è¯¦ç»†æ’æœŸ

**Day 1 (Monday)**

**Story 4.1: ä¸Šä¼ é€Ÿç‡é™åˆ¶** (1h)
- è´Ÿè´£äºº: Dev (James)
- éªŒæ”¶äºº: QA (Quinn)
- ä»»åŠ¡:
  - æ·»åŠ  `checkRateLimit` åˆ°ä¸Šä¼ ç«¯ç‚¹
  - é…ç½®: 10æ¬¡/åˆ†é’Ÿ
  - å•å…ƒæµ‹è¯• + é›†æˆæµ‹è¯•
- é¢„æœŸå®Œæˆæ—¶é—´: ä¸Šåˆ

**Story 4.2: Query Embedding ç¼“å­˜** (4h)
- è´Ÿè´£äºº: Dev (James)
- åä½œ: Architect (Winston) å’¨è¯¢
- éªŒæ”¶äºº: QA (Quinn)
- ä»»åŠ¡:
  1. å®ç° Redis ç¼“å­˜é€»è¾‘
  2. ç¼“å­˜ key: `qv:${hash(query)}`
  3. TTL: 3600ç§’
  4. å•å…ƒæµ‹è¯•è¦†ç›–
  5. æ€§èƒ½æµ‹è¯•éªŒè¯
- é¢„æœŸå®Œæˆæ—¶é—´: ä¸‹åˆ + éƒ¨åˆ† Day 2

---

**Day 2 (Tuesday)**

**Story 4.2 (ç»­)**: å®Œæˆæ€§èƒ½æµ‹è¯•å’Œ QA å®¡æ ¸
- é¢„æœŸå®Œæˆ: ä¸­åˆ

---

**Day 3 (Wednesday)**

**Story 4.3: RetrievalService å•å…ƒæµ‹è¯•** (8h)
- è´Ÿè´£äºº: Dev (James)
- åä½œ: QA (Quinn)
- ä»»åŠ¡:
  1. è®¾è®¡æµ‹è¯•ç”¨ä¾‹ (ä¸ QA åä½œ)
  2. å®ç°æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹:
     - æ­£å¸¸æµç¨‹ (4 cases)
     - è¾¹ç•Œæƒ…å†µ (5 cases)
     - ç¼“å­˜é€»è¾‘ (3 cases)
  3. è¾¾åˆ° 90% è¦†ç›–ç‡
  4. CI/CD é›†æˆ
- é¢„æœŸå®Œæˆæ—¶é—´: å…¨å¤©

---

**Day 4 (Thursday)**

**Story 4.4: AnswerService å•å…ƒæµ‹è¯•** (6h)
- è´Ÿè´£äºº: Dev (James)
- åä½œ: QA (Quinn)
- ä»»åŠ¡:
  1. è®¾è®¡æµ‹è¯•ç”¨ä¾‹
  2. å®ç°æµ‹è¯•:
     - æ­£å¸¸æµç¨‹ (4 cases)
     - é”™è¯¯å¤„ç† (3 cases)
     - è¾¹ç•Œæƒ…å†µ (3 cases)
  3. è¾¾åˆ° 90% è¦†ç›–ç‡
- é¢„æœŸå®Œæˆæ—¶é—´: å…¨å¤©

---

**Day 5 (Friday)**

**Story 4.5: è¾¹ç•Œæƒ…å†µå¤„ç†å¢å¼º** (4h)
- è´Ÿè´£äºº: Dev (James)
- ä»»åŠ¡:
  1. ç©ºæ–‡æ¡£æ£€æµ‹
  2. è¶…å¤§æ–‡æ¡£é™åˆ¶ (10000 chunks)
  3. å‘é‡ç»´åº¦éªŒè¯
  4. Unicode æµ‹è¯•ç”¨ä¾‹
- é¢„æœŸå®Œæˆæ—¶é—´: ä¸Šåˆ

**Story 4.6: TypeScript ç±»å‹å®‰å…¨é‡æ„** (16h - å¼€å§‹)
- è´Ÿè´£äºº: Dev (James)
- ä»»åŠ¡ (Day 5):
  1. åˆ†æ 24 å¤„ `any` ä½¿ç”¨
  2. åˆ¶å®šé‡æ„è®¡åˆ’
  3. å¼€å§‹ P0 æ–‡ä»¶é‡æ„
- Day 5 é¢„æœŸ: å®Œæˆ 30% (~5h)

#### Sprint 1 éªŒæ”¶

**Friday EOD Sprint Review**:
- Dev æ¼”ç¤ºæ‰€æœ‰å®Œæˆçš„ Story
- QA ç¡®è®¤æ‰€æœ‰ Gate çŠ¶æ€
- PO éªŒæ”¶å¹¶ç¡®è®¤ Sprint ç›®æ ‡è¾¾æˆ

**Sprint 1 æŒ‡æ ‡**:
- [ ] Story 4.1-4.5 å®Œæˆ (100%)
- [ ] Story 4.6 å®Œæˆ 30%
- [ ] æµ‹è¯•è¦†ç›–ç‡ â‰¥ 70%
- [ ] æŸ¥è¯¢å“åº”æ—¶é—´ < 300ms
- [ ] æ—  Critical é—®é¢˜

---

### Sprint 2: P1 é‡è¦æ”¹è¿› (Week 12)

#### Sprint ç›®æ ‡

**æ ¸å¿ƒç›®æ ‡**: æ€§èƒ½ä¼˜åŒ–å’Œå®Œæ•´çš„å¯è§‚æµ‹æ€§ä½“ç³»

**éªŒæ”¶æ ‡å‡†**:
- âœ… æ‰€æœ‰ P1 Story å®Œæˆ
- âœ… æµ‹è¯•è¦†ç›–ç‡ â‰¥ 80%
- âœ… æŸ¥è¯¢å“åº”æ—¶é—´ < 250ms
- âœ… ç›‘æ§ä½“ç³»å®Œæ•´ä¸Šçº¿

#### è¯¦ç»†æ’æœŸ

**Day 1 (Monday)**

**Story 4.6 (ç»­): TypeScript ç±»å‹å®‰å…¨** (å®Œæˆå‰©ä½™ 70%)
- ä»»åŠ¡:
  1. å®Œæˆ P0 æ–‡ä»¶é‡æ„
  2. P1 æ–‡ä»¶é‡æ„
  3. ç±»å‹å®šä¹‰è¡¥å……
  4. Lint æ£€æŸ¥
- é¢„æœŸå®Œæˆ: å…¨å¤©

---

**Day 2 (Tuesday)**

**Story 4.7: å‘é‡ç»´åº¦éªŒè¯** (2h)
- ä»»åŠ¡:
  - Embedding å‰éªŒè¯ç»´åº¦
  - ä¸åŒ¹é…æ—¶æ˜ç¡®é”™è¯¯
  - å•å…ƒæµ‹è¯•
- é¢„æœŸå®Œæˆ: ä¸Šåˆ

**Story 4.8: æ‰¹å¤„ç†å¹¶è¡Œä¼˜åŒ–** (6h)
- ä»»åŠ¡:
  1. æ‰¹æ¬¡å¹¶è¡Œå¤„ç† (é™åˆ¶å¹¶å‘æ•° 3)
  2. æ€§èƒ½æµ‹è¯•éªŒè¯
  3. ç›‘æ§æ—¥å¿—
- é¢„æœŸå®Œæˆ: ä¸‹åˆ + éƒ¨åˆ† Day 3

---

**Day 3 (Wednesday)**

**Story 4.8 (ç»­)**: å®Œæˆæµ‹è¯•å’ŒéªŒè¯

**Story 4.9: Prompt åŠ¨æ€è°ƒæ•´** (4h)
- ä»»åŠ¡:
  - é—®é¢˜å¤æ‚åº¦åˆ¤æ–­
  - åŠ¨æ€ maxTokens (300/500)
  - å•å…ƒæµ‹è¯•
- é¢„æœŸå®Œæˆ: ä¸‹åˆ

---

**Day 4 (Thursday)**

**Story 4.10: E2E é›†æˆæµ‹è¯•** (8h)
- è´Ÿè´£äºº: Dev + QA åä½œ
- ä»»åŠ¡:
  1. å®Œæ•´æµç¨‹æµ‹è¯•:
     - ä¸Šä¼ æ–‡æ¡£
     - ç­‰å¾…å¤„ç†å®Œæˆ
     - å‘èµ·æŸ¥è¯¢
     - éªŒè¯å›ç­”
  2. è¾¹ç•Œæƒ…å†µæµ‹è¯•
  3. æ€§èƒ½æµ‹è¯•
- é¢„æœŸå®Œæˆ: å…¨å¤©

---

**Day 5 (Friday)**

~~**Story 4.11: Vercel Analytics** (2h)~~ - **å»¶æœŸ** (æ—  Vercel Pro)

**Story 4.12: Axiom æ—¥å¿—é›†æˆ** (6h)
- ä»»åŠ¡:
  1. å®‰è£… `@axiomhq/pino`
  2. é…ç½® logger
  3. é‡æ„å…³é”®æ—¥å¿—
  4. Dashboard é…ç½®
- é¢„æœŸå®Œæˆ: ä¸‹åˆ

**Story 4.13: CSP å¤´é…ç½®** (2h)
- ä»»åŠ¡:
  - é…ç½® CSP ç­–ç•¥
  - æµ‹è¯•éªŒè¯
- é¢„æœŸå®Œæˆ: ä¸‹åˆ (å¦‚æ—¶é—´å…è®¸)

#### Sprint 2 éªŒæ”¶

**Friday EOD Sprint Review**:
- Dev æ¼”ç¤ºæ‰€æœ‰å®Œæˆçš„åŠŸèƒ½
- QA ç¡®è®¤ç›‘æ§ä½“ç³»å¯ç”¨
- PO éªŒæ”¶ Epic 4 å®Œæˆåº¦

**Sprint 2 æŒ‡æ ‡**:
- [ ] Story 4.6-4.10, 4.12-4.13 å®Œæˆ (Story 4.11 å»¶æœŸ)
- [ ] æµ‹è¯•è¦†ç›–ç‡ â‰¥ 80%
- [ ] æŸ¥è¯¢å“åº”æ—¶é—´ < 250ms (é€šè¿‡ Lighthouse éªŒè¯)
- [ ] Axiom æ—¥å¿—ç³»ç»Ÿä¸Šçº¿

---

## ğŸ“Š å›¢é˜Ÿå®¹é‡è§„åˆ’

### èµ„æºåˆ†é…

**Dev (James)**:
- Sprint 1: 40h (5å¤© Ã— 8h)
- Sprint 2: 40h (5å¤© Ã— 8h)
- **æ€»è®¡**: 80h

**QA (Quinn)**:
- æµ‹è¯•è®¾è®¡: 8h
- ä»£ç å®¡æŸ¥: 10h
- æµ‹è¯•éªŒè¯: 12h
- **æ€»è®¡**: 30h

**Architect (Winston)**:
- æ¶æ„å’¨è¯¢: 4h
- ä»£ç å®¡æŸ¥: 4h
- **æ€»è®¡**: 8h

### å·¥ä½œé‡å¯¹æ¯”

| Sprint | è®¡åˆ’å·¥ä½œé‡ | å›¢é˜Ÿå®¹é‡ | ç¼“å†² |
|--------|-----------|---------|------|
| Sprint 1 | 39h | 40h | 1h (3%) |
| Sprint 2 | 28h | 40h | 12h (30%) |

**é£é™©**: Sprint 1 å®¹é‡ç´§å¼ ï¼Œéœ€è¦ä¸¥æ ¼æ§åˆ¶èŒƒå›´ã€‚

---

## ğŸš¨ é£é™©ä¸ä¾èµ–ç®¡ç†

### è¯†åˆ«çš„é£é™©

#### é£é™© 1: Sprint 1 å®¹é‡ä¸è¶³

**æ¦‚ç‡**: ä¸­  
**å½±å“**: é«˜  
**ç¼“è§£ç­–ç•¥**:
- Story 4.6 å¯ä»¥å»¶ç»­åˆ° Sprint 2
- ä¼˜å…ˆå®Œæˆ Story 4.1-4.5
- å‡†å¤‡ Plan B: å°†éƒ¨åˆ† P1 æ¨è¿Ÿåˆ°ä¸‹ä¸€ä¸ªè¿­ä»£

#### é£é™© 2: æ€§èƒ½ä¼˜åŒ–æœªè¾¾é¢„æœŸ

**æ¦‚ç‡**: ä½  
**å½±å“**: ä¸­  
**ç¼“è§£ç­–ç•¥**:
- åœ¨ Dev ç¯å¢ƒå…ˆéªŒè¯
- ä½¿ç”¨æ€§èƒ½æµ‹è¯•å·¥å…·
- å‡†å¤‡å›æ»šæ–¹æ¡ˆ

#### é£é™© 3: æµ‹è¯•å®æ–½æ—¶é—´è¶…æœŸ

**æ¦‚ç‡**: ä¸­  
**å½±å“**: ä¸­  
**ç¼“è§£ç­–ç•¥**:
- Dev å’Œ QA ç´§å¯†åä½œ
- ä¼˜å…ˆè¦†ç›–å…³é”®è·¯å¾„
- å¿…è¦æ—¶è°ƒæ•´è¦†ç›–ç‡ç›®æ ‡ (75% vs 80%)

### ä¾èµ–ç®¡ç†

**å¤–éƒ¨ä¾èµ–**:
- ~~Vercel Analytics è®¿é—®æƒé™~~ (Story 4.11 å»¶æœŸ)
- Axiom è´¦å·è®¾ç½®
- Redis ç¯å¢ƒé…ç½®

**æ“ä½œ**: PO åœ¨ Sprint å¼€å§‹å‰ç¡®ä¿æ‰€æœ‰ä¾èµ–å°±ç»ª

---

## âœ… Definition of Ready & Done

### Definition of Ready

æ¯ä¸ª Story åœ¨ Sprint Planning ååº”æ»¡è¶³:

- [ ] Acceptance Criteria æ¸…æ™°
- [ ] æŠ€æœ¯æ–¹æ¡ˆå·²è®¨è®º (å¦‚éœ€ Architect å’¨è¯¢)
- [ ] ä¾èµ–å·²è¯†åˆ«
- [ ] å·¥ä½œé‡å·²ä¼°ç®—
- [ ] æµ‹è¯•ç­–ç•¥å·²å®šä¹‰

### Definition of Done

æ¯ä¸ª Story å®Œæˆéœ€æ»¡è¶³:

- [ ] ä»£ç å®ç°å¹¶é€šè¿‡ Code Review
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡è¾¾æ ‡
- [ ] é›†æˆæµ‹è¯•é€šè¿‡ (å¦‚é€‚ç”¨)
- [ ] QA å®¡æ ¸é€šè¿‡ (Gate: PASS)
- [ ] æ–‡æ¡£æ›´æ–° (å¦‚éœ€è¦)
- [ ] éƒ¨ç½²åˆ° Dev ç¯å¢ƒéªŒè¯

---

## ğŸ“ˆ ç›‘æ§ä¸è·Ÿè¸ª

### æ¯æ—¥è·Ÿè¸ªæŒ‡æ ‡

- [ ] Sprint Burndown (Story å®Œæˆåº¦)
- [ ] æµ‹è¯•è¦†ç›–ç‡å˜åŒ–
- [ ] Linter warnings æ•°é‡
- [ ] QA Gate çŠ¶æ€

### Sprint ç›®æ ‡æŒ‡æ ‡

**Sprint 1**:
- æµ‹è¯•è¦†ç›–ç‡: 65% â†’ 70%
- æŸ¥è¯¢å“åº”: 600ms â†’ <300ms
- Linter warnings: 24 â†’ <10

**Sprint 2**:
- æµ‹è¯•è¦†ç›–ç‡: 70% â†’ 80%
- æŸ¥è¯¢å“åº”: <300ms â†’ <250ms
- Linter warnings: <10 â†’ 0
- ç›‘æ§ç³»ç»Ÿ: 0% â†’ 100% (ä¸Šçº¿)

---

## ğŸ“… å…³é”®ä¼šè®®

### Daily Standup (æ¯å¤© 9:30, 15åˆ†é’Ÿ)

**è®®ç¨‹**:
1. æ˜¨å¤©å®Œæˆäº†ä»€ä¹ˆ?
2. ä»Šå¤©è®¡åˆ’åšä»€ä¹ˆ?
3. æœ‰ä»€ä¹ˆé˜»ç¢?

**å‚ä¸äºº**: Dev, QA, PO

### Sprint Planning (Monday Week 11, 2h)

**è®®ç¨‹**:
1. Review Epic 4 ç›®æ ‡
2. Story è¯¦ç»†è®²è§£
3. ä»»åŠ¡åˆ†è§£
4. æ‰¿è¯º Sprint ç›®æ ‡

**å‚ä¸äºº**: Dev, QA, PO, Architect

### Sprint Review (Friday EOD, 1h)

**è®®ç¨‹**:
1. Demo å®Œæˆçš„ Story
2. QA Gate çŠ¶æ€å›é¡¾
3. æŒ‡æ ‡éªŒè¯
4. ä¸‹ä¸€ä¸ª Sprint é¢„å‘Š

**å‚ä¸äºº**: Dev, QA, PO, (Stakeholders)

### Sprint Retrospective (Friday EOD, 30min)

**è®®ç¨‹**:
1. What went well?
2. What could be improved?
3. Action items for next Sprint

**å‚ä¸äºº**: Dev, QA, PO

---

## ğŸ¯ å…³é”®é‡Œç¨‹ç¢‘

### Milestone 1: Sprint 1 å®Œæˆ (Week 11 End)

**éªŒæ”¶æ ‡å‡†**:
- âœ… æ‰€æœ‰ P0 Story é€šè¿‡ QA å®¡æ ¸
- âœ… æµ‹è¯•è¦†ç›–ç‡ â‰¥ 70%
- âœ… æ€§èƒ½æå‡éªŒè¯ (æŸ¥è¯¢ < 300ms)
- âœ… æ—  Critical å®‰å…¨é—®é¢˜

### Milestone 2: Sprint 2 å®Œæˆ (Week 12 End)

**éªŒæ”¶æ ‡å‡†**:
- âœ… æ‰€æœ‰ P1 Story é€šè¿‡ QA å®¡æ ¸
- âœ… æµ‹è¯•è¦†ç›–ç‡ â‰¥ 80%
- âœ… æ€§èƒ½ç›®æ ‡è¾¾æˆ (æŸ¥è¯¢ < 250ms)
- âœ… ç›‘æ§ä½“ç³»ä¸Šçº¿

### Milestone 3: ç”Ÿäº§éƒ¨ç½² (Week 13)

**éªŒæ”¶æ ‡å‡†**:
- âœ… å®Œæ•´çš„å›å½’æµ‹è¯•é€šè¿‡
- âœ… æ€§èƒ½æµ‹è¯•éªŒè¯
- âœ… å®‰å…¨æ‰«æé€šè¿‡
- âœ… éƒ¨ç½² Runbook å®Œæˆ
- âœ… ç›‘æ§å‘Šè­¦é…ç½®å®Œæˆ

---

## ğŸ”„ å˜æ›´ç®¡ç†

### Scope å˜æ›´æµç¨‹

1. **æå‡ºå˜æ›´**: ä»»ä½•äººå¯æå‡º
2. **å½±å“è¯„ä¼°**: PO è¯„ä¼°å¯¹ Sprint ç›®æ ‡çš„å½±å“
3. **å›¢é˜Ÿè®¨è®º**: å¦‚æœå½±å“å¤§ï¼Œå›¢é˜Ÿè®¨è®º
4. **å†³ç­–**: PO æœ€ç»ˆå†³å®šæ˜¯å¦æ¥å—å˜æ›´
5. **æ–‡æ¡£æ›´æ–°**: æ›´æ–° Sprint Plan

### ä¼˜å…ˆçº§è°ƒæ•´

å¦‚æœå‘ç° P0 æ— æ³•æŒ‰æ—¶å®Œæˆ:
1. è¯„ä¼°æ˜¯å¦å¯ä»¥å‡å°‘èŒƒå›´
2. è€ƒè™‘å°†éƒ¨åˆ†ä»»åŠ¡æ¨åˆ° Sprint 2
3. ä¸å½±å“ Epic 4 æ€»ä½“ç›®æ ‡

---

## ğŸ“Š æˆåŠŸæŒ‡æ ‡

### é‡åŒ–æŒ‡æ ‡

| æŒ‡æ ‡ | åŸºçº¿ | ç›®æ ‡ | æµ‹é‡æ–¹æ³• |
|-----|------|------|---------|
| ç³»ç»Ÿè¯„åˆ† | 85/100 | â‰¥92/100 | QA è¯„ä¼° |
| æŸ¥è¯¢å“åº”æ—¶é—´ (P50) | 600ms | â‰¤250ms | Lighthouse + æ‰‹åŠ¨æµ‹è¯• |
| æŸ¥è¯¢å“åº”æ—¶é—´ (P95) | 900ms | â‰¤400ms | Lighthouse + æ‰‹åŠ¨æµ‹è¯• |
| æµ‹è¯•è¦†ç›–ç‡ | 65% | â‰¥80% | Coverage Report |
| Linter Warnings | 24 | 0 | npm run lint |
| ç”Ÿäº§äº‹æ•… | N/A | 0 | Sentry |

### è´¨é‡æŒ‡æ ‡

- âœ… æ‰€æœ‰ P0 æ”¹è¿›é€šè¿‡ QA Gate
- âœ… æ—  Critical æˆ– High å®‰å…¨æ¼æ´
- âœ… ä»£ç å®¡æŸ¥é€šè¿‡ç‡ 100%
- âœ… å›å½’æµ‹è¯•é€šè¿‡ç‡ 100%

---

## ğŸ“š æ¶æ„ä¾èµ–

**æ€§èƒ½ä¼˜åŒ–**:
- Redis (Query Embedding ç¼“å­˜)
- Promise.all + å¹¶å‘é™åˆ¶ (æ‰¹å¤„ç†ä¼˜åŒ–)

**æµ‹è¯•åŸºç¡€è®¾æ–½**:
- Jest (å•å…ƒæµ‹è¯•)
- Supertest (API é›†æˆæµ‹è¯•)
- è‡ªå®šä¹‰ E2E æµ‹è¯•æ¡†æ¶

**ç›‘æ§ä¸æ—¥å¿—**:
- ~~Vercel Analytics (æ€§èƒ½ç›‘æ§)~~ - å»¶æœŸ,ä½¿ç”¨ Lighthouse æ›¿ä»£
- Axiom (ç»“æ„åŒ–æ—¥å¿—)
- Sentry (é”™è¯¯è¿½è¸ª)

**å®‰å…¨**:
- Rate Limiting (é€Ÿç‡é™åˆ¶)
- CSP Headers (å†…å®¹å®‰å…¨ç­–ç•¥)
- TypeScript Strict Mode (ç±»å‹å®‰å…¨)

**ç›¸å…³æ¶æ„æ–‡æ¡£**:
- `docs/architecture.md` - å®Œæ•´æŠ€æœ¯æ¶æ„
- `docs/architecture/query-embedding-cache-design.md` - ç¼“å­˜è®¾è®¡
- `docs/testing/strategy.md` - æµ‹è¯•ç­–ç•¥

---

## ğŸ“ æ²Ÿé€šè®¡åˆ’

### å†…éƒ¨æ²Ÿé€š

- **Daily Standup**: æ¯å¤©åŒæ­¥è¿›åº¦
- **Slack Channel**: `#epic-4-quality`
- **Code Review**: GitHub PR
- **QA åé¦ˆ**: Gate YAML + Assessment æ–‡æ¡£

### å¤–éƒ¨æ²Ÿé€š

- **Stakeholder Update**: æ¯å‘¨äº” Sprint Review
- **è¿›åº¦æŠ¥å‘Š**: PO æ•´ç†å‘¨æŠ¥
- **é£é™©ä¸ŠæŠ¥**: åŠæ—¶é€šçŸ¥ç®¡ç†å±‚

---

## âœ… Epic éªŒæ”¶æ ‡å‡†

### å¿…é¡»æ»¡è¶³ (Must Have)

1. âœ… æ‰€æœ‰ P0 Story å®Œæˆå¹¶é€šè¿‡ QA Gate (PASS)
2. âœ… ç³»ç»Ÿè¯„åˆ† â‰¥ 92/100
3. âœ… æŸ¥è¯¢å“åº”æ—¶é—´ (P50) â‰¤ 250ms (Lighthouse éªŒè¯)
4. âœ… æµ‹è¯•è¦†ç›–ç‡ â‰¥ 80%
5. âœ… æ—  Critical å®‰å…¨æ¼æ´
6. âœ… Axiom æ—¥å¿—ç›‘æ§ä¸Šçº¿ (Vercel Analytics å»¶æœŸ)

### åº”è¯¥æ»¡è¶³ (Should Have)

7. âœ… æ‰€æœ‰ P1 Story å®Œæˆ
8. âœ… æŸ¥è¯¢å“åº”æ—¶é—´ (P95) â‰¤ 400ms
9. âœ… TypeScript ç±»å‹å®‰å…¨ (0 warnings)
10. âœ… å®Œæ•´çš„éƒ¨ç½²æ–‡æ¡£

### å¯ä»¥æ»¡è¶³ (Could Have)

11. ğŸ”„ éƒ¨åˆ† P2 æ”¹è¿›å®æ–½
12. ğŸ”„ æ€§èƒ½åŸºå‡†æµ‹è¯•å¥—ä»¶
13. ğŸ”„ è‡ªåŠ¨åŒ–æ€§èƒ½ç›‘æ§å‘Šè­¦

---

## ğŸ‰ æœŸæœ›æˆæœ

### æŠ€æœ¯æˆæœ

- âœ… **ç”Ÿäº§çº§ç³»ç»Ÿ**: è¯„åˆ† 92+, ç”Ÿäº§å°±ç»ªåº¦ 95%
- âœ… **é«˜æ€§èƒ½**: æŸ¥è¯¢é€Ÿåº¦æå‡ 60%+
- âœ… **é«˜è´¨é‡**: æµ‹è¯•è¦†ç›–ç‡ 80%+, å›å½’é£é™©å¤§å¹…é™ä½
- âœ… **é«˜å¯è§‚æµ‹æ€§**: å®Œæ•´çš„ç›‘æ§ã€æ—¥å¿—ã€å‘Šè­¦ä½“ç³»

### ä¸šåŠ¡æˆæœ

- âœ… **ç”¨æˆ·ä½“éªŒ**: æŸ¥è¯¢å“åº”æ˜¾è‘—æå‡ï¼Œç”¨æˆ·æ»¡æ„åº¦æé«˜
- âœ… **ç³»ç»Ÿç¨³å®šæ€§**: å›å½’é£é™©é™ä½ 50%ï¼Œæ•…éšœç‡å‡å°‘
- âœ… **è¿ç»´æ•ˆç‡**: æ•…éšœå®šä½æ—¶é—´å‡å°‘ 80%
- âœ… **å®‰å…¨ä¿éšœ**: æ—  Critical æ¼æ´ï¼ŒDoS é˜²æŠ¤å®Œå–„

### å›¢é˜Ÿæˆæœ

- âœ… **å·¥ç¨‹æ–‡åŒ–**: å»ºç«‹è´¨é‡ä¼˜å…ˆçš„å·¥ç¨‹å®è·µ
- âœ… **æŠ€èƒ½æå‡**: å›¢é˜ŸæŒæ¡æ€§èƒ½ä¼˜åŒ–å’Œæµ‹è¯•æœ€ä½³å®è·µ
- âœ… **æµç¨‹ä¼˜åŒ–**: å»ºç«‹å®Œå–„çš„ QA æµç¨‹å’Œè´¨é‡æ ‡å‡†

---

---

## ğŸ“ Scope å˜æ›´è®°å½•

### å˜æ›´ 1: Story 4.11 å»¶æœŸ (2025-01-15)

**å†³ç­–äºº**: Sarah (Product Owner)  
**å˜æ›´ç±»å‹**: Scope Reduction (èŒƒå›´ç¼©å‡)

**åŸå› **:
- å½“å‰æ²¡æœ‰ Vercel Pro è®¡åˆ’ (éœ€è¦ $20/æœˆ)
- Story 4.11 ä¸º P1 ä¼˜å…ˆçº§,éæ ¸å¿ƒé˜»å¡é¡¹
- Epic 4 æ ¸å¿ƒç›®æ ‡ä¸å—å½±å“

**å½±å“åˆ†æ**:
- âœ… **P0 Story ä¸å—å½±å“**: å®‰å…¨ã€æ€§èƒ½ã€æµ‹è¯•è¦†ç›–ç‡ç›®æ ‡å¯ç‹¬ç«‹å®ç°
- âœ… **æ€§èƒ½éªŒè¯æ›¿ä»£æ–¹æ¡ˆ**: ä½¿ç”¨ Lighthouse + æ‰‹åŠ¨æµ‹è¯• + è‡ªå®šä¹‰æ—¥å¿—
- âœ… **å·¥ä½œé‡ä¼˜åŒ–**: Sprint 2 ä» 30h â†’ 28h,ç¼“å†²ä» 25% â†’ 30%
- âš ï¸ **ç›‘æ§ä½“ç³»éƒ¨åˆ†å»¶æœŸ**: ä»… Axiom æ—¥å¿—ä¸Šçº¿,Vercel Analytics å¾…åç»­å‡çº§

**æ›¿ä»£éªŒè¯æ–¹æ¡ˆ**:

| åŸéªŒè¯æ–¹å¼ | æ›¿ä»£æ–¹æ¡ˆ | æ•°æ®è´¨é‡ |
|-----------|---------|---------|
| Vercel Analytics å®æ—¶ç›‘æ§ | Lighthouse CI + æ‰‹åŠ¨æµ‹è¯• | 85% ç­‰æ•ˆ |
| Web Vitals è‡ªåŠ¨è¿½è¸ª | Lighthouse Performance æŠ¥å‘Š | 80% ç­‰æ•ˆ |
| ç”¨æˆ·è®¿é—®ç»Ÿè®¡ | æš‚æ—  (Phase 2 è¡¥å……) | N/A |

**åç»­è®¡åˆ’**:
- Phase 2 è€ƒè™‘å‡çº§ Vercel Pro
- æˆ–ä½¿ç”¨æ›¿ä»£æ–¹æ¡ˆ (Google Analytics 4)
- Story 4.11 ä¿ç•™åœ¨ Backlog,ä¼˜å…ˆçº§è°ƒæ•´ä¸º P2

**æ‰¹å‡†**: âœ… å›¢é˜Ÿè¾¾æˆå…±è¯† (PO + Dev + QA)

---

**Epic Owner**: Sarah (Product Owner)  
**Created**: 2025-01-10  
**Last Updated**: 2025-01-15  
**Status**: Ready for Sprint (å·²è°ƒæ•´èŒƒå›´)
