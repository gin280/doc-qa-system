# æµ‹è¯•æ–‡æ¡£ä¸­å¿ƒ

æ¬¢è¿æ¥åˆ° DocQA System æµ‹è¯•æ–‡æ¡£ä¸­å¿ƒï¼

## ğŸ¯ å¿«é€Ÿå¯¼èˆª

### æˆ‘åº”è¯¥çœ‹å“ªä¸ªæ–‡æ¡£ï¼Ÿ

| ä½ çš„è§’è‰²/ç›®æ ‡ | æ¨èæ–‡æ¡£ |
|-------------|---------|
| **åˆšåŠ å…¥é¡¹ç›®** | ğŸ‘‰ [æµ‹è¯•ç­–ç•¥æ¦‚è§ˆ](strategy.md) |
| **å†™å•å…ƒæµ‹è¯•** | ğŸ‘‰ [å•å…ƒæµ‹è¯•æŒ‡å—](unit-testing.md) |
| **å†™é›†æˆæµ‹è¯•** | ğŸ‘‰ [é›†æˆæµ‹è¯•æŒ‡å—](integration-testing.md) |
| **æµ‹è¯•ç‰¹å®š Story** | ğŸ‘‰ [Story ä¸“ç”¨æµ‹è¯•](#story-ä¸“ç”¨æµ‹è¯•) |
| **è¿è¡Œæµ‹è¯•** | ğŸ‘‰ [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹) |
| **æ¸…ç†æµ‹è¯•æ•°æ®** | ğŸ‘‰ [æ•°æ®æ¸…ç†](#æ•°æ®æ¸…ç†) |

---

## ğŸ“š æ ¸å¿ƒæ–‡æ¡£

### 1. [æµ‹è¯•ç­–ç•¥æ¦‚è§ˆ](strategy.md) â­ å¿…è¯»

**å†…å®¹**ï¼š
- å•å…ƒæµ‹è¯• vs é›†æˆæµ‹è¯•å¯¹æ¯”
- æµ‹è¯•é‡‘å­—å¡”åŸåˆ™
- æ—¥å¸¸å¼€å‘æµç¨‹
- æœ€ä½³å®è·µå’Œå¸¸è§é—®é¢˜

**é€‚ç”¨**ï¼šæ‰€æœ‰å¼€å‘è€…

---

### 2. [å•å…ƒæµ‹è¯•æŒ‡å—](unit-testing.md)

**å†…å®¹**ï¼š
- å¦‚ä½•ç¼–å†™å•å…ƒæµ‹è¯•
- Mock æ•°æ®åº“å’Œå¤–éƒ¨ä¾èµ–
- æµ‹è¯•ä¸šåŠ¡é€»è¾‘çš„æœ€ä½³å®è·µ
- å¸¸è§é”™è¯¯å’Œè§£å†³æ–¹æ¡ˆ

**é€‚ç”¨**ï¼šç¼–å†™ Serviceã€Hookã€Util æµ‹è¯•

---

### 3. [é›†æˆæµ‹è¯•æŒ‡å—](integration-testing.md)

**å†…å®¹**ï¼š
- å¦‚ä½•ç¼–å†™é›†æˆæµ‹è¯•
- è¿æ¥çœŸå® Supabase æ•°æ®åº“
- è‡ªåŠ¨æ¸…ç†æµ‹è¯•æ•°æ®
- è¿è¡Œæ–¹å¼å’Œæ³¨æ„äº‹é¡¹

**é€‚ç”¨**ï¼šç¼–å†™ APIã€æ•°æ®åº“æ“ä½œæµ‹è¯•

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ—¥å¸¸å¼€å‘ï¼ˆæ¨èï¼‰

```bash
# åªè¿è¡Œå•å…ƒæµ‹è¯•ï¼ˆå¿«é€Ÿï¼Œä¸è¿æ¥æ•°æ®åº“ï¼‰
npm test
```

### æäº¤å‰

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm run test:all
```

### åªè¿è¡Œç‰¹å®šç±»å‹

```bash
# åªè¿è¡Œå•å…ƒæµ‹è¯•
npm run test:unit

# åªè¿è¡Œé›†æˆæµ‹è¯•
npm run test:integration

# åªè¿è¡Œæ•°æ®åº“é›†æˆæµ‹è¯•
npm run test:integration:db

# åªè¿è¡Œ API é›†æˆæµ‹è¯•
npm run test:integration:api
```

---

## ğŸ§¹ æ•°æ®æ¸…ç†

å¦‚æœé›†æˆæµ‹è¯•å¤±è´¥æˆ–ä¸­æ–­ï¼Œå¯èƒ½åœ¨ Supabase ç•™ä¸‹æµ‹è¯•æ•°æ®ï¼š

```bash
# è‡ªåŠ¨æ¸…ç†æ‰€æœ‰æµ‹è¯•æ•°æ®
npm run test:cleanup
```

æˆ–æ‰‹åŠ¨åœ¨ Supabase SQL Editor æ‰§è¡Œï¼š

```sql
-- æŸ¥çœ‹æµ‹è¯•æ•°æ®
SELECT * FROM users 
WHERE email LIKE '%integration-test%' 
   OR email LIKE '%test@example.com';

-- åˆ é™¤æµ‹è¯•æ•°æ®
DELETE FROM users 
WHERE email LIKE '%integration-test%' 
   OR email LIKE '%test@example.com';
```

---

## ğŸ“Š Story ä¸“ç”¨æµ‹è¯•

éƒ¨åˆ† Story æœ‰ä¸“é—¨çš„æµ‹è¯•æŒ‡å—ï¼š

| Story | æµ‹è¯•æ–‡æ¡£ | å†…å®¹ |
|-------|---------|------|
| Story 2.4 | [æ–‡æ¡£å‘é‡åŒ–æµ‹è¯•](story-specific/2.4-vectorization-testing.md) | æ‰‹åŠ¨æµ‹è¯•æ–‡æ¡£åˆ†å—å’Œå‘é‡åŒ–æµç¨‹ |
| Story 3.2 | [RAG å‘é‡æ£€ç´¢æµ‹è¯•](story-specific/3.2-rag-testing.md) | RAG æ£€ç´¢åŠŸèƒ½çš„å®Œæ•´æµ‹è¯•æ–¹æ¡ˆ |

---

## ğŸ“ˆ è¦†ç›–ç‡

æŸ¥çœ‹æµ‹è¯•è¦†ç›–ç‡ï¼š

```bash
npm run test:coverage
open coverage/lcov-report/index.html
```

**ç›®æ ‡**ï¼š
- å•å…ƒæµ‹è¯•è¦†ç›–ç‡ï¼šâ‰¥ 80%
- å…³é”®è·¯å¾„é›†æˆæµ‹è¯•ï¼š100%
- æ€»ä½“è¦†ç›–ç‡ï¼šâ‰¥ 75%

---

## ğŸ¯ æµ‹è¯•é‡‘å­—å¡”

```
        /\
       /  \     E2E (5%)
      /____\    - Playwright/Cypress
     /      \   
    / é›†æˆæµ‹è¯• \  (15%)
   /___________\ - çœŸå®æ•°æ®åº“ã€API
  /             \
 /   å•å…ƒæµ‹è¯•     \ (80%)
/__________________\ - Mock æ‰€æœ‰ä¾èµ–
```

**åŸåˆ™**ï¼š
- 80% å•å…ƒæµ‹è¯•ï¼ˆå¿«é€ŸéªŒè¯ä¸šåŠ¡é€»è¾‘ï¼‰
- 15% é›†æˆæµ‹è¯•ï¼ˆéªŒè¯ç³»ç»Ÿé›†æˆï¼‰
- 5% E2E æµ‹è¯•ï¼ˆéªŒè¯ç”¨æˆ·æµç¨‹ï¼‰

---

## â“ å¸¸è§é—®é¢˜

### Q: æˆ‘çš„å•å…ƒæµ‹è¯•å¾ˆæ…¢ï¼Œæ€ä¹ˆåŠï¼Ÿ

**A:** æ£€æŸ¥æ˜¯å¦æœ‰æµ‹è¯•æ–‡ä»¶ç›´æ¥å¯¼å…¥äº† `@/lib/db`ï¼Œåº”è¯¥ Mock å®ƒï¼š

```typescript
// âŒ é”™è¯¯ï¼šä¼šè¿æ¥çœŸå®æ•°æ®åº“
import { db } from '@/lib/db'

// âœ… æ­£ç¡®ï¼šMock æ•°æ®åº“
jest.mock('@/lib/db', () => ({
  db: {
    select: jest.fn()
  }
}))
```

---

### Q: é›†æˆæµ‹è¯•ç•™ä¸‹è„æ•°æ®æ€ä¹ˆåŠï¼Ÿ

**A:** è¿è¡Œæ¸…ç†è„šæœ¬ï¼š

```bash
npm run test:cleanup
```

---

### Q: ä»€ä¹ˆæ—¶å€™å†™å•å…ƒæµ‹è¯•ï¼Œä»€ä¹ˆæ—¶å€™å†™é›†æˆæµ‹è¯•ï¼Ÿ

**A:**

**å•å…ƒæµ‹è¯•**ï¼ˆä¸šåŠ¡é€»è¾‘ï¼‰ï¼š
- Service å±‚å‡½æ•°
- Util å·¥å…·å‡½æ•°
- React Hooks
- æ•°æ®è½¬æ¢é€»è¾‘

**é›†æˆæµ‹è¯•**ï¼ˆç«¯åˆ°ç«¯ï¼‰ï¼š
- API ç«¯ç‚¹
- æ•°æ®åº“æ“ä½œ
- ç¬¬ä¸‰æ–¹æœåŠ¡é›†æˆ

---

### Q: å¦‚ä½•è°ƒè¯•å¤±è´¥çš„æµ‹è¯•ï¼Ÿ

**A:**

```bash
# å•ä¸ªæµ‹è¯•æ–‡ä»¶
npm test -- path/to/test.test.ts

# ç›‘å¬æ¨¡å¼ï¼ˆè‡ªåŠ¨é‡è·‘ï¼‰
npm run test:watch

# è°ƒè¯•æ¨¡å¼
node --inspect-brk node_modules/.bin/jest --runInBand
```

---

## ğŸ”— ç›¸å…³èµ„æº

### é¡¹ç›®æ–‡æ¡£
- [é¡¹ç›®æ¶æ„](../architecture.md)
- [Story åˆ—è¡¨](../prd/epic-story-index.md)
- [Story 1.9: æµ‹è¯•åŸºç¡€è®¾æ–½](../stories/1.9-testing-infrastructure.md)

### å¤–éƒ¨èµ„æº
- [Jest æ–‡æ¡£](https://jestjs.io/)
- [Testing Library](https://testing-library.com/)
- [Drizzle ORM æµ‹è¯•](https://orm.drizzle.team/docs/guides/testing)

---

## ğŸ“ å­¦ä¹ è·¯å¾„

### æ–°æ‰‹ï¼ˆ0-1å‘¨ï¼‰
1. é˜…è¯» [æµ‹è¯•ç­–ç•¥](strategy.md)
2. è·Ÿç€ [å•å…ƒæµ‹è¯•æŒ‡å—](unit-testing.md) å†™ç¬¬ä¸€ä¸ªæµ‹è¯•
3. è¿è¡Œ `npm test` æŸ¥çœ‹æ•ˆæœ

### è¿›é˜¶ï¼ˆ1-2å‘¨ï¼‰
1. å­¦ä¹  Mock æŠ€å·§
2. é˜…è¯» [é›†æˆæµ‹è¯•æŒ‡å—](integration-testing.md)
3. ç¼–å†™ç«¯åˆ°ç«¯ API æµ‹è¯•

### é«˜çº§ï¼ˆ2å‘¨+ï¼‰
1. ä¼˜åŒ–æµ‹è¯•æ€§èƒ½
2. æé«˜è¦†ç›–ç‡
3. è´¡çŒ®æµ‹è¯•æœ€ä½³å®è·µ

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

- ğŸ’¬ **Slack**: #testing é¢‘é“
- ğŸ“ **æ–‡æ¡£é—®é¢˜**: æ Issue æˆ– PR
- ğŸ‘¤ **è”ç³»äºº**: Full Stack Developer (James)

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**åˆ›å»ºæ—¥æœŸ**: 2025-01-15  
**æœ€åæ›´æ–°**: 2025-01-15  
**ç»´æŠ¤äºº**: Product Owner (Sarah)
